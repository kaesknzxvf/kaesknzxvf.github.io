<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Flutter 01 Simple Chat UI 응용 03 데이터 로컬 저장 및 읽기,쓰기_메세지 로그편" /><meta name="author" content="Kae" /><meta property="og:locale" content="en" /><meta name="description" content="Developer, Study, Flutter, Programming, iOS" /><meta property="og:description" content="Developer, Study, Flutter, Programming, iOS" /><link rel="canonical" href="https://kaesknzxvf.github.io/posts/Flutter-Simple-Chat-UI-EX03/" /><meta property="og:url" content="https://kaesknzxvf.github.io/posts/Flutter-Simple-Chat-UI-EX03/" /><meta property="og:site_name" content="Kae’s Dev" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-09-19T20:17:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Flutter 01 Simple Chat UI 응용 03 데이터 로컬 저장 및 읽기,쓰기_메세지 로그편" /><meta name="twitter:site" content="@kzaxevsf52" /><meta name="twitter:creator" content="@kzaxevsf52" /><meta name="google-site-verification" content="tEJ2GfzgZDbKuox8B6dklyj9Al_5yxKNq-ImVP9K4hc" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Kae","url":"https://github.com/kaesknzxvf"},"dateModified":"2022-09-19T20:17:00+09:00","datePublished":"2022-09-19T20:17:00+09:00","description":"Developer, Study, Flutter, Programming, iOS","headline":"Flutter 01 Simple Chat UI 응용 03 데이터 로컬 저장 및 읽기,쓰기_메세지 로그편","mainEntityOfPage":{"@type":"WebPage","@id":"https://kaesknzxvf.github.io/posts/Flutter-Simple-Chat-UI-EX03/"},"url":"https://kaesknzxvf.github.io/posts/Flutter-Simple-Chat-UI-EX03/"}</script><title>Flutter 01 Simple Chat UI 응용 03 데이터 로컬 저장 및 읽기,쓰기_메세지 로그편 | Kae's Dev</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Kae's Dev"><meta name="application-name" content="Kae's Dev"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/profile/main_img.jpeg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Kae's Dev</a></div><div class="site-subtitle font-italic">honyarara</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/kaesknzxvf" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/kzaxevsf52" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a> <a href="https://www.linkedin.com/in/" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Flutter 01 Simple Chat UI 응용 03 데이터 로컬 저장 및 읽기,쓰기_메세지 로그편 </span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Flutter 01 Simple Chat UI 응용 03 데이터 로컬 저장 및 읽기,쓰기_메세지 로그편</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1663586220" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Sep 19, 2022 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/kaesknzxvf">Kae</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="6129 words"> <em>34 min</em> read</span></div></div></div><div class="post-content"><p>이 포스트는</p><ul><li><a href="https://www.freecodecamp.org/news/build-a-chat-app-ui-with-flutter/">How to Build a Chat App UI With Flutter and Dart</a></ul><p>을 따라서 작성한 Flutter Simple Chat UI 을 응용하여 좀 더 그럴듯한 채팅앱을 구현하기 위한 과정을 다룬다.</p><p>주요 내용은 이하와 같다.</p><ul><li><code class="language-plaintext highlighter-rouge">ChatDetailPage</code> : 유저 별 메세지 로그 저장, 불러오기<ul><li>코드 정리 : 메세지 로그 리스트뷰 코드 분리<li>메세지 로그 저장/불러오기 시의 주의 점<li>해당 유저의 메세지 로그 불러오기<li>메세지 로그 저장<li>UI 변경, 기능 추가 (옵션)<ul><li>받은 메세지 조작 : receiver 버튼, 기능 추가<li>메세지 초기화 : clear 버튼, 기능 추가<li>개별 메세지에 대한 기능 추가 (개별 메세지 복사, 수정, 삭제)</ul></ul><li><code class="language-plaintext highlighter-rouge">ChatPage</code> : 유저 데이터 갱신<ul><li>각 유저의 최근 메세지 표시</ul></ul><p>원문의 예제는 단순히 UI만 다루는 포스트이다 보니, 실제로 데이터를 전달하거나 저장하는 등 데이터를 처리하는 작업은 해주지 않는다. 그러므로 이번 포스트는 스스로 공부하며 추가한 코드이다.</p><p>관련 포스트</p><ul><li><a href="https://kaesknzxvf.github.io/posts/Flutter-Simple-Chat-UI-01/">Base, Chat 화면 구현</a><li><a href="https://kaesknzxvf.github.io/posts/Flutter-Simple-Chat-UI-02/">Chat Detail 화면 구현</a><li><a href="https://kaesknzxvf.github.io/posts/Flutter-Simple-Chat-UI-EX01/">응용 01 (Chat Detail 화면) 화면 간 데이터 전달, 메세지 입력</a><li><a href="https://kaesknzxvf.github.io/posts/Flutter-Simple-Chat-UI-EX02/">응용 02 데이터 로컬 저장 및 읽기,쓰기_유저정보편 (+상태창 추가)</a><li>응용 03 데이터 로컬 저장 및 읽기,쓰기_메세지로그편 (현재포스트)</ul><hr /><h1 id="환경">환경</h1><ul><li>MacBook Air (M1, 2020)<li><p>macOS Monterey (v12.4)</p><li>Flutter 3.0.3<li><p>Dart 2.17.5</p><li>Visual Studio Code 1.69.0</ul><hr /><h1 id="chatdetailpage--유저-별-메세지-로그-저장-불러오기">ChatDetailPage : 유저 별 메세지 로그 저장, 불러오기</h1><p>먼저 유저 별 메세지 로그를 저장하고, 기타 기능을 구현하기 위해서 ChatMessage 모델의 속성을 조금 추가해 주었다.</p><ul><li>userid : 현재 채팅을 하고있는 유저의 <code class="language-plaintext highlighter-rouge">id</code>속성을 받는 속성<li>messageid : 개별 메세지의 식별을 위한 속성, <code class="language-plaintext highlighter-rouge">ChatUsers</code> 모델의 <code class="language-plaintext highlighter-rouge">id</code>와 마찬가지로 <code class="language-plaintext highlighter-rouge">uuid</code>플러그인을 이용해 생성자 실행 시에 자동으로 할당되도록 해주었다.</ul><div file="/lib/models/chatMessageModel.dart" class="language-dart highlighter-rouge"><div class="code-header"> <span data-label-text="/lib/models/chatMessageModel.dart"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="s">'package:hive/hive.dart'</span><span class="o">;</span> 
<span class="kn">import</span> <span class="s">'package:uuid/uuid.dart'</span><span class="o">;</span>

<span class="kn">part</span> <span class="s">'chatMessageModel.g.dart'</span><span class="o">;</span>

<span class="kd">var</span> <span class="n">uuid</span> <span class="o">=</span> <span class="n">Uuid</span><span class="p">();</span>

<span class="nd">@HiveType</span><span class="p">(</span><span class="nl">typeId:</span> <span class="mi">2</span><span class="p">)</span>
<span class="kd">class</span> <span class="nc">ChatMessage</span> <span class="p">{</span>
  <span class="nd">@HiveField</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1">//추가</span>
  <span class="kt">String</span> <span class="n">userid</span><span class="p">;</span> <span class="c1">//추가</span>

  <span class="nd">@HiveField</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1">//추가</span>
  <span class="kt">String</span> <span class="n">messageid</span><span class="p">;</span> <span class="c1">//추가</span>

  <span class="nd">@HiveField</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> 
  <span class="kt">String</span> <span class="n">messageContent</span><span class="p">;</span>

  <span class="nd">@HiveField</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> 
  <span class="kt">String</span> <span class="n">messageType</span><span class="p">;</span>


  <span class="n">ChatMessage</span><span class="p">(</span>
      <span class="p">{</span><span class="kd">required</span> <span class="k">this</span><span class="o">.</span><span class="na">userid</span><span class="p">,</span>
      <span class="kt">String</span><span class="o">?</span> <span class="n">messageid</span><span class="p">,</span>
      <span class="kd">required</span> <span class="k">this</span><span class="o">.</span><span class="na">messageContent</span><span class="p">,</span>
      <span class="kd">required</span> <span class="k">this</span><span class="o">.</span><span class="na">messageType</span><span class="p">})</span>
      <span class="o">:</span> <span class="n">messageid</span> <span class="o">=</span> <span class="n">messageid</span> <span class="o">??</span> <span class="n">uuid</span><span class="o">.</span><span class="na">v4</span><span class="p">();</span>

<span class="p">}</span>
</pre></table></code></div></div><p>수정 후에는 <code class="language-plaintext highlighter-rouge">TypeAdapter</code> 갱신해주는 걸 잊지 말자</p><div class="language-html highlighter-rouge"><div class="code-header"> <span data-label-text="HTML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>flutter packages pub run build_runner build
</pre></table></code></div></div><h2 id="코드-정리--메세지-로그-리스트뷰-코드-분리"><span class="mr-2">코드 정리 : 메세지 로그 리스트뷰 코드 분리</span><a href="#코드-정리--메세지-로그-리스트뷰-코드-분리" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>지금 <code class="language-plaintext highlighter-rouge">ChatDetailPage.dart</code> 화면에 UI랑 데이터 처리 코드가 섞여 너무 정신사나워서, 메세지 로그를 표시하는 리스트뷰 부분 코드를 조금 정리했다.</p><p><code class="language-plaintext highlighter-rouge">chatPage.dart</code>의 유저 목록을 표시하는 리스트뷰 <code class="language-plaintext highlighter-rouge">conversationList.dart</code>를 분리한 것 처럼, <code class="language-plaintext highlighter-rouge">ChatDetailPage.dart</code>도 body에 메세지로그를 표시하는 Listview를 <code class="language-plaintext highlighter-rouge">messageList.dart</code> 라는 widget으로 분리했다.</p><div file="/lib/widgets/messageList.dart" class="language-dart highlighter-rouge"><div class="code-header"> <span data-label-text="/lib/widgets/messageList.dart"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="s">'package:flutter/material.dart'</span><span class="o">;</span>

<span class="kd">class</span> <span class="nc">MessageList</span> <span class="kd">extends</span> <span class="n">StatefulWidget</span> <span class="p">{</span>
  <span class="kt">String</span> <span class="n">userid</span><span class="p">;</span>
  <span class="n">ChatMessage</span> <span class="n">currentmsg</span><span class="p">;</span>

  <span class="n">MessageList</span><span class="p">(</span>
      <span class="p">{</span><span class="kd">required</span> <span class="k">this</span><span class="o">.</span><span class="na">userid</span><span class="p">,</span>
      <span class="kd">required</span> <span class="k">this</span><span class="o">.</span><span class="na">currentmsg</span><span class="p">});</span>

  <span class="nd">@override</span>
  <span class="n">_MessageListState</span> <span class="n">createState</span><span class="p">()</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">_MessageListState</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">_MessageListState</span> <span class="kd">extends</span> <span class="n">State</span><span class="p">&lt;</span><span class="n">MessageList</span><span class="p">&gt;</span> <span class="p">{</span>
  <span class="nd">@override</span>
  <span class="n">Widget</span> <span class="n">build</span><span class="p">(</span><span class="n">BuildContext</span> <span class="n">context</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">Container</span><span class="p">(</span>
      <span class="nl">padding:</span> <span class="n">EdgeInsets</span><span class="o">.</span><span class="na">only</span><span class="p">(</span><span class="nl">left:</span> <span class="mi">16</span><span class="p">,</span> <span class="nl">right:</span> <span class="mi">16</span><span class="p">,</span> <span class="nl">top:</span> <span class="mi">10</span><span class="p">,</span> <span class="nl">bottom:</span> <span class="mi">10</span><span class="p">),</span>
      <span class="nl">child:</span> <span class="n">Align</span><span class="p">(</span>
        <span class="nl">alignment:</span> <span class="p">(</span><span class="n">widget</span><span class="o">.</span><span class="na">currentmsg</span><span class="o">.</span><span class="na">messageType</span> <span class="o">==</span> <span class="s">"receiver"</span>
            <span class="o">?</span> <span class="n">Alignment</span><span class="o">.</span><span class="na">topLeft</span>
            <span class="o">:</span> <span class="n">Alignment</span><span class="o">.</span><span class="na">topRight</span><span class="p">),</span>
        <span class="nl">child:</span> <span class="n">Container</span><span class="p">(</span>
          <span class="nl">decoration:</span> <span class="n">BoxDecoration</span><span class="p">(</span>
            <span class="nl">borderRadius:</span> <span class="n">BorderRadius</span><span class="o">.</span><span class="na">circular</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
            <span class="nl">color:</span> <span class="p">(</span><span class="n">widget</span><span class="o">.</span><span class="na">currentmsg</span><span class="o">.</span><span class="na">messageType</span> <span class="o">==</span> <span class="s">"receiver"</span>
                <span class="o">?</span> <span class="n">Colors</span><span class="o">.</span><span class="na">grey</span><span class="o">.</span><span class="na">shade200</span>
                <span class="o">:</span> <span class="n">Colors</span><span class="o">.</span><span class="na">blue</span><span class="p">[</span><span class="mi">200</span><span class="p">]),</span>
          <span class="p">),</span>
          <span class="nl">padding:</span> <span class="n">EdgeInsets</span><span class="o">.</span><span class="na">all</span><span class="p">(</span><span class="mi">16</span><span class="p">),</span>
          <span class="nl">margin:</span> <span class="p">(</span><span class="n">widget</span><span class="o">.</span><span class="na">currentmsg</span><span class="o">.</span><span class="na">messageType</span> <span class="o">==</span> <span class="s">"receiver"</span>
              <span class="o">?</span> <span class="n">EdgeInsets</span><span class="o">.</span><span class="na">only</span><span class="p">(</span><span class="nl">left:</span> <span class="mi">0</span><span class="p">,</span> <span class="nl">right:</span> <span class="mi">64</span><span class="p">,</span> <span class="nl">top:</span> <span class="mi">0</span><span class="p">,</span> <span class="nl">bottom:</span> <span class="mi">0</span><span class="p">)</span>
              <span class="o">:</span> <span class="n">EdgeInsets</span><span class="o">.</span><span class="na">only</span><span class="p">(</span><span class="nl">left:</span> <span class="mi">64</span><span class="p">,</span> <span class="nl">right:</span> <span class="mi">0</span><span class="p">,</span> <span class="nl">top:</span> <span class="mi">0</span><span class="p">,</span> <span class="nl">bottom:</span> <span class="mi">0</span><span class="p">)),</span>
          <span class="nl">child:</span> <span class="n">Text</span><span class="p">(</span><span class="err">¥</span>
            <span class="n">widget</span><span class="o">.</span><span class="na">currentmsg</span><span class="o">.</span><span class="na">messageContent</span><span class="p">,</span>
            <span class="nl">style:</span> <span class="n">TextStyle</span><span class="p">(</span><span class="nl">fontSize:</span> <span class="mi">15</span><span class="p">),</span>
          <span class="p">),</span>
        <span class="p">),</span>
      <span class="p">),</span>
    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>기존 파일에서는 해당 부분 삭제하고 인수 전달만 해주었다.</p><div file="/lib/screens/chatDetailPage.dart" class="language-dart highlighter-rouge"><div class="code-header"> <span data-label-text="/lib/screens/chatDetailPage.dart"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre><td class="rouge-code"><pre><span class="c1">//추가</span>
<span class="kn">import</span> <span class="s">'package:flt_simple_chat_ex/widgets/messageList.dart'</span><span class="o">;</span>

<span class="p">...</span> <span class="c1">// 생략</span>
      <span class="nl">body:</span> <span class="n">Column</span><span class="p">(</span>
        <span class="nl">children:</span> <span class="p">&lt;</span><span class="n">Widget</span><span class="p">&gt;[</span>
          <span class="n">Flexible</span><span class="p">(</span>
            <span class="nl">fit:</span> <span class="n">FlexFit</span><span class="o">.</span><span class="na">tight</span><span class="p">,</span> 
            <span class="nl">child:</span> <span class="n">SingleChildScrollView</span><span class="p">(</span>
              <span class="nl">physics:</span> <span class="n">BouncingScrollPhysics</span><span class="p">(),</span> 
              <span class="nl">controller:</span> <span class="n">_scrollController</span><span class="p">,</span> 
              <span class="nl">child:</span> <span class="n">ListView</span><span class="o">.</span><span class="na">builder</span><span class="p">(</span>
                <span class="nl">itemCount:</span> <span class="n">_mstate_currentuser</span><span class="o">.</span><span class="na">length</span><span class="p">,</span>
                <span class="nl">shrinkWrap:</span> <span class="kc">true</span><span class="p">,</span>
                <span class="nl">padding:</span> <span class="n">EdgeInsets</span><span class="o">.</span><span class="na">only</span><span class="p">(</span>
                    <span class="nl">top:</span> <span class="mi">10</span><span class="p">),</span> 
                <span class="nl">physics:</span> <span class="n">NeverScrollableScrollPhysics</span><span class="p">(),</span>
                <span class="nl">itemBuilder:</span> <span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span> <span class="p">{</span>
                  <span class="c1">// 수정, 인수로 전달</span>
                  <span class="k">return</span> <span class="n">MessageList</span><span class="p">(</span> 
                    <span class="nl">userid:</span> <span class="n">widget</span><span class="o">.</span><span class="na">cpuser</span><span class="o">.</span><span class="na">id</span><span class="p">,</span>
                    <span class="nl">currentmsg:</span> <span class="n">ChatMessage</span><span class="p">(</span>
                        <span class="nl">userid:</span> <span class="n">widget</span><span class="o">.</span><span class="na">cpuser</span><span class="o">.</span><span class="na">id</span><span class="p">,</span>
                        <span class="nl">messageid:</span> <span class="n">_mstate_currentuser</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="na">messageid</span><span class="p">,</span>
                        <span class="nl">messageContent:</span>
                            <span class="n">_mstate_currentuser</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="na">messageContent</span><span class="p">,</span>
                        <span class="nl">messageType:</span> <span class="n">_mstate_currentuser</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="na">messageType</span><span class="p">),</span>
                  <span class="p">);</span>
                  <span class="c1">// 수정, 인수로 전달</span>
                <span class="p">},</span>
              <span class="p">),</span>
            <span class="p">),</span>
          <span class="p">),</span>
<span class="p">...</span> <span class="c1">// 생략</span>
</pre></table></code></div></div><p>이제 메세지 로그에 대한 처리는 <code class="language-plaintext highlighter-rouge">messageList.dart</code>에서 할 것이다.</p><h2 id="메세지-로그-저장불러오기-시의-주의-점"><span class="mr-2">메세지 로그 저장/불러오기 시의 주의 점</span><a href="#메세지-로그-저장불러오기-시의-주의-점" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>코드도 정리했고 사용할 기능도 대충 만들었으니 이제 본격적으로 메세지를 저장해보자. 근데 사실… 유저 리스트 저장하는 것과 별 다를 것 없다. (이전 포스팅에서 provider에 대한 걸 다뤘으니 당연히 <code class="language-plaintext highlighter-rouge">/providers/messages.dart</code>가 있고, TypeAdapter가 등록, 범위 지정이 되어있다고 가정한다.) 메세지 로그를 담은 박스의 이름은 <code class="language-plaintext highlighter-rouge">'message_log'</code>인데, provider에서 이 박스를 요리 다루고 조리 다루면 된다. 메세지에 대한 읽기 및 쓰기 작업이 이루어 지는 위젯은 주로 <code class="language-plaintext highlighter-rouge">chatDetailPage.dart</code>과 <code class="language-plaintext highlighter-rouge">messageList.dart</code>일텐데, 필요에 따라</p><div file="/lib/screens/chatDetailPage.dart" class="language-dart highlighter-rouge"><div class="code-header"> <span data-label-text="/lib/screens/chatDetailPage.dart"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="s">'package:flt_simple_chat_ex/providers/messages.dart'</span><span class="o">;</span>
<span class="kn">import</span> <span class="s">'package:provider/provider.dart'</span><span class="o">;</span>
<span class="p">...</span> <span class="c1">// 생략</span>
  <span class="nd">@override</span>
  <span class="n">Widget</span> <span class="n">build</span><span class="p">(</span><span class="n">BuildContext</span> <span class="n">context</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">final</span> <span class="n">_mstate</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">watch</span><span class="p">&lt;</span><span class="n">MessageListPrState</span><span class="p">&gt;()</span><span class="o">.</span><span class="na">messages</span><span class="p">;</span>
    <span class="kd">final</span> <span class="n">_mctlr</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">read</span><span class="p">&lt;</span><span class="n">MessageListController</span><span class="p">&gt;();</span>
<span class="p">...</span> <span class="c1">// 생략</span>
</pre></table></code></div></div><p>이런 식으로 provider에 접근해서 메세지를 읽고 써주면 된다.</p><p>단, 지금 구현한 코드에서 유저 목록을 다룰 때와는 다르게 반드시 고려해야 할 점이 있는데, 바로 유저 목록(<code class="language-plaintext highlighter-rouge">'user_log'</code>박스)은 그 박스 자체로 하나의 개체로 볼 수 있지만, 메세지 로그(<code class="language-plaintext highlighter-rouge">'message_log'</code>박스)의 경우 모든 유저의 메세지를 구별없이 전부 담고 있는 하나의 혼돈의 박스라는 점이다. <br /> 그러니까 각 유저의 채팅 창에는 <code class="language-plaintext highlighter-rouge">'message_log'</code>에 있는 모든 메세지를 전부 출력할게 아니라 그 채팅 창의 유저가 누군지 확인해서 해당 유저와 관련된 메세지만을 표시해야 된다는 소리다. 이걸 위해 <code class="language-plaintext highlighter-rouge">ChatMessage</code> 모델에 <code class="language-plaintext highlighter-rouge">userid</code> 속성을 추가한 것이다. (나도… 아주 이상한 코드라는 건 안다… 알긴 아는데 능력 부족으로 일단 밀고 나갔다)</p><p>개판 5분 전이지만 일단 가보자고…</p><h2 id="해당-유저의-메세지-로그-불러오기"><span class="mr-2">해당 유저의 메세지 로그 불러오기</span><a href="#해당-유저의-메세지-로그-불러오기" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>채팅창을 열었을 때, <code class="language-plaintext highlighter-rouge">checkUserMsg(widget.cpuser.id)</code> 라는 함수를 사용하여 리스트뷰를 빌드했다.<br /> messages provider의 <code class="language-plaintext highlighter-rouge">MessageListPrState</code>에 <code class="language-plaintext highlighter-rouge">checkUserMsg</code>라는 함수를 만들어서 현재 열어둔 채팅창의 userid를 가진 메세지들만으로만 구성된 리스트를 반환하도록 해주었다. (<code class="language-plaintext highlighter-rouge">MessageListPrState</code>에 구현한 이유는, 딱히 데이터베이스에 항목을 추가하거나 삭제하는게 아니고 단지 선별해서 읽어올 뿐이기 때문)</p><div file="/lib/screen/ChatDetailPage.dart" class="language-dart highlighter-rouge"><div class="code-header"> <span data-label-text="/lib/screen/ChatDetailPage.dart"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre><span class="p">...</span> <span class="c1">// 생략</span>
    <span class="kd">final</span> <span class="n">_mstate_currentuser</span> <span class="o">=</span>
        <span class="n">context</span><span class="o">.</span><span class="na">watch</span><span class="p">&lt;</span><span class="n">MessageListPrState</span><span class="p">&gt;()</span><span class="o">.</span><span class="na">checkUserMsg</span><span class="p">(</span><span class="n">widget</span><span class="o">.</span><span class="na">cpuser</span><span class="o">.</span><span class="na">id</span><span class="p">);</span>
<span class="p">...</span> <span class="c1">// 생략</span>
      <span class="nl">body:</span> <span class="n">Column</span><span class="p">(</span>
        <span class="nl">children:</span> <span class="p">&lt;</span><span class="n">Widget</span><span class="p">&gt;[</span>
          <span class="n">Flexible</span><span class="p">(</span>
            <span class="nl">fit:</span> <span class="n">FlexFit</span><span class="o">.</span><span class="na">tight</span><span class="p">,</span>
            <span class="nl">child:</span> <span class="n">SingleChildScrollView</span><span class="p">(</span>
              <span class="nl">physics:</span> <span class="n">BouncingScrollPhysics</span><span class="p">(),</span>
              <span class="nl">controller:</span> <span class="n">_scrollController</span><span class="p">,</span>
              <span class="nl">child:</span> <span class="n">ListView</span><span class="o">.</span><span class="na">builder</span><span class="p">(</span>
                <span class="nl">itemCount:</span> <span class="n">_mstate_currentuser</span><span class="o">.</span><span class="na">length</span><span class="p">,</span> <span class="c1">// 수정</span>
                <span class="nl">shrinkWrap:</span> <span class="kc">true</span><span class="p">,</span>
                <span class="nl">padding:</span> <span class="n">EdgeInsets</span><span class="o">.</span><span class="na">only</span><span class="p">(</span>
                    <span class="nl">top:</span> <span class="mi">10</span><span class="p">),</span>
                <span class="nl">physics:</span> <span class="n">NeverScrollableScrollPhysics</span><span class="p">(),</span>
                <span class="nl">itemBuilder:</span> <span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span> <span class="p">{</span>
                  <span class="k">return</span> <span class="n">MessageList</span><span class="p">(</span>
                    <span class="nl">userid:</span> <span class="n">widget</span><span class="o">.</span><span class="na">cpuser</span><span class="o">.</span><span class="na">id</span><span class="p">,</span>
                    <span class="nl">currentmsg:</span> <span class="n">ChatMessage</span><span class="p">(</span>
                        <span class="nl">userid:</span> <span class="n">widget</span><span class="o">.</span><span class="na">cpuser</span><span class="o">.</span><span class="na">id</span><span class="p">,</span>
                        <span class="nl">messageid:</span> <span class="n">_mstate_currentuser</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="na">messageid</span><span class="p">,</span> <span class="c1">// 수정</span>
                        <span class="nl">messageContent:</span>
                            <span class="n">_mstate_currentuser</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="na">messageContent</span><span class="p">,</span> <span class="c1">// 수정</span>
                        <span class="nl">messageType:</span> <span class="n">_mstate_currentuser</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="na">messageType</span><span class="p">),</span> <span class="c1">// 수정</span>
                  <span class="p">);</span>
                <span class="p">},</span>
              <span class="p">),</span>
            <span class="p">),</span>
          <span class="p">),</span> <span class="c1">// Flexible</span>
<span class="p">...</span> <span class="c1">// 생략</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">checkUserMsg()</code>는 이렇게 생겼다.</p><div file="/lib/provider/messages.dart" class="language-dart highlighter-rouge"><div class="code-header"> <span data-label-text="/lib/provider/messages.dart"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="p">...</span> <span class="c1">// 생략</span>
<span class="kd">class</span> <span class="nc">MessageListPrState</span> <span class="p">{</span>
<span class="p">...</span> <span class="c1">// 생략</span>
  <span class="kt">List</span><span class="p">&lt;</span><span class="n">ChatMessage</span><span class="p">&gt;</span> <span class="n">checkUserMsg</span><span class="p">(</span><span class="kt">String</span> <span class="n">userid</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">List</span><span class="p">&lt;</span><span class="n">ChatMessage</span><span class="p">&gt;</span> <span class="n">usermsg</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">messages</span><span class="o">.</span><span class="na">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">messages</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="na">userid</span> <span class="o">==</span> <span class="n">userid</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">usermsg</span><span class="o">.</span><span class="na">insert</span><span class="p">(</span><span class="n">usermsg</span><span class="o">.</span><span class="na">length</span><span class="p">,</span> <span class="n">messages</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">usermsg</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">...</span> <span class="c1">// 생략</span>
</pre></table></code></div></div><p>이렇게하면 최적화는 개나 준 코드 완성!</p><p>유저가 생길 때마다 메세지 박스를 열어 준 다음, ChatDetailPage에 접근하면 그 박스를 던져주고 연산 없이 읽고 쓸 수 있게 해줘야 한다… 는 걸 머리로는 알고 있지만, 그냥 코드가 생겨 먹은 대로 쓰려고 짱구를 굴리다 보니 이런 요오상한 코드가 탄생했다.</p><p>사실 그렇게 해주려고 이것저것 찾아보고 provider안에서 openBox해주도록 짜봤는데, provider의 Scope를 거의 최상위 위젯으로 두고 있어서, openBox하는 타이밍이 main()이 아니면 에러가… ㅎ…<br /> 원하는 기능이 그럴 듯하게 구현이 되기는 했지만, 이건 너무 눈가리고 아웅하는 식이라 hive를 좀 더 동적으로 다룰 수 있는 방법이 있나 찾아보고, 시도해 볼 예정이다. 나의 실력에 RIP,,,</p><h2 id="메세지-로그-저장"><span class="mr-2">메세지 로그 저장</span><a href="#메세지-로그-저장" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><code class="language-plaintext highlighter-rouge">ChatDetailPage</code>에서 <code class="language-plaintext highlighter-rouge">send</code> 버튼을 누를 때, <code class="language-plaintext highlighter-rouge">addMessage(newMsg)</code> 라는 함수를 실행</p><div file="/lib/screen/ChatDetailPage.dart" class="language-dart highlighter-rouge"><div class="code-header"> <span data-label-text="/lib/screen/ChatDetailPage.dart"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre><td class="rouge-code"><pre><span class="p">...</span> <span class="c1">// 생략</span>
                    <span class="n">SizedBox</span><span class="p">(</span>
                      <span class="nl">height:</span> <span class="mi">30</span><span class="p">,</span>
                      <span class="nl">width:</span> <span class="mi">50</span><span class="p">,</span>
                      <span class="nl">child:</span> <span class="n">FloatingActionButton</span><span class="p">(</span>
                        <span class="nl">heroTag:</span> <span class="s">"btn_send"</span><span class="p">,</span> 
                        <span class="nl">onPressed:</span> <span class="p">()</span> <span class="p">{</span>
                          <span class="k">if</span> <span class="p">(</span><span class="n">msgtextController</span><span class="o">.</span><span class="na">text</span><span class="o">.</span><span class="na">isNotEmpty</span><span class="p">)</span> <span class="p">{</span>
                            <span class="n">ChatMessage</span> <span class="n">newMsg</span> <span class="o">=</span> <span class="n">ChatMessage</span><span class="p">(</span>
                                <span class="nl">userid:</span> <span class="n">widget</span><span class="o">.</span><span class="na">cpuser</span><span class="o">.</span><span class="na">id</span><span class="p">,</span>
                                <span class="nl">messageContent:</span> <span class="n">msgtextController</span><span class="o">.</span><span class="na">text</span><span class="p">,</span>
                                <span class="nl">messageType:</span> <span class="s">"sender"</span><span class="p">);</span>
                            <span class="n">debugPrint</span><span class="p">(</span><span class="s">'Input text : </span><span class="si">${newMsg.messageContent}</span><span class="s">'</span><span class="p">);</span>
                            <span class="n">setState</span><span class="p">(()</span> <span class="p">{</span>
                              <span class="n">_mctlr</span><span class="o">.</span><span class="na">addMessage</span><span class="p">(</span><span class="n">newMsg</span><span class="p">);</span> <span class="c1">// 추가</span>
                              <span class="n">msgtextController</span><span class="o">.</span><span class="na">clear</span><span class="p">();</span>
                              <span class="n">latest_msg</span> <span class="o">=</span> <span class="n">msgtextController</span><span class="o">.</span><span class="na">text</span><span class="p">;</span>
                            <span class="p">});</span>
                            <span class="n">_scrollToLatest</span><span class="p">();</span>
                          <span class="p">}</span>
                        <span class="p">},</span>
                        <span class="nl">child:</span> <span class="n">Icon</span><span class="p">(</span>
                          <span class="n">Icons</span><span class="o">.</span><span class="na">send</span><span class="p">,</span>
                          <span class="nl">color:</span> <span class="n">Colors</span><span class="o">.</span><span class="na">white</span><span class="p">,</span>
                          <span class="nl">size:</span> <span class="mi">18</span><span class="p">,</span>
                        <span class="p">),</span>
                        <span class="nl">backgroundColor:</span> <span class="n">Colors</span><span class="o">.</span><span class="na">blue</span><span class="p">,</span>
                        <span class="nl">elevation:</span> <span class="mi">0</span><span class="p">,</span>
                      <span class="p">),</span>
                    <span class="p">),</span>
<span class="p">...</span> <span class="c1">// 생략</span>
</pre></table></code></div></div><p>messages provider <code class="language-plaintext highlighter-rouge">MessageListController</code>의 <code class="language-plaintext highlighter-rouge">addMessage</code>함수는 이렇게 생겼다. (이건 그냥 <code class="language-plaintext highlighter-rouge">addUser</code>와 똑같이 생겼음)</p><div file="/lib/provider/messages.dart" class="language-dart highlighter-rouge"><div class="code-header"> <span data-label-text="/lib/provider/messages.dart"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="p">...</span> <span class="c1">// 생략</span>
  <span class="kt">void</span> <span class="n">addMessage</span><span class="p">(</span><span class="n">ChatMessage</span> <span class="n">message</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">final</span> <span class="n">_messages</span> <span class="o">=</span> <span class="p">[..</span><span class="o">.</span><span class="na">state</span><span class="o">.</span><span class="na">messages</span><span class="p">,</span> <span class="n">message</span><span class="p">];</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="na">copyWith</span><span class="p">(</span><span class="nl">messages:</span> <span class="n">_messages</span><span class="p">);</span>
    <span class="n">messageList</span><span class="o">!.</span><span class="na">put</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="na">messageid</span><span class="p">,</span> <span class="n">message</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">...</span> <span class="c1">// 생략</span>
</pre></table></code></div></div><p>기본적인 읽기, 쓰기기는 이렇다. 여기까지 했으면, (비록 효율적이지는 않지만) 유저 별로 메세지의 저장이 가능한 기본적인 기능을 하는 것처럼 보이는 채팅앱이 완성된다.</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30% 30%'%3E%3C/svg%3E" data-src="/assets/img/2022-09-20-Flutter-Simple-Chat-UI-EX03/SimulSc_ex_03-04.gif" alt="Flutter Simple chat UI ex 03-04" width="30%" height="30%" data-proofer-ignore></p><p>(데모에서는 <code class="language-plaintext highlighter-rouge">ChatPage</code>로 돌아갔을 때, 유저 이름 밑에 유저와의 마지막 메세지가 표시되도록 하고 있는데, 이에 대해서는 이 포스팅 마지막 장에 기술)</p><h2 id="ui-변경-기능-추가-옵션"><span class="mr-2">UI 변경, 기능 추가 (옵션)</span><a href="#ui-변경-기능-추가-옵션" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>이번 장은 그냥 나 편하자고 이하의 UI 변경, 기능 추가를 한 내용이다.</p><ul><li>받은 메세지 조작 : receiver 버튼, 기능 추가<li>메세지 초기화 : clear 버튼, 기능 추가<li>개별 메세지에 대한 기능 추가 (개별 메세지 복사, 수정, 삭제)</ul><h3 id="받은-메세지-조작--receiver-버튼-기능-추가"><span class="mr-2">받은 메세지 조작 : receiver 버튼, 기능 추가</span><a href="#받은-메세지-조작--receiver-버튼-기능-추가" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>원래는 내가 보내는 버튼만 있는게 맞지만, 여기서는 그럴듯하게 채팅창을 모방하기 위해 내가 받는 메세지도 조작할 수 있도록 <code class="language-plaintext highlighter-rouge">send</code>버튼 왼쪽 옆에 <code class="language-plaintext highlighter-rouge">receive</code>버튼을 하나 더 추가해 주었다. 텍스트 필드에 글을 입력하고 <code class="language-plaintext highlighter-rouge">receive</code>버튼을 누르면 해당 메세지가 나에게 온 메세지처럼 표시하는 기능을 한다.</p><p>기본적으로는 <code class="language-plaintext highlighter-rouge">send</code>버튼의 포멧을 그대로 사용하고, 전달하는 <code class="language-plaintext highlighter-rouge">messageType</code>을 <code class="language-plaintext highlighter-rouge">receiver</code> 해주면 된다. (+ Icon 변경)</p><div file="/lib/screens/chatDetailPage.dart" class="language-dart highlighter-rouge"><div class="code-header"> <span data-label-text="/lib/screens/chatDetailPage.dart"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre><td class="rouge-code"><pre><span class="p">...</span> <span class="c1">// 생략</span>
                    <span class="n">SizedBox</span><span class="p">(</span>
                      <span class="nl">height:</span> <span class="mi">30</span><span class="p">,</span>
                      <span class="nl">width:</span> <span class="mi">50</span><span class="p">,</span>
                      <span class="nl">child:</span> <span class="n">FloatingActionButton</span><span class="p">(</span>
                        <span class="nl">heroTag:</span> <span class="s">"btn_receive"</span><span class="p">,</span> <span class="c1">//heroTag 중복에러 방지 (heroTag: null도 가능)</span>
                        <span class="nl">onPressed:</span> <span class="p">()</span> <span class="p">{</span>
                          <span class="k">if</span> <span class="p">(</span><span class="n">msgtextController</span><span class="o">.</span><span class="na">text</span><span class="o">.</span><span class="na">isNotEmpty</span><span class="p">)</span> <span class="p">{</span>
                            <span class="n">ChatMessage</span> <span class="n">newMsg</span> <span class="o">=</span> <span class="n">ChatMessage</span><span class="p">(</span>
                                <span class="nl">userid:</span> <span class="n">widget</span><span class="o">.</span><span class="na">cpuser</span><span class="o">.</span><span class="na">id</span><span class="p">,</span>
                                <span class="nl">messageContent:</span> <span class="n">msgtextController</span><span class="o">.</span><span class="na">text</span><span class="p">,</span>
                                <span class="nl">messageType:</span> <span class="s">"receiver"</span><span class="p">);</span> <span class="c1">//수정</span>
                            <span class="n">setState</span><span class="p">(()</span> <span class="p">{</span>
                              <span class="n">_mctlr</span><span class="o">.</span><span class="na">addMessage</span><span class="p">(</span><span class="n">newMsg</span><span class="p">);</span>
                              <span class="n">msgtextController</span>
                                  <span class="o">.</span><span class="na">clear</span><span class="p">();</span> 
                              <span class="n">latest_msg</span> <span class="o">=</span> <span class="n">msgtextController</span><span class="o">.</span><span class="na">text</span><span class="p">;</span>
                            <span class="p">});</span>
                            <span class="n">_scrollToLatest</span><span class="p">();</span> 
                          <span class="p">}</span>
                        <span class="p">},</span>
                        <span class="nl">child:</span> <span class="n">Icon</span><span class="p">(</span>
                          <span class="n">Icons</span><span class="o">.</span><span class="na">send_outlined</span><span class="p">,</span>
                          <span class="nl">color:</span> <span class="n">Colors</span><span class="o">.</span><span class="na">white</span><span class="p">,</span>
                          <span class="nl">size:</span> <span class="mi">18</span><span class="p">,</span>
                        <span class="p">),</span>
                        <span class="nl">backgroundColor:</span> <span class="n">Colors</span><span class="o">.</span><span class="na">blue</span><span class="p">,</span>
                        <span class="nl">elevation:</span> <span class="mi">0</span><span class="p">,</span>
                      <span class="p">),</span>
                    <span class="p">),</span>
<span class="p">...</span> <span class="c1">// 생략</span>
</pre></table></code></div></div><p>만약 receiver버튼 추가하고 이런 에러가 난다면,</p><pre><code class="language-error">════════ Exception caught by scheduler library ═════════════════════════════════
The following assertion was thrown during a scheduler callback:
There are multiple heroes that share the same tag within a subtree.

Within each subtree for which heroes are to be animated (i.e. a PageRoute subtree), each Hero must have a unique non-null tag.
In this case, multiple heroes had the following tag: &lt;default FloatingActionButton tag&gt;
Here is the subtree for one of the offending heroes: Hero
    tag: &lt;default FloatingActionButton tag&gt;
    state: _HeroState#a0c4c
</code></pre><p><code class="language-plaintext highlighter-rouge">heroTag</code>를 설정하지 않은 <code class="language-plaintext highlighter-rouge">FloatingActionButton</code>이 같은 위젯에 여러개 있어서 그런 것이니, 각 <code class="language-plaintext highlighter-rouge">FloatingActionButton</code>위젯에 <code class="language-plaintext highlighter-rouge">herotag</code>를 설정해 주자. (모든 <code class="language-plaintext highlighter-rouge">FloatingActionButton</code>에 <code class="language-plaintext highlighter-rouge">heroTag: null</code>이라고 해줘도 되긴 됨)</p><p>결과, 이러한 UI 된다. 왼쪽 버튼을 누르면 내가 받은 메세지가 되고, 오른쪽 버튼을 누르면 내가 보낸 메세지가 된다.</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 50% 50%'%3E%3C/svg%3E" data-src="/assets/img/2022-09-20-Flutter-Simple-Chat-UI-EX03/SimulSc_ex_03-01.png" alt="Flutter Simple chat UI ex 03-01" width="50%" height="50%" data-proofer-ignore></p><h3 id="메세지-초기화--clear-버튼-기능-추가"><span class="mr-2">메세지 초기화 : clear 버튼, 기능 추가</span><a href="#메세지-초기화--clear-버튼-기능-추가" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><code class="language-plaintext highlighter-rouge">ChatPage</code>의 유저 목록 Clear와 마찬가지로 <code class="language-plaintext highlighter-rouge">AppBar</code>에 메세지 로그의 모든 메세지을 지우는 버튼을 추가했다. (+덤으로 설정 버튼이 그냥 <code class="language-plaintext highlighter-rouge">Icon</code>으로만 되어있길래 누를 수 있도록 <code class="language-plaintext highlighter-rouge">IconButton</code>으로 변경해 주었음, 기능은 추가X)</p><div file="/lib/screens/chatDetailPage.dart" class="language-dart highlighter-rouge"><div class="code-header"> <span data-label-text="/lib/screens/chatDetailPage.dart"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="p">...</span> <span class="c1">// 생략</span>
    <span class="kd">final</span> <span class="n">_mctlr</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">read</span><span class="p">&lt;</span><span class="n">MessageListController</span><span class="p">&gt;();</span>
<span class="p">...</span> <span class="c1">// 생략</span>
                <span class="n">IconButton</span><span class="p">(</span> <span class="c1">// 메세지 로그 Clear</span>
                  <span class="nl">onPressed:</span> <span class="p">()</span> <span class="p">{</span>
                    <span class="n">print</span><span class="p">(</span><span class="s">"Click Clear Button"</span><span class="p">);</span>
                    <span class="n">_mctlr</span><span class="o">.</span><span class="na">clearUserMsg</span><span class="p">(</span><span class="n">widget</span><span class="o">.</span><span class="na">cpuser</span><span class="o">.</span><span class="na">id</span><span class="p">);</span> <span class="c1">//추가</span>
                  <span class="p">},</span>
                  <span class="nl">alignment:</span> <span class="n">Alignment</span><span class="o">.</span><span class="na">centerRight</span><span class="p">,</span>
                  <span class="nl">icon:</span> <span class="kd">const</span> <span class="n">Icon</span><span class="p">(</span>
                    <span class="n">Icons</span><span class="o">.</span><span class="na">clear_all</span><span class="p">,</span>
                    <span class="nl">color:</span> <span class="n">Colors</span><span class="o">.</span><span class="na">black</span><span class="p">,</span>
                  <span class="p">),</span>
                <span class="p">),</span>
                <span class="n">IconButton</span><span class="p">(</span> <span class="c1">// Setting</span>
                  <span class="nl">onPressed:</span> <span class="p">()</span> <span class="p">{</span>
                    <span class="n">print</span><span class="p">(</span><span class="s">"Click Setting Button"</span><span class="p">);</span>
                  <span class="p">},</span>
                  <span class="nl">alignment:</span> <span class="n">Alignment</span><span class="o">.</span><span class="na">centerRight</span><span class="p">,</span>
                  <span class="nl">icon:</span> <span class="kd">const</span> <span class="n">Icon</span><span class="p">(</span>
                    <span class="n">Icons</span><span class="o">.</span><span class="na">settings</span><span class="p">,</span>
                    <span class="nl">color:</span> <span class="n">Colors</span><span class="o">.</span><span class="na">black54</span><span class="p">,</span>
                  <span class="p">),</span>
                <span class="p">),</span>
<span class="p">...</span> <span class="c1">// 생략</span>
</pre></table></code></div></div><p>추가 후의 UI는 이런 모습.</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 50% 50%'%3E%3C/svg%3E" data-src="/assets/img/2022-09-20-Flutter-Simple-Chat-UI-EX03/SimulSc_ex_03-02.png" alt="Flutter Simple chat UI ex 03-02" width="50%" height="50%" data-proofer-ignore></p><p>기능 구현을 위해서 message provider(<code class="language-plaintext highlighter-rouge">/providers/messages.dart</code>)의 <code class="language-plaintext highlighter-rouge">MessageListController</code>에 <code class="language-plaintext highlighter-rouge">clearUserMsg</code> 라는 함수를 추가해 주었다. 동작방식은 <code class="language-plaintext highlighter-rouge">userid</code>를 인수로 받아, 기존의 메세지 리스트(<code class="language-plaintext highlighter-rouge">messages</code>)에서 <code class="language-plaintext highlighter-rouge">userid</code>를 가진 메세지를 솎아낸 메세지 리스트를 만들어(<code class="language-plaintext highlighter-rouge">_messages</code>), 기존의 메세지 리스트(<code class="language-plaintext highlighter-rouge">messages</code>)를 해당 메세지 리스트(<code class="language-plaintext highlighter-rouge">_messages</code>)로 교체하는 것이다. <br /> hive box에서의 삭제는 좀 더 쉽다. <code class="language-plaintext highlighter-rouge">.delete</code>함수를 사용하여 <code class="language-plaintext highlighter-rouge">userid</code>를 가진 개체를 지워주면 된다.</p><div file="/lib/providers/messages.dart" class="language-dart highlighter-rouge"><div class="code-header"> <span data-label-text="/lib/providers/messages.dart"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="p">...</span> <span class="c1">// 생략</span>

  <span class="kt">void</span> <span class="n">clearUserMsg</span><span class="p">(</span><span class="kt">String</span> <span class="n">userid</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">final</span> <span class="n">_messages</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="na">messages</span><span class="o">.</span><span class="na">where</span><span class="p">((</span><span class="n">m</span><span class="p">)</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">m</span><span class="o">.</span><span class="na">userid</span> <span class="o">!=</span> <span class="n">userid</span><span class="p">)</span><span class="o">.</span><span class="na">toList</span><span class="p">();</span>

    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="na">copyWith</span><span class="p">(</span><span class="nl">messages:</span> <span class="n">_messages</span><span class="p">);</span>
    <span class="n">messageList</span><span class="o">!.</span><span class="na">delete</span><span class="p">(</span><span class="n">userid</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">...</span> <span class="c1">// 생략</span>
</pre></table></code></div></div><p>위의 두 기능에 대한 데모. 잘 구현되었다는 걸 확인할 수 있다.</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30% 30%'%3E%3C/svg%3E" data-src="/assets/img/2022-09-20-Flutter-Simple-Chat-UI-EX03/SimulSc_ex_03-03.gif" alt="Flutter Simple chat UI ex 03-03" width="30%" height="30%" data-proofer-ignore></p><h3 id="개별-메세지에-대한-기능-추가-개별-메세지-복사-수정-삭제"><span class="mr-2">개별 메세지에 대한 기능 추가 (개별 메세지 복사, 수정, 삭제)</span><a href="#개별-메세지에-대한-기능-추가-개별-메세지-복사-수정-삭제" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>개별 메세지를 롱터치하면 메뉴가 나오고, 메뉴를 통해 해당 메세지를 복사, 수정, 삭제가 가능하도록 기능을 추가했다.</p><p>메세지를 롱터치 했을 때, 메뉴가 나오게 하는 방법은 <a href="https://www.kindacode.com/article/flutter-showing-a-context-menu-on-long-press/">Flutter: Showing a Context Menu on Long Press</a>와 <a href="https://stackoverflow.com/questions/55069228/flutter-popupmenubutton-onlongpressed">stackoverflow</a>의 코드를 참고했다.</p><p>사실 두 사이트에 있는 솔루션 그대로 코드를 작성하면 내가 원하는 대로 움직이지를 않길래 (메뉴 박스가 롱터치한 위치에서 제대로 나오지 않고 x축 또는 y축이 고정되어있었음.. 반쪽짜리 기능 됨) 입맛대로 고쳐서 원하는 대로 움직이게 만들긴 했는데, 얼레벌레 성공해 버려서 솔직히 <a href="https://api.flutter.dev/flutter/rendering/RelativeRect-class.html">RelativeRect</a> 클래스의 동작 방식을 아직 완전히 이해하지는 못했다. 두 사각형을 그려서 상대적인 위치를 계산해 박스를 출력하는것 같긴한데… 나중에 문서 좀 제대로 읽어봐야 겠다. 일단 내가 작성한 얼레벌레 코드는 이렇다.</p><div file="/lib/providers/messages.dart" class="language-dart highlighter-rouge"><div class="code-header"> <span data-label-text="/lib/providers/messages.dart"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
</pre><td class="rouge-code"><pre><span class="p">...</span> <span class="c1">// 생략</span>
<span class="kd">class</span> <span class="nc">_MessageListState</span> <span class="kd">extends</span> <span class="n">State</span><span class="p">&lt;</span><span class="n">MessageList</span><span class="p">&gt;</span> <span class="p">{</span>
<span class="p">...</span> <span class="c1">// 생략</span>
  <span class="n">Offset</span> <span class="n">_tapPosition</span> <span class="o">=</span> <span class="n">Offset</span><span class="o">.</span><span class="na">zero</span><span class="p">;</span>

  <span class="kt">void</span> <span class="n">_getTapPosition</span><span class="p">(</span><span class="n">TapDownDetails</span> <span class="n">details</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">print</span><span class="p">(</span><span class="s">"on Tap Down"</span><span class="p">);</span>
    <span class="kd">final</span> <span class="n">RenderBox</span> <span class="n">referenceBox</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">findRenderObject</span><span class="p">()</span> <span class="k">as</span> <span class="n">RenderBox</span><span class="p">;</span>

    <span class="n">setState</span><span class="p">(()</span> <span class="p">{</span>
      <span class="n">_tapPosition</span> <span class="o">=</span> <span class="n">referenceBox</span><span class="o">.</span><span class="na">globalToLocal</span><span class="p">(</span><span class="n">details</span><span class="o">.</span><span class="na">globalPosition</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="kd">final</span> <span class="n">widgetKey</span> <span class="o">=</span> <span class="n">GlobalKey</span><span class="p">();</span>

  <span class="n">RelativeRect</span> <span class="n">_getRelativeRect</span><span class="p">(</span><span class="n">GlobalKey</span> <span class="n">key</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">RelativeRect</span><span class="o">.</span><span class="na">fromSize</span><span class="p">(</span>
        <span class="n">_getWidgetGlobalRect</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="kd">const</span> <span class="n">Size</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">200</span><span class="p">));</span>
  <span class="p">}</span>

  <span class="n">Rect</span> <span class="n">_getWidgetGlobalRect</span><span class="p">(</span><span class="n">GlobalKey</span> <span class="n">key</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">final</span> <span class="n">RenderBox</span> <span class="n">renderBox</span> <span class="o">=</span>
        <span class="n">key</span><span class="o">.</span><span class="na">currentContext</span><span class="o">!.</span><span class="na">findRenderObject</span><span class="p">()</span> <span class="k">as</span> <span class="n">RenderBox</span><span class="p">;</span>
    <span class="kd">var</span> <span class="n">offset</span> <span class="o">=</span> <span class="n">renderBox</span><span class="o">.</span><span class="na">localToGlobal</span><span class="p">(</span><span class="n">Offset</span><span class="o">.</span><span class="na">zero</span><span class="p">);</span>

    <span class="kd">final</span> <span class="n">RenderObject</span><span class="o">?</span> <span class="n">overlay</span> <span class="o">=</span>
        <span class="n">Overlay</span><span class="o">.</span><span class="na">of</span><span class="p">(</span><span class="n">context</span><span class="p">)</span><span class="o">?.</span><span class="na">context</span><span class="o">.</span><span class="na">findRenderObject</span><span class="p">();</span>

    <span class="k">return</span> <span class="n">Rect</span><span class="o">.</span><span class="na">fromLTWH</span><span class="p">(</span><span class="n">_tapPosition</span><span class="o">.</span><span class="na">dx</span><span class="p">,</span> <span class="n">offset</span><span class="o">.</span><span class="na">dy</span><span class="p">,</span> <span class="n">renderBox</span><span class="o">.</span><span class="na">size</span><span class="o">.</span><span class="na">width</span><span class="p">,</span>
        <span class="n">renderBox</span><span class="o">.</span><span class="na">size</span><span class="o">.</span><span class="na">height</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kt">void</span> <span class="n">_showContextMenu</span><span class="p">(</span><span class="n">BuildContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">GlobalKey</span> <span class="n">key</span><span class="p">)</span> <span class="kd">async</span> <span class="p">{</span>
    <span class="kd">final</span> <span class="n">_mctlr</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">read</span><span class="p">&lt;</span><span class="n">MessageListController</span><span class="p">&gt;();</span> <span class="c1">// 동작 제어를 위해 미리 추가</span>

    <span class="kd">final</span> <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">showMenu</span><span class="p">(</span>
        <span class="nl">context:</span> <span class="n">context</span><span class="p">,</span>
        <span class="nl">position:</span> <span class="n">_getRelativeRect</span><span class="p">(</span><span class="n">key</span><span class="p">),</span>
        <span class="nl">items:</span> <span class="p">[</span>
          <span class="kd">const</span> <span class="n">PopupMenuItem</span><span class="p">(</span>
            <span class="nl">value:</span> <span class="s">'copy'</span><span class="p">,</span>
            <span class="nl">child:</span> <span class="n">Text</span><span class="p">(</span><span class="s">'Copy Text'</span><span class="p">),</span>
          <span class="p">),</span>
          <span class="kd">const</span> <span class="n">PopupMenuItem</span><span class="p">(</span>
            <span class="nl">value:</span> <span class="s">'edit'</span><span class="p">,</span>
            <span class="nl">child:</span> <span class="n">Text</span><span class="p">(</span><span class="s">'Edit Text'</span><span class="p">),</span>
          <span class="p">),</span>
          <span class="kd">const</span> <span class="n">PopupMenuItem</span><span class="p">(</span>
            <span class="nl">value:</span> <span class="s">'delete'</span><span class="p">,</span>
            <span class="nl">child:</span> <span class="n">Text</span><span class="p">(</span><span class="s">'Delete Text'</span><span class="p">),</span>
          <span class="p">),</span>
        <span class="p">]);</span>

    <span class="k">switch</span> <span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">case</span> <span class="s">'copy'</span><span class="o">:</span>
        <span class="n">debugPrint</span><span class="p">(</span><span class="s">'Copy Text'</span><span class="p">);</span>
        <span class="c1">// 복사 동작 추가 부분</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span> <span class="s">'edit'</span><span class="o">:</span>
        <span class="n">debugPrint</span><span class="p">(</span><span class="s">'Edit Text'</span><span class="p">);</span>
        <span class="c1">// 수정 동작 추가 부분</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span> <span class="s">'delete'</span><span class="o">:</span>
        <span class="n">debugPrint</span><span class="p">(</span><span class="s">'Delete Text'</span><span class="p">);</span>
        <span class="c1">// 삭제 동작 추가 부분</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nd">@override</span>
  <span class="n">Widget</span> <span class="n">build</span><span class="p">(</span><span class="n">BuildContext</span> <span class="n">context</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">GestureDetector</span><span class="p">(</span>
      <span class="c1">// 추가</span>
      <span class="nl">key:</span> <span class="n">widgetKey</span><span class="p">,</span>
      <span class="nl">onTapDown:</span> <span class="p">(</span><span class="n">details</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">_getTapPosition</span><span class="p">(</span><span class="n">details</span><span class="p">);</span> 
      <span class="p">},</span>
      <span class="nl">onLongPress:</span> <span class="p">()</span> <span class="p">{</span>
        <span class="n">_showContextMenu</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">widgetKey</span><span class="p">);</span>
      <span class="p">},</span>
      <span class="c1">// 추가 END</span>
      <span class="nl">child:</span> <span class="n">Container</span><span class="p">(</span>
<span class="p">...</span> <span class="c1">// 생략</span>
</pre></table></code></div></div><h4 id="복사"><span class="mr-2">복사</span><a href="#복사" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><code class="language-plaintext highlighter-rouge">services.dart</code> 라는 패키지의 <code class="language-plaintext highlighter-rouge">Clipboard.setData()</code>라는 함수를 통해서 쉽게 구현할 수 있다.</p><div file="/lib/widgets/messageList.dart" class="language-dart highlighter-rouge"><div class="code-header"> <span data-label-text="/lib/widgets/messageList.dart"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="p">...</span> <span class="c1">// 생략</span>
<span class="kn">import</span> <span class="s">'package:flutter/services.dart'</span><span class="o">;</span> <span class="c1">// 추가</span>
<span class="p">...</span> <span class="c1">// 생략</span>
  <span class="kt">void</span> <span class="n">_showContextMenu</span><span class="p">(</span><span class="n">BuildContext</span> <span class="n">context</span><span class="p">)</span> <span class="kd">async</span> <span class="p">{</span>
<span class="p">...</span> <span class="c1">// 생략</span>
    <span class="k">switch</span> <span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">case</span> <span class="s">'copy'</span><span class="o">:</span>
        <span class="n">debugPrint</span><span class="p">(</span><span class="s">'Copy Text'</span><span class="p">);</span>
        <span class="n">Clipboard</span><span class="o">.</span><span class="na">setData</span><span class="p">(</span><span class="n">ClipboardData</span><span class="p">(</span><span class="nl">text:</span> <span class="n">widget</span><span class="o">.</span><span class="na">currentmsg</span><span class="o">.</span><span class="na">messageContent</span><span class="p">));</span> <span class="c1">// 추가</span>
        <span class="k">break</span><span class="p">;</span>
<span class="p">...</span> <span class="c1">// 생략</span>
</pre></table></code></div></div><h4 id="수정"><span class="mr-2">수정</span><a href="#수정" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>먼저 message provider <code class="language-plaintext highlighter-rouge">MessageListController</code>에 <code class="language-plaintext highlighter-rouge">editMessage()</code>라는 함수를 작성해 주었다. 버튼이 눌리면 텍스트를 수정할 수 있는 팝업을 실행(<code class="language-plaintext highlighter-rouge">InputDialog</code>), 팝업창에서 텍스트의 수정이 발생한 경우, <code class="language-plaintext highlighter-rouge">editMessage()</code>함수를 실행해 주었다.</p><div file="/lib/widgets/messageList.dart" class="language-dart highlighter-rouge"><div class="code-header"> <span data-label-text="/lib/widgets/messageList.dart"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre><td class="rouge-code"><pre><span class="p">...</span> <span class="c1">// 생략</span>
  <span class="kt">void</span> <span class="n">_showContextMenu</span><span class="p">(</span><span class="n">BuildContext</span> <span class="n">context</span><span class="p">)</span> <span class="kd">async</span> <span class="p">{</span>
    <span class="kd">final</span> <span class="n">_mctlr</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">read</span><span class="p">&lt;</span><span class="n">MessageListController</span><span class="p">&gt;();</span>
<span class="p">...</span> <span class="c1">// 생략</span>
    <span class="k">switch</span> <span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="p">{</span>
<span class="p">...</span> <span class="c1">// 생략</span>
      <span class="k">case</span> <span class="s">'edit'</span><span class="o">:</span>
        <span class="n">debugPrint</span><span class="p">(</span><span class="s">'Edit Text'</span><span class="p">);</span>
        <span class="kt">String</span><span class="o">?</span> <span class="n">inputtext</span> <span class="o">=</span> <span class="k">await</span> <span class="n">InputDialog</span><span class="p">(</span><span class="n">context</span><span class="p">);</span>
        <span class="n">_textFieldController</span><span class="o">.</span><span class="na">clear</span><span class="p">();</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">inputtext</span> <span class="o">==</span> <span class="s">""</span> <span class="o">||</span>
            <span class="n">inputtext</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span>
            <span class="n">inputtext</span> <span class="o">==</span> <span class="n">widget</span><span class="o">.</span><span class="na">currentmsg</span><span class="o">.</span><span class="na">messageContent</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">print</span><span class="p">(</span><span class="s">"Text not changed!"</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="kt">String</span> <span class="n">edittext</span> <span class="o">=</span> <span class="n">inputtext</span><span class="p">;</span>
          <span class="n">_mctlr</span><span class="o">.</span><span class="na">editMessage</span><span class="p">(</span><span class="n">widget</span><span class="o">.</span><span class="na">currentmsg</span><span class="p">,</span> <span class="n">edittext</span><span class="p">);</span>
          <span class="n">setState</span><span class="p">(()</span> <span class="p">{</span>
            <span class="n">widget</span><span class="o">.</span><span class="na">currentmsg</span><span class="o">.</span><span class="na">messageContent</span> <span class="o">=</span> <span class="n">edittext</span><span class="p">;</span> <span class="c1">//화면에서도 곧 바로 수정</span>
          <span class="p">});</span>
        <span class="p">}</span>
        <span class="k">break</span><span class="p">;</span>
<span class="p">...</span> <span class="c1">// 생략</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">InputDialog()</code>함수는 별다를 것 없이 생겼는데, 이번에는 기존의 텍스트를 수정하는 거니까 텍스트 필드에 기존에 메세지 내용이 디폴트로 들어가 있고 그것을 수정하도록 <code class="language-plaintext highlighter-rouge">TextEditingController</code>의 포멧을 조금 변경해 주었다.</p><div file="/lib/widgets/messageList.dart" class="language-dart highlighter-rouge"><div class="code-header"> <span data-label-text="/lib/widgets/messageList.dart"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
</pre><td class="rouge-code"><pre><span class="p">...</span> <span class="c1">// 생략</span>
<span class="kd">class</span> <span class="nc">_MessageListState</span> <span class="kd">extends</span> <span class="n">State</span><span class="p">&lt;</span><span class="n">MessageList</span><span class="p">&gt;</span> <span class="p">{</span>
  <span class="kd">late</span> <span class="n">TextEditingController</span> <span class="n">_textFieldController</span><span class="p">;</span>

  <span class="nd">@override</span>
  <span class="kt">void</span> <span class="n">initState</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">super</span><span class="o">.</span><span class="na">initState</span><span class="p">();</span>
    <span class="n">_textFieldController</span> <span class="o">=</span> <span class="n">TextEditingController</span><span class="p">(</span>
        <span class="nl">text:</span> <span class="n">widget</span><span class="o">.</span><span class="na">currentmsg</span><span class="o">.</span><span class="na">messageContent</span><span class="p">);</span> <span class="c1">// 기존 텍스트가 텍스트필드의 초기값</span>
  <span class="p">}</span>

  <span class="n">Future</span><span class="p">&lt;</span><span class="kt">String</span><span class="o">?</span><span class="p">&gt;</span> <span class="n">InputDialog</span><span class="p">(</span><span class="n">BuildContext</span> <span class="n">context</span><span class="p">)</span> <span class="kd">async</span> <span class="p">{</span>
    <span class="kd">final</span> <span class="n">ButtonStyle</span> <span class="n">flatButtonStyle</span> <span class="o">=</span> <span class="n">TextButton</span><span class="o">.</span><span class="na">styleFrom</span><span class="p">(</span>
      <span class="nl">backgroundColor:</span> <span class="n">Color</span><span class="o">.</span><span class="na">fromARGB</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">9100</span><span class="p">),</span>
      <span class="nl">padding:</span> <span class="n">EdgeInsets</span><span class="o">.</span><span class="na">all</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
    <span class="p">);</span>
    <span class="n">_textFieldController</span> <span class="o">=</span> <span class="n">TextEditingController</span><span class="p">(</span>
        <span class="nl">text:</span> <span class="n">widget</span><span class="o">.</span><span class="na">currentmsg</span><span class="o">.</span><span class="na">messageContent</span><span class="p">);</span> <span class="c1">// 기존 텍스트가 텍스트필드의 초기값</span>

    <span class="k">return</span> <span class="n">showDialog</span><span class="p">(</span>
        <span class="nl">context:</span> <span class="n">context</span><span class="p">,</span>
        <span class="nl">builder:</span> <span class="p">(</span><span class="n">context</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="n">AlertDialog</span><span class="p">(</span>
            <span class="nl">title:</span> <span class="n">Text</span><span class="p">(</span><span class="s">'메세지 수정'</span><span class="p">),</span>
            <span class="nl">content:</span> <span class="n">TextField</span><span class="p">(</span>
              <span class="nl">controller:</span> <span class="n">_textFieldController</span><span class="p">,</span>
              <span class="nl">decoration:</span>
                  <span class="n">InputDecoration</span><span class="p">(</span><span class="nl">hintText:</span> <span class="n">widget</span><span class="o">.</span><span class="na">currentmsg</span><span class="o">.</span><span class="na">messageContent</span><span class="p">),</span>
            <span class="p">),</span>
            <span class="nl">actions:</span> <span class="p">&lt;</span><span class="n">Widget</span><span class="p">&gt;[</span>
              <span class="n">ElevatedButton</span><span class="p">(</span>
                <span class="nl">child:</span> <span class="kd">const</span> <span class="n">Text</span><span class="p">(</span><span class="s">"취소"</span><span class="p">),</span>
                <span class="nl">onPressed:</span> <span class="p">()</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">Navigator</span><span class="o">.</span><span class="na">pop</span><span class="p">(</span><span class="n">context</span><span class="p">),</span>
              <span class="p">),</span>
              <span class="n">ElevatedButton</span><span class="p">(</span>
                <span class="nl">child:</span> <span class="kd">const</span> <span class="n">Text</span><span class="p">(</span><span class="s">'완료'</span><span class="p">),</span>
                <span class="nl">onPressed:</span> <span class="p">()</span> <span class="o">=</span><span class="p">&gt;</span>
                    <span class="n">Navigator</span><span class="o">.</span><span class="na">pop</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">_textFieldController</span><span class="o">.</span><span class="na">text</span><span class="p">),</span>
              <span class="p">),</span>
            <span class="p">],</span>
          <span class="p">);</span>
        <span class="p">});</span>
  <span class="p">}</span>
<span class="p">...</span> <span class="c1">// 생략</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">editMessage()</code>에서는 <code class="language-plaintext highlighter-rouge">messageid</code>속성을 이용하여 해당 메세지를 식별하여 해당 메세지의 <code class="language-plaintext highlighter-rouge">messageContent</code>를 입력 받은 텍스트로 수정한다.</p><div file="/lib/providers/messages.dart" class="language-dart highlighter-rouge"><div class="code-header"> <span data-label-text="/lib/providers/messages.dart"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="p">...</span> <span class="c1">// 생략</span>
<span class="kd">class</span> <span class="nc">MessageListController</span> <span class="kd">extends</span> <span class="n">StateNotifier</span><span class="p">&lt;</span><span class="n">MessageListPrState</span><span class="p">&gt;</span> <span class="p">{</span>
<span class="p">...</span> <span class="c1">// 생략</span>
  <span class="kt">void</span> <span class="n">editMessage</span><span class="p">(</span><span class="n">ChatMessage</span> <span class="n">message</span><span class="p">,</span> <span class="kt">String</span> <span class="n">edittext</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">index</span> <span class="p">&lt;</span> <span class="p">[..</span><span class="o">.</span><span class="na">state</span><span class="o">.</span><span class="na">messages</span><span class="p">]</span><span class="o">.</span><span class="na">length</span><span class="p">;</span> <span class="n">index</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">([..</span><span class="o">.</span><span class="na">state</span><span class="o">.</span><span class="na">messages</span><span class="p">][</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="na">messageid</span> <span class="o">==</span> <span class="n">message</span><span class="o">.</span><span class="na">messageid</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">[..</span><span class="o">.</span><span class="na">state</span><span class="o">.</span><span class="na">messages</span><span class="p">][</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="na">messageContent</span> <span class="o">=</span> <span class="n">edittext</span><span class="p">;</span>
        <span class="n">messageList</span><span class="o">!.</span><span class="na">put</span><span class="p">(</span>
            <span class="n">message</span><span class="o">.</span><span class="na">messageid</span><span class="p">,</span>
            <span class="n">ChatMessage</span><span class="p">(</span>
                <span class="nl">userid:</span> <span class="n">message</span><span class="o">.</span><span class="na">userid</span><span class="p">,</span>
                <span class="nl">messageid:</span> <span class="n">message</span><span class="o">.</span><span class="na">messageid</span><span class="p">,</span>
                <span class="nl">messageContent:</span> <span class="n">edittext</span><span class="p">,</span>
                <span class="nl">messageType:</span> <span class="n">message</span><span class="o">.</span><span class="na">messageType</span><span class="p">));</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">continue</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

<span class="p">...</span> <span class="c1">// 생략</span>
</pre></table></code></div></div><h4 id="삭제"><span class="mr-2">삭제</span><a href="#삭제" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>message provider <code class="language-plaintext highlighter-rouge">MessageListController</code>에 <code class="language-plaintext highlighter-rouge">deleteMessage()</code>라는 함수를 작성해 주고, 버튼이 눌리면 함수를 실행해 주었다.</p><div file="/lib/widgets/messageList.dart" class="language-dart highlighter-rouge"><div class="code-header"> <span data-label-text="/lib/widgets/messageList.dart"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="p">...</span> <span class="c1">// 생략</span>
  <span class="kt">void</span> <span class="n">_showContextMenu</span><span class="p">(</span><span class="n">BuildContext</span> <span class="n">context</span><span class="p">)</span> <span class="kd">async</span> <span class="p">{</span>
    <span class="kd">final</span> <span class="n">_mctlr</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">read</span><span class="p">&lt;</span><span class="n">MessageListController</span><span class="p">&gt;();</span>
<span class="p">...</span> <span class="c1">// 생략</span>
    <span class="k">switch</span> <span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="p">{</span>
<span class="p">...</span> <span class="c1">// 생략</span>
      <span class="k">case</span> <span class="s">'delete'</span><span class="o">:</span>
        <span class="n">debugPrint</span><span class="p">(</span><span class="s">'Delete Text'</span><span class="p">);</span>
        <span class="n">_mctlr</span><span class="o">.</span><span class="na">deleteMessage</span><span class="p">(</span><span class="n">widget</span><span class="o">.</span><span class="na">currentmsg</span><span class="p">);</span>
        <span class="k">break</span><span class="p">;</span>
<span class="p">...</span> <span class="c1">// 생략</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">deleteMessage()</code>에서는 <code class="language-plaintext highlighter-rouge">messageid</code>속성을 이용하여 해당 메세지만 배제한 메세지 리스트를 만들어낸다.</p><div file="/lib/providers/messages.dart" class="language-dart highlighter-rouge"><div class="code-header"> <span data-label-text="/lib/providers/messages.dart"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="p">...</span> <span class="c1">// 생략</span>
<span class="kd">class</span> <span class="nc">MessageListController</span> <span class="kd">extends</span> <span class="n">StateNotifier</span><span class="p">&lt;</span><span class="n">MessageListPrState</span><span class="p">&gt;</span> <span class="p">{</span>
<span class="p">...</span> <span class="c1">// 생략</span>
  <span class="kt">void</span> <span class="n">deleteMessage</span><span class="p">(</span><span class="n">ChatMessage</span> <span class="n">message</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">final</span> <span class="n">_messages</span> <span class="o">=</span>
        <span class="n">state</span><span class="o">.</span><span class="na">messages</span><span class="o">.</span><span class="na">where</span><span class="p">((</span><span class="n">m</span><span class="p">)</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">m</span><span class="o">.</span><span class="na">messageid</span> <span class="o">!=</span> <span class="n">message</span><span class="o">.</span><span class="na">messageid</span><span class="p">)</span><span class="o">.</span><span class="na">toList</span><span class="p">();</span>

    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="na">copyWith</span><span class="p">(</span><span class="nl">messages:</span> <span class="n">_messages</span><span class="p">);</span>
    <span class="n">messageList</span><span class="o">!.</span><span class="na">delete</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="na">userid</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">...</span> <span class="c1">// 생략</span>
</pre></table></code></div></div><p>이 기능들의 실행 데모는 다음과 같다.</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30% 30%'%3E%3C/svg%3E" data-src="/assets/img/2022-09-20-Flutter-Simple-Chat-UI-EX03/SimulSc_ex_03-05.gif" alt="Flutter Simple chat UI ex 03-05" width="30%" height="30%" data-proofer-ignore></p><h1 id="chatpage--유저-데이터-갱신">ChatPage : 유저 데이터 갱신</h1><h2 id="각-유저의-최근-메세지-표시"><span class="mr-2">각 유저의 최근 메세지 표시</span><a href="#각-유저의-최근-메세지-표시" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>이렇게 유저별 채팅 데이터를 저장해 주면, <code class="language-plaintext highlighter-rouge">ChatPage</code>화면에 출력 되는 각 유저의 최근메세지를 갱신하는 의미가 생긴다. 유저 리스트 UI를 표시하는 <code class="language-plaintext highlighter-rouge">conversationList.dart</code>에서 유저 이름 밑에 표시하는 텍스트를 수정하면 된다.</p><div file="/lib/widget/conversationList.dart" class="language-dart highlighter-rouge"><div class="code-header"> <span data-label-text="/lib/widget/conversationList.dart"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
</pre><td class="rouge-code"><pre><span class="p">...</span> <span class="c1">// 생략</span>
  <span class="n">Widget</span> <span class="n">build</span><span class="p">(</span><span class="n">BuildContext</span> <span class="n">context</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 추가</span>
    <span class="kd">final</span> <span class="n">_mstate_currentuser_len</span> <span class="o">=</span>
        <span class="n">context</span><span class="o">.</span><span class="na">watch</span><span class="p">&lt;</span><span class="n">MessageListPrState</span><span class="p">&gt;()</span><span class="o">.</span><span class="na">checkUserMsg</span><span class="p">(</span><span class="n">widget</span><span class="o">.</span><span class="na">user</span><span class="o">.</span><span class="na">id</span><span class="p">)</span><span class="o">.</span><span class="na">length</span><span class="p">;</span> 
    <span class="kt">bool</span> <span class="n">msgtext_null</span> <span class="o">=</span> <span class="n">_mstate_currentuser_len</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span> 
    <span class="n">widget</span><span class="o">.</span><span class="na">user</span><span class="o">.</span><span class="na">messageText</span> <span class="o">=</span> <span class="n">msgtext_null</span>
        <span class="o">?</span> <span class="s">" "</span>
        <span class="o">:</span> <span class="n">_mstate_currentuser</span><span class="p">[</span><span class="n">_mstate_currentuser_len</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="na">messageContent</span><span class="p">;</span>
    <span class="c1">// 추가 END</span>
    <span class="k">return</span> <span class="n">GestureDetector</span><span class="p">(</span>
      <span class="nl">onTap:</span> <span class="p">()</span> <span class="kd">async</span> <span class="p">{</span>
        <span class="k">await</span> <span class="n">Navigator</span><span class="o">.</span><span class="na">of</span><span class="p">(</span><span class="n">context</span><span class="p">)</span><span class="o">.</span><span class="na">push</span><span class="p">(</span><span class="n">MaterialPageRoute</span><span class="p">(</span>
          <span class="nl">builder:</span> <span class="p">(</span><span class="n">context</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">ChatDetailPage</span><span class="p">(</span>
              <span class="nl">cpuser:</span> <span class="n">widget</span><span class="o">.</span><span class="na">user</span><span class="p">,</span>
            <span class="p">);</span>
          <span class="p">},</span>
        <span class="p">));</span>
        <span class="c1">// 추가</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">mounted</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">setState</span><span class="p">(()</span> <span class="p">{</span>
          <span class="p">});</span>
        <span class="p">}</span>
        <span class="c1">// 추가 END</span>
      <span class="p">},</span>
      <span class="nl">child:</span> <span class="n">Container</span><span class="p">(</span>
        <span class="nl">padding:</span> <span class="n">EdgeInsets</span><span class="o">.</span><span class="na">only</span><span class="p">(</span><span class="nl">left:</span> <span class="mi">16</span><span class="p">,</span> <span class="nl">right:</span> <span class="mi">16</span><span class="p">,</span> <span class="nl">top:</span> <span class="mi">10</span><span class="p">,</span> <span class="nl">bottom:</span> <span class="mi">10</span><span class="p">),</span>
        <span class="nl">child:</span> <span class="n">Row</span><span class="p">(</span>
          <span class="nl">children:</span> <span class="p">&lt;</span><span class="n">Widget</span><span class="p">&gt;[</span>
            <span class="n">Expanded</span><span class="p">(</span>
              <span class="nl">child:</span> <span class="n">Row</span><span class="p">(</span>
                <span class="nl">children:</span> <span class="p">&lt;</span><span class="n">Widget</span><span class="p">&gt;[</span>
                  <span class="n">InkWell</span><span class="p">(</span>
                    <span class="p">...</span> <span class="c1">// 생략</span>
                  <span class="p">),</span>
                  <span class="n">Expanded</span><span class="p">(</span>
                    <span class="nl">child:</span> <span class="n">Container</span><span class="p">(</span>
                      <span class="nl">color:</span> <span class="n">Colors</span><span class="o">.</span><span class="na">transparent</span><span class="p">,</span>
                      <span class="nl">child:</span> <span class="n">Column</span><span class="p">(</span>
                        <span class="nl">crossAxisAlignment:</span> <span class="n">CrossAxisAlignment</span><span class="o">.</span><span class="na">start</span><span class="p">,</span>
                        <span class="nl">children:</span> <span class="p">&lt;</span><span class="n">Widget</span><span class="p">&gt;[</span>
                          <span class="n">Text</span><span class="p">(</span>
                            <span class="n">widget</span><span class="o">.</span><span class="na">user</span><span class="o">.</span><span class="na">name</span><span class="p">,</span>
                            <span class="nl">style:</span> <span class="n">TextStyle</span><span class="p">(</span><span class="nl">fontSize:</span> <span class="mi">16</span><span class="p">),</span>
                          <span class="p">),</span>
                          <span class="n">SizedBox</span><span class="p">(</span>
                            <span class="nl">height:</span> <span class="mi">6</span><span class="p">,</span>
                          <span class="p">),</span>
                          <span class="n">Text</span><span class="p">(</span>
                            <span class="n">widget</span><span class="o">.</span><span class="na">user</span><span class="o">.</span><span class="na">messageText</span><span class="p">,</span> <span class="c1">// &lt;- 여기에 나타다는 글씨를 수정</span>
                            <span class="nl">style:</span> <span class="n">TextStyle</span><span class="p">(</span>
                                <span class="nl">fontSize:</span> <span class="mi">13</span><span class="p">,</span>
                                <span class="nl">color:</span> <span class="n">Colors</span><span class="o">.</span><span class="na">grey</span><span class="o">.</span><span class="na">shade600</span><span class="p">,</span>
                                <span class="nl">fontWeight:</span> <span class="n">widget</span><span class="o">.</span><span class="na">isMessageRead</span>
                                    <span class="o">?</span> <span class="n">FontWeight</span><span class="o">.</span><span class="na">bold</span>
                                    <span class="o">:</span> <span class="n">FontWeight</span><span class="o">.</span><span class="na">normal</span><span class="p">),</span>
                          <span class="p">),</span>
                        <span class="p">],</span>
                      <span class="p">),</span>
                    <span class="p">),</span>
                  <span class="p">),</span>
<span class="p">...</span> <span class="c1">// 생략</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">msgtext_null</code>을 이용한 연산을 굳이 추가한 이유는, 유저를 생성했을 때 예외 처리가 필요하기 때문이다. 유저를 생성한 직 후라면 당연하지만 해당 유저와 관련된 메세지는 없을 것이다. 그러므로 해당 유저에 대한 메세지가 없을 때는, <code class="language-plaintext highlighter-rouge">" "</code>를 넣어 주어서 아무 것도 입력되지 않은 것 처럼 보여주도록 코드를 작성했다. 메세지가 있을 때는, 해당 유저와 나눈 메세지 리스트 중 가장 마지막에 있는 항목을 가져오도록 하면된다.</p><p>또한,<code class="language-plaintext highlighter-rouge">ChatDetailPage</code>에서 마지막 메세지가 수정된 경우에는 <code class="language-plaintext highlighter-rouge">conversationList</code> 위젯도 상태 갱신을 해주어야하기 때문에, <code class="language-plaintext highlighter-rouge">onTap{}</code> 에 <code class="language-plaintext highlighter-rouge">setState()</code>를 추가해 주었다.</p><ul><li><strong>if (mounted) {}</strong> 조건문을 건 이유</ul><p>상태 갱신을 위해서 <code class="language-plaintext highlighter-rouge">setState()</code>만을 추가해 주면, 이런 에러가 뜬다.</p><pre><code class="language-error">[VERBOSE-2:ui_dart_state.cc(198)] Unhandled Exception: setState() called after dispose(): _ConversationListState#8ffd2(lifecycle state: defunct, not mounted)
This error happens if you call setState() on a State object for a widget that no longer appears in the widget tree (e.g., whose parent widget no longer includes the widget in its build). This error can occur when code calls setState() from a timer or an animation callback.
The preferred solution is to cancel the timer or stop listening to the animation in the dispose() callback. Another solution is to check the "mounted" property of this object before calling setState() to ensure the object is still in the tree.
This error might indicate a memory leak if setState() is being called because another object is retaining a reference to this State object after it has been removed from the tree. To avoid memory leaks, consider breaking the reference to this object during dispose().
#0      State.setState.&lt;anonymous closure&gt; (package:flutter/src/widgets&lt;…&gt;
</code></pre><p>내용을 보면 아마 <code class="language-plaintext highlighter-rouge">onTap{}</code>에서 비동기 처리 중에 상태 갱신을 위해 <code class="language-plaintext highlighter-rouge">setState()</code>를 실행 했기 때문에 예외가 발생한 것 같다. 에러에서 <code class="language-plaintext highlighter-rouge">Another solution is to check the "mounted" property of this object before calling setState() to ensure the object is still in the tree.</code>라고 해결책을 주었길래, <code class="language-plaintext highlighter-rouge">mounted</code>를 체크하는 조건문을 추가해 주었더니 에러는 사라졌다. 당장 에러는 사라졌지만 사실 여전히 문제는 남아있고, 더 좋은 해결 방법이 있을 거다… 일단 보류하고 수정하면 포스팅을 업데이트 할 예정.</p><blockquote><p>#수정 보류중인 오류<br /> 메세지를 입력한 후 <code class="language-plaintext highlighter-rouge">ChatPage</code>로 돌아오지 않고 <code class="language-plaintext highlighter-rouge">ChatDetailPage</code>에서 바로 마지막 메세지를 수정하는 후, <code class="language-plaintext highlighter-rouge">ChatPage</code>로 돌아오는 경우 수정 전의 메세지가 표시 된다. <code class="language-plaintext highlighter-rouge">onTap</code>의 비동기 처리로 인해 provider에서 데이터가 업데이트 되기 전에 <code class="language-plaintext highlighter-rouge">ChatPage</code>의 상태 갱신이 먼저 이루어지기 때문으로 보인다.</p></blockquote><p>완성된 화면</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30% 30%'%3E%3C/svg%3E" data-src="/assets/img/2022-09-20-Flutter-Simple-Chat-UI-EX03/SimulSc_ex_03-06.gif" alt="Flutter Simple chat UI ex 03-06" width="30%" height="30%" data-proofer-ignore></p><hr /><h1 id="다음-포스팅-내용">다음 포스팅 내용</h1><p>기본기능은 얼추 다 넣은 것 같은데,</p><ul><li>provider/hive 사용 방식 개선<li>수정 보류 중인 오류들 개선<li>재밌어 보이는 플러그 인이 있으면 적용<li>진짜 메세지를 주고 받을 수 있도록</ul><p>혹시 새 프로젝트를 짠다면</p><ul><li>구체적으로 뭘 만들기 정하기<li>UX/UI 공부를 해서 좀더 사용자 친화적인 프로그램 만들기 를 해보고 싶다.</ul><p>UI에 대해서는 미적감각이 거의 없다 싶은 사람이고 UX/UI는 관련지식이 1도 없기 때문에, 이론 공부부터 해야한다. 공부하면 어떻게든 되겠지 허허</p><hr /><h1 id="후기">후기</h1><p>음… 공부를 더 하도록… 이런식의 얼레벌레 코드를 어따 써</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/flutter/'>Flutter</a>, <a href='/categories/simple-chat/'>Simple Chat</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/flutter/" class="post-tag no-text-decoration" >flutter</a> <a href="/tags/practice/" class="post-tag no-text-decoration" >practice</a> <a href="/tags/programming/" class="post-tag no-text-decoration" >programming</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Flutter+01+Simple+Chat+UI+%EC%9D%91%EC%9A%A9+03+%EB%8D%B0%EC%9D%B4%ED%84%B0+%EB%A1%9C%EC%BB%AC+%EC%A0%80%EC%9E%A5+%EB%B0%8F+%EC%9D%BD%EA%B8%B0%2C%EC%93%B0%EA%B8%B0_%EB%A9%94%EC%84%B8%EC%A7%80+%EB%A1%9C%EA%B7%B8%ED%8E%B8++-+Kae%27s+Dev&url=https%3A%2F%2Fkaesknzxvf.github.io%2Fposts%2FFlutter-Simple-Chat-UI-EX03%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Flutter+01+Simple+Chat+UI+%EC%9D%91%EC%9A%A9+03+%EB%8D%B0%EC%9D%B4%ED%84%B0+%EB%A1%9C%EC%BB%AC+%EC%A0%80%EC%9E%A5+%EB%B0%8F+%EC%9D%BD%EA%B8%B0%2C%EC%93%B0%EA%B8%B0_%EB%A9%94%EC%84%B8%EC%A7%80+%EB%A1%9C%EA%B7%B8%ED%8E%B8++-+Kae%27s+Dev&u=https%3A%2F%2Fkaesknzxvf.github.io%2Fposts%2FFlutter-Simple-Chat-UI-EX03%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fkaesknzxvf.github.io%2Fposts%2FFlutter-Simple-Chat-UI-EX03%2F&text=Flutter+01+Simple+Chat+UI+%EC%9D%91%EC%9A%A9+03+%EB%8D%B0%EC%9D%B4%ED%84%B0+%EB%A1%9C%EC%BB%AC+%EC%A0%80%EC%9E%A5+%EB%B0%8F+%EC%9D%BD%EA%B8%B0%2C%EC%93%B0%EA%B8%B0_%EB%A9%94%EC%84%B8%EC%A7%80+%EB%A1%9C%EA%B7%B8%ED%8E%B8++-+Kae%27s+Dev" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div><script src="https://utteranc.es/client.js" repo="kaesknzxvf/kaesknzxvf.github.io" issue-term="pathname" theme="github-dark" crossorigin="anonymous" async> </script></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Flutter-Simple-Chat-UI-01/">Flutter 01 Simple Chat UI 01 Chat화면</a><li><a href="/posts/Flutter-Simple-Chat-UI-02/">Flutter 01 Simple Chat UI 02 Chat Detail 화면</a><li><a href="/posts/Flutter-Simple-Chat-UI-EX01/">Flutter 01 Simple Chat UI 응용 01 화면 간 데이터 전달, 메세지 입력 </a><li><a href="/posts/Flutter-Simple-Chat-UI-EX02/">Flutter 01 Simple Chat UI 응용 02 데이터 로컬 저장 및 읽기,쓰기_유저정보편 (+상태창 추가) </a><li><a href="/posts/Github-Blog-Setting-01/">Github Blog 02 Chirpy Theme Setting </a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/flutter/">flutter</a> <a class="post-tag" href="/tags/practice/">practice</a> <a class="post-tag" href="/tags/programming/">programming</a> <a class="post-tag" href="/tags/blog/">blog</a> <a class="post-tag" href="/tags/github/">github</a> <a class="post-tag" href="/tags/myblogging/">myblogging</a> <a class="post-tag" href="/tags/personal/">personal</a> <a class="post-tag" href="/tags/writeup/">writeup</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Flutter-Simple-Chat-UI-01/"><div class="card-body"> <em class="small" data-ts="1657426206" data-df="ll" > Jul 10, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Flutter 01 Simple Chat UI 01 Chat화면</h3><div class="text-muted small"><p> 이 포스트는 How to Build a Chat App UI With Flutter and Dart 을 따라서 작성한 Flutter Simple Chat UI 에 관한 내용이다. 관련 포스트 Base, Chat 화면 구현 (현재 포스트) Chat Detail 화면 구현 응용 01 (Chat Detail 화면) 화면 간 ...</p></div></div></a></div><div class="card"> <a href="/posts/Flutter-Simple-Chat-UI-02/"><div class="card-body"> <em class="small" data-ts="1659761220" data-df="ll" > Aug 6, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Flutter 01 Simple Chat UI 02 Chat Detail 화면</h3><div class="text-muted small"><p> 이 포스트는 How to Build a Chat App UI With Flutter and Dart 을 따라서 작성한 Flutter Simple Chat UI 에 관한 내용이다. 관련 포스트 Base, Chat 화면 구현 Chat Detail 화면 구현 (현재 포스트) 응용 01 (Chat Detail 화면) 화면 간 ...</p></div></div></a></div><div class="card"> <a href="/posts/Flutter-Simple-Chat-UI-EX01/"><div class="card-body"> <em class="small" data-ts="1660284960" data-df="ll" > Aug 12, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Flutter 01 Simple Chat UI 응용 01 화면 간 데이터 전달, 메세지 입력</h3><div class="text-muted small"><p> 이 포스트는 How to Build a Chat App UI With Flutter and Dart 을 따라서 작성한 Flutter Simple Chat UI 을 응용하여 좀 더 그럴듯한 채팅앱을 구현하기 위한 과정을 다룬다. 주요 내용은 이하와 같다. 화면 간의 데이터 전달 메세지 입력 메세지 입력에 따른 Chat D...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Flutter-Simple-Chat-UI-EX02/" class="btn btn-outline-primary" prompt="Older"><p>Flutter 01 Simple Chat UI 응용 02 데이터 로컬 저장 및 읽기,쓰기_유저정보편 (+상태창 추가)</p></a><div class="btn btn-outline-primary disabled" prompt="Newer"><p>-</p></div></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://github.com/kaesknzxvf">kae</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/flutter/">flutter</a> <a class="post-tag" href="/tags/practice/">practice</a> <a class="post-tag" href="/tags/programming/">programming</a> <a class="post-tag" href="/tags/blog/">blog</a> <a class="post-tag" href="/tags/github/">github</a> <a class="post-tag" href="/tags/myblogging/">myblogging</a> <a class="post-tag" href="/tags/personal/">personal</a> <a class="post-tag" href="/tags/writeup/">writeup</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-B23YJG8BQ3"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-B23YJG8BQ3'); }); </script>
