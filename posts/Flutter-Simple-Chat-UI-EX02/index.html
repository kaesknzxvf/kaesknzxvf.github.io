<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Flutter 01 Simple Chat UI 응용 02 데이터 로컬 저장 및 읽기,쓰기_유저정보편 (+상태창 추가)" /><meta name="author" content="Kae" /><meta property="og:locale" content="en" /><meta name="description" content="Developer, Study, Flutter, Programming, iOS" /><meta property="og:description" content="Developer, Study, Flutter, Programming, iOS" /><link rel="canonical" href="https://kaesknzxvf.github.io/posts/Flutter-Simple-Chat-UI-EX02/" /><meta property="og:url" content="https://kaesknzxvf.github.io/posts/Flutter-Simple-Chat-UI-EX02/" /><meta property="og:site_name" content="Kae’s Dev" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-09-03T14:08:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Flutter 01 Simple Chat UI 응용 02 데이터 로컬 저장 및 읽기,쓰기_유저정보편 (+상태창 추가)" /><meta name="twitter:site" content="@kzaxevsf52" /><meta name="twitter:creator" content="@kzaxevsf52" /><meta name="google-site-verification" content="tEJ2GfzgZDbKuox8B6dklyj9Al_5yxKNq-ImVP9K4hc" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Kae","url":"https://github.com/kaesknzxvf"},"dateModified":"2022-09-28T21:30:13+09:00","datePublished":"2022-09-03T14:08:00+09:00","description":"Developer, Study, Flutter, Programming, iOS","headline":"Flutter 01 Simple Chat UI 응용 02 데이터 로컬 저장 및 읽기,쓰기_유저정보편 (+상태창 추가)","mainEntityOfPage":{"@type":"WebPage","@id":"https://kaesknzxvf.github.io/posts/Flutter-Simple-Chat-UI-EX02/"},"url":"https://kaesknzxvf.github.io/posts/Flutter-Simple-Chat-UI-EX02/"}</script><title>Flutter 01 Simple Chat UI 응용 02 데이터 로컬 저장 및 읽기,쓰기_유저정보편 (+상태창 추가) | Kae's Dev</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Kae's Dev"><meta name="application-name" content="Kae's Dev"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/profile/main_img.jpeg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Kae's Dev</a></div><div class="site-subtitle font-italic">honyarara</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/kaesknzxvf" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/kzaxevsf52" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a> <a href="https://www.linkedin.com/in/" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Flutter 01 Simple Chat UI 응용 02 데이터 로컬 저장 및 읽기,쓰기_유저정보편 (+상태창 추가) </span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Flutter 01 Simple Chat UI 응용 02 데이터 로컬 저장 및 읽기,쓰기_유저정보편 (+상태창 추가)</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1662181680" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Sep 3, 2022 </em> </span> <span> Updated <em class="" data-ts="1664368213" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Sep 28, 2022 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/kaesknzxvf">Kae</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="9085 words"> <em>50 min</em> read</span></div></div></div><div class="post-content"><p>이 포스트는</p><ul><li><a href="https://www.freecodecamp.org/news/build-a-chat-app-ui-with-flutter/">How to Build a Chat App UI With Flutter and Dart</a></ul><p>을 따라서 작성한 Flutter Simple Chat UI 을 응용하여 좀 더 그럴듯한 채팅앱을 구현하기 위한 과정을 다룬다.</p><p>주요 내용/순서은 이하와 같다.</p><ul><li>데이터 저장 환경 구축<ul><li>데이터 저장 방법 선택<li>Hive를 사용한 로컬 데이터 베이스 구축<ul><li>패키지 추가<li>오리지널 클래스 정의<li>TypeAdapter 클래스 자동 생성</ul></ul><li><code class="language-plaintext highlighter-rouge">ChatPage</code> : 유저 추가, 삭제, 저장<ul><li>코드 정리, UI 수정<li>채팅 유저 추가 및 저장</ul><li><code class="language-plaintext highlighter-rouge">userDetailPage</code> : 상태창 생성, 유저 데이터 갱신<ul><li>상대의 프로필 사진 클릭 시, 상태창 표시<ul><li>갤러리서 선택한 이미지를 배경 이미지로 설정</ul></ul></ul><p>원문의 예제는 단순히 UI만 다루는 포스트이다 보니, 실제로 데이터를 전달하거나 저장하는 등 데이터를 처리하는 작업은 해주지 않는다. 그러므로 이번 포스트는 스스로 공부하며 추가한 코드이다.</p><p>관련 포스트</p><ul><li><a href="https://kaesknzxvf.github.io/posts/Flutter-Simple-Chat-UI-01/">Base, Chat 화면 구현</a><li><a href="https://kaesknzxvf.github.io/posts/Flutter-Simple-Chat-UI-02/">Chat Detail 화면 구현</a><li><a href="https://kaesknzxvf.github.io/posts/Flutter-Simple-Chat-UI-EX01/">응용 01 (Chat Detail 화면) 화면 간 데이터 전달, 메세지 입력</a><li>응용 02 데이터 로컬 저장 및 읽기,쓰기_유저정보편 (+상태창 추가) (현재포스트)<li><a href="https://kaesknzxvf.github.io/posts/Flutter-Simple-Chat-UI-EX03/">응용 03 데이터 로컬 저장 및 읽기,쓰기_메세지로그편</a></ul><hr /><h1 id="환경">환경</h1><ul><li>MacBook Air (M1, 2020)<li><p>macOS Monterey (v12.4)</p><li>Flutter 3.0.3<li><p>Dart 2.17.5</p><li>Visual Studio Code 1.69.0</ul><hr /><h1 id="데이터-저장-환경-구축">데이터 저장 환경 구축</h1><h2 id="데이터-저장-방법-선택"><span class="mr-2">데이터 저장 방법 선택</span><a href="#데이터-저장-방법-선택" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>현재는 메세지을 입력해서 보내도, 채팅창을 한 번 나갔다 들어오면 리셋 되어, 초기 상태로 되돌아 온다.<br /> 그렇기 때문에 내가 보낸 메세지 데이터를 로컬에 저장해서, 채팅창을 나갔다 들어와도 예전의 메세지 로그가 남아 있도록 해 볼 것이다.</p><ul><li><p><strong>고려한 방법 1. shared_preferences 플러그인 → 사용×</strong></p><p><a href="https://pub.dev/packages/shared_preferences">shared_preferences</a> 플러그인을 사용하면 <a href="https://flutter-ko.dev/docs/cookbook/persistence/key-value">Key-Value 데이터를 로컬 디스크에 저장</a>할 수 있는데, 주의할 점이</p><ul><li>오직 원시 타입만 사용 가능: int, double, bool, string, stringList<li>대용량 데이터 저장을 위해 설계되지 않음</ul><p>라고 되어 있어서, 지금은 오리지널 클래스인 <code class="language-plaintext highlighter-rouge">ChatUsers</code>과 <code class="language-plaintext highlighter-rouge">ChatMessage</code>의 리스트를 저장해야하기에 이 플러그 인의 사용은 포기</p><li><p><strong>고려한 방법 2. 로컬 파일 → 사용×</strong></p><p>너무… 원시적이고 데이터 관리가 귀찮으므로 미래를 위해 기각!</p><li><p><strong>고려한 방법 3. 로컬 데이터 베이스 → 사용○</strong></p><p>사용할 수 있는 로컬 데이터 베이스에는 여러 종류가 있는데, 여기에 대해서는 <a href="https://levelup.gitconnected.com/top-5-local-database-solutions-for-flutter-development-6351cd494070">Top 5 Local Database Solutions for Flutter Development</a>라는 아주 좋은 글이 있었다.</p><p>글에서 소개한 내용을 간단히 요약하면,</p><ul><li><a href="https://flutter-ko.dev/docs/cookbook/persistence/sqlite">SQLite</a><ul><li><a href="https://pub.dev/packages/sqflite">sqflite</a> 플러그인 : 가장 유명하고 많이 사용하는 플러그인<li><a href="https://pub.dev/packages/floor">Floor</a> 플러그인 : sqflite에 의존, sqflite이 지원하는 모든 것을 지원 + 다른 기능도 추가<li><a href="https://pub.dev/packages/drift">Drift (Moor)</a> 플러그인 : sqflite에 의존, querying API 를 포함해 매우 강력한 툴, <a href="https://drift.simonbinder.eu/">공식페이지</a></ul><li><a href="https://pub.dev/packages/hive">Hive</a><br /> NoSQL, Key-Value 데이터베이스, 속도가 빠름, 암호화 강력<br /> 이상적인 use case<ul><li>소규모<li>유연한 애플리케이션 : NoSQL 이기 때문에 ‘테이블’이 아닌 ‘박스’라는 개념이 사용되며, 어떠한 구조도 될 수 있는 ‘박스’는 동일한 유형의 개체에 대한 유연한 데이터 열이 필요한 경우 매우 유용</ul><li><a href="https://pub.dev/packages/sembast">Sembast</a><br /> NoSQL 데이터베이스, 데이터 관리 방식은 Hive와 비슷하지만, 아직 Hive에 미치지 못하는 기능, 성능을 가짐</ul><blockquote><p>※　데이터베이스 서버 구축 or 클라우드 서비스 데이터 베이스 이용 → 추후 수정 가능성 있음</p><blockquote><p>진짜로 채팅을 할 수 있도록 만드려면 송수신자가 서로 다른 네트워크에서 접근 할 수 있는 데이터 베이스가 필요할 테니, 앱이 그 수준까지 완성 되면 데이터 관리 방법을 꿔야 할 것이다… 그때 한 번 해보려고 한다.</p></blockquote></blockquote></ul><p>앞으로 응용해서 만드려고 하는 채팅 앱의 경우, 다수의 유저를 염두에 두고 만드는 것도 아니며, 오로지 공부 목적이기에 데이터의 규모가 그리 커지지도 않을 것이다. 그리고 NoSQL DB를 한번도 안 써봐서 써보고 싶다ㅎ <br /> 위와 같은 이유로 이번엔 <code class="language-plaintext highlighter-rouge">Hive</code>를 이용하여 로컬 데이터 베이스를 구축해 보려한다.</p><h2 id="hive를-사용한-로컬-데이터-베이스-구축"><span class="mr-2">Hive를 사용한 로컬 데이터 베이스 구축</span><a href="#hive를-사용한-로컬-데이터-베이스-구축" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>이번 장은 <a href="https://zenn.dev/naoya_maeda/articles/b67f53af377395">【Flutter】Hiveの使い方</a>를 참고해서 작성했다. 설명이 아주아주 친절하다.</p><p>이 앱에서는<code class="language-plaintext highlighter-rouge">ChatUsers</code>과 <code class="language-plaintext highlighter-rouge">ChatMessage</code>의 저장소를 만들어 줄건데 (설명은<code class="language-plaintext highlighter-rouge">ChatUsers</code>로 작성), 순서는 이하와 같다.</p><ol><li>필요한 패키지 추가<li>오리지널 클래스 <code class="language-plaintext highlighter-rouge">ChatUsers</code> 정의<li><code class="language-plaintext highlighter-rouge">ChatUsers</code>의 TypeAdapter 클래스 자동 생성</ol><h3 id="패키지-추가"><span class="mr-2">패키지 추가</span><a href="#패키지-추가" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><code class="language-plaintext highlighter-rouge">pubspec.yaml</code>파일 <code class="language-plaintext highlighter-rouge">dependencies</code>와 <code class="language-plaintext highlighter-rouge">dev_dependencies</code>에 필요한 패키지의 최신 버전을 추가한다.</p><div file="/pubspec.yaml" class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="/pubspec.yaml"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="na">dependencies</span><span class="pi">:</span>
  <span class="na">hive</span><span class="pi">:</span> <span class="s">^2.2.3</span>
  <span class="na">hive_flutter</span><span class="pi">:</span> <span class="s">^1.1.0</span>
<span class="na">dev_dependencies</span><span class="pi">:</span>
  <span class="na">hive_generator</span><span class="pi">:</span> <span class="s">^1.1.3</span>
  <span class="na">build_runner</span><span class="pi">:</span> <span class="s">^2.2.0</span>
</pre></table></code></div></div><blockquote class="prompt-warning"><div><p>2022/9/3시점, <a href="https://pub.dev/packages/hive">hive</a>의 최신 버전은 2.2.3, <a href="https://pub.dev/packages/hive_flutter">hive_flutter</a>의 최신 버전은 1.1.0, <a href="https://pub.dev/packages/hive_generator">hive_generator</a>의 최신 버전은 1.1.3, <a href="https://pub.dev/packages/build_runner">build_runner</a>의 최신 버전은 2.2.0 이다. 최신 버전은 각자 확인하고 변경해서 추가하자.</p></div></blockquote><blockquote class="prompt-tip"><div><p>개발할 때에만 필요하고, 릴리즈 할 때에는 필요 없는 패키지는 <code class="language-plaintext highlighter-rouge">dev_dependencies</code>에 포함시킨다.</p></div></blockquote><p>여기서 (<code class="language-plaintext highlighter-rouge">ChatUsers</code>같은)오지지널 클래스의 TypeAdapter를 작성하기 위한 <code class="language-plaintext highlighter-rouge">hive_generator</code>와 <code class="language-plaintext highlighter-rouge">build_runner</code>는 개발할 때에만 필요하기 떄문에, <code class="language-plaintext highlighter-rouge">dev_dependencies</code>에 포함시킨 것.</p><h3 id="오리지널-클래스-정의"><span class="mr-2">오리지널 클래스 정의</span><a href="#오리지널-클래스-정의" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>저장하고 싶은 것은 메세지 로그이므로 생성해 두었던 <code class="language-plaintext highlighter-rouge">chatUsersModel.dart</code>를 이하와 같이 수정해 줄 것이다.</p><div file="/lib/models/chatUsersModel.dart" class="language-dart highlighter-rouge"><div class="code-header"> <span data-label-text="/lib/models/chatUsersModel.dart"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="s">'package:flutter/cupertino.dart'</span><span class="o">;</span>
<span class="kn">import</span> <span class="s">'package:hive/hive.dart'</span><span class="o">;</span> <span class="c1">//추가</span>
<span class="kn">import</span> <span class="s">'package:uuid/uuid.dart'</span><span class="o">;</span> <span class="c1">//추가</span>

<span class="kn">part</span> <span class="s">'chatUsersModel.g.dart'</span><span class="o">;</span> <span class="c1">//추가</span>

<span class="kd">var</span> <span class="n">uuid</span> <span class="o">=</span> <span class="n">Uuid</span><span class="p">();</span>

<span class="nd">@HiveType</span><span class="p">(</span><span class="nl">typeId:</span> <span class="mi">1</span><span class="p">)</span> <span class="c1">//추가</span>
<span class="kd">class</span> <span class="nc">ChatUsers</span> <span class="p">{</span>
  <span class="nd">@HiveField</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1">//추가</span>
  <span class="kt">String</span> <span class="n">id</span><span class="p">;</span> <span class="c1">//추가</span>
  <span class="nd">@HiveField</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1">//추가</span>
  <span class="kt">String</span> <span class="n">name</span><span class="p">;</span>
  <span class="nd">@HiveField</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1">//추가</span>
  <span class="kt">String</span> <span class="n">messageText</span><span class="p">;</span>
  <span class="nd">@HiveField</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="c1">//추가</span>
  <span class="kt">String</span> <span class="n">imageURL</span><span class="p">;</span>
  <span class="nd">@HiveField</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="c1">//추가</span>
  <span class="kt">String</span> <span class="n">time</span><span class="p">;</span>

  <span class="n">ChatUsers</span><span class="p">(</span>
      <span class="p">{</span><span class="kt">String</span><span class="o">?</span> <span class="n">id</span><span class="p">,</span>
      <span class="kd">required</span> <span class="k">this</span><span class="o">.</span><span class="na">name</span><span class="p">,</span>
      <span class="kd">required</span> <span class="k">this</span><span class="o">.</span><span class="na">messageText</span><span class="p">,</span>
      <span class="kd">required</span> <span class="k">this</span><span class="o">.</span><span class="na">imageURL</span><span class="p">,</span>
      <span class="kd">required</span> <span class="k">this</span><span class="o">.</span><span class="na">time</span><span class="p">})</span>
      <span class="o">:</span> <span class="n">id</span> <span class="o">=</span> <span class="n">id</span> <span class="o">??</span> <span class="n">uuid</span><span class="o">.</span><span class="na">v4</span><span class="p">();</span>
<span class="p">}</span>
</pre></table></code></div></div><p>추가해준 코드의 설명과 추가한 이유는 이하와 같다.</p><ul><li>String id; <br /> 데이터 베이스에 저장을 할 때, key가 될 속성이 필요하기 때문에, 추가해 주었다. <code class="language-plaintext highlighter-rouge">id</code>속성은 <code class="language-plaintext highlighter-rouge">uuid</code>플러그인을 이용해 생성자 실행 시에 자동으로 할당되도록 해주었다. SQL데이터베이스로 말하면 prime key같은 역할을 할 속성, name등 다른 속성으로 식별해 줄 수도 있지만, 이름은 겹칠 수도 있고…name 외의 속성도 딱히 prime key 역할은 못할 듯 <br /> ※ 그렇다고 진짜 hive에서 키로 설정할 속성을 (겹치면 절대 안되는)식별키로 인식하는건 아님 주의! 내가 아직 SQL식 사고에서 못벗어나서 만들어 준 것 뿐…! 진짜로 이렇게 사용하는 건지는 모르겠음<li>part ‘chatUsersModel.g.dart’;<br /> <code class="language-plaintext highlighter-rouge">part</code>는 <code class="language-plaintext highlighter-rouge">part of</code>와 한쌍으로 프로그램을 분할 할 때 사용하는 구문으로, 파일에 선언해주면 (이번의 경우) <code class="language-plaintext highlighter-rouge">chatUsersModel.dart</code> 와 <code class="language-plaintext highlighter-rouge">chatUsersModel.g.dart</code> 는 하나의 파일에 정의한 것과 같이 취급된다. <code class="language-plaintext highlighter-rouge">chatUsersModel.g.dart</code>파일은 TypeAdapter 클래스가 정의된 파일로, 아직 생성해 주지 않았으므로 빌드에러가 날 것이다. (바로 다음 단계에서 생성해 줄 것) <br /> ※ 추후 생성할 <code class="language-plaintext highlighter-rouge">chatUsersModel.g.dart</code>파일을 확인하면 <code class="language-plaintext highlighter-rouge">part of 'chatUsersModel.dart'</code> 가 선언되어 있는 것을 확인 할 수 있다.<li>@HiveType(typeId:<code class="language-plaintext highlighter-rouge">0~255의 숫자</code>)<br /> Hive가 TypeAdapter 생성시, 각 클래스들을 식별 할 수 있도록 지정해 주는 것이며, 들어갈 수 있는 숫자 범위는 <code class="language-plaintext highlighter-rouge">0~255</code>이다.<li>@HiveField(<code class="language-plaintext highlighter-rouge">0~255의 숫자</code>)<br /> Hive가 TypeAdapter 생성시, 각 필드들을 식별 할 수 있도록 지정해 주는 것이며, 들어갈 수 있는 숫자 범위는 <code class="language-plaintext highlighter-rouge">0~255</code>이다.</ul><h3 id="typeadapter-클래스-자동-생성"><span class="mr-2">TypeAdapter 클래스 자동 생성</span><a href="#typeadapter-클래스-자동-생성" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>위에서 입력해 둔</p><div file="/lib/models/chatUsersModel.dart" class="language-dart highlighter-rouge"><div class="code-header"> <span data-label-text="/lib/models/chatUsersModel.dart"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="kn">part</span> <span class="s">'chatUsersModel.g.dart'</span><span class="o">;</span> 
</pre></table></code></div></div><p>의 <code class="language-plaintext highlighter-rouge">chatUsersModel.g.dart</code>를 생성하는 작업을 해줄 것이다.</p><blockquote class="prompt-warning"><div><p>반드시 생성하고자 하는 클래스에 <code class="language-plaintext highlighter-rouge">part '해당클래스명.g.dart';</code> 를 먼저 추가해준 후 진행해야한다! 그렇지 않으면 생성되지 않음</p></div></blockquote><p>VSCode 터미널(현재의 flutter 프로젝트 경로)에서 이하와 같은 커멘드를 입력</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>flutter packages pub run build_runner build
</pre></table></code></div></div><p>그러면</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre>[INFO] Generating build script...
[INFO] Generating build script completed, took 181ms

[INFO] Initializing inputs
[INFO] Reading cached asset graph...
[INFO] Reading cached asset graph completed, took 31ms

[INFO] Checking for updates since last build...
[INFO] Checking for updates since last build completed, took 428ms

[INFO] Running build...
[INFO] 1.0s elapsed, 0/1 actions completed.
[INFO] 4.0s elapsed, 0/1 actions completed.
[INFO] Running build completed, took 4.3s

[INFO] Caching finalized dependency graph...
[INFO] Caching finalized dependency graph completed, took 19ms

[INFO] Succeeded after 4.3s with 2 outputs (2 actions)
</pre></table></code></div></div><p>이런 로그가 출력되면서, <code class="language-plaintext highlighter-rouge">chatUsersModel.dart</code>와 같은 폴더에 <code class="language-plaintext highlighter-rouge">chatUsersModel.g.dart</code>이 생성된 것을 확인할 수 있다.</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 50% 50%'%3E%3C/svg%3E" data-src="/assets/img/2022-09-03-Flutter-Simple-Chat-UI-EX02/SimulSc_ex_12.png" alt="Flutter Simple chat UI ex 12" width="50%" height="50%" data-proofer-ignore></p><p>앞서 설명했듯,<code class="language-plaintext highlighter-rouge">chatMessageModel.dart</code>도 똑같이 생성해 주었음!</p><h1 id="chatpage--유저-추가-삭제-저장">ChatPage : 유저 추가, 삭제, 저장</h1><h2 id="코드-정리-ui-수정"><span class="mr-2">코드 정리, UI 수정</span><a href="#코드-정리-ui-수정" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>기존 코드에서 수정할 것도 있고 여러가지가 추가되기 때문에 <code class="language-plaintext highlighter-rouge">chatPage.dart</code>의 코드를 수정, 추가해 주었다.</p><ul><li>스크롤하면 페이지 타이틀까지 스크롤되는 거 수정<li>Add new 버튼이 실제로 눌릴 수 있게 제스쳐 위젯 추가<li>User list 를 초기화 할 수 있는 버튼 추가<li>ListView의 User를 사이드 스와이프로 제거 (<a href="https://docs.flutter.dev/cookbook/gestures/dismissible">Dismissible</a>) 할 수 있도록 추가</ul><p>이하 수정한 <code class="language-plaintext highlighter-rouge">chatPage.dart</code> 전문</p><div file="/lib/screen/chatPage.dart" class="language-dart highlighter-rouge"><div class="code-header"> <span data-label-text="/lib/screen/chatPage.dart"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="s">'package:flutter/material.dart'</span><span class="o">;</span>
<span class="kn">import</span> <span class="s">'package:flt_simple_chat_ex/models/chatUsersModel.dart'</span><span class="o">;</span>
<span class="kn">import</span> <span class="s">'package:flt_simple_chat_ex/widgets/conversationList.dart'</span><span class="o">;</span>

<span class="kd">class</span> <span class="nc">ChatPage</span> <span class="kd">extends</span> <span class="n">StatefulWidget</span> <span class="p">{</span>
  <span class="nd">@override</span>
  <span class="n">_ChatPageState</span> <span class="n">createState</span><span class="p">()</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">_ChatPageState</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">_ChatPageState</span> <span class="kd">extends</span> <span class="n">State</span><span class="p">&lt;</span><span class="n">ChatPage</span><span class="p">&gt;</span> <span class="p">{</span>
  <span class="kt">List</span><span class="p">&lt;</span><span class="n">ChatUsers</span><span class="p">&gt;</span> <span class="n">chatUsers</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">ChatUsers</span><span class="p">(</span>
        <span class="nl">name:</span> <span class="s">"Jane Russel"</span><span class="p">,</span>
        <span class="nl">messageText:</span> <span class="s">"Awesome Setup"</span><span class="p">,</span>
        <span class="nl">imageURL:</span> <span class="s">"https://randomuser.me/api/portraits/men/1.jpg"</span><span class="p">,</span>
        <span class="nl">time:</span> <span class="s">"Now"</span><span class="p">),</span>
    <span class="n">ChatUsers</span><span class="p">(</span>
        <span class="nl">name:</span> <span class="s">"Glady's Murphy"</span><span class="p">,</span>
        <span class="nl">messageText:</span> <span class="s">"That's Great"</span><span class="p">,</span>
        <span class="nl">imageURL:</span> <span class="s">"https://randomuser.me/api/portraits/women/1.jpg"</span><span class="p">,</span>
        <span class="nl">time:</span> <span class="s">"Yesterday"</span><span class="p">),</span>
    <span class="n">ChatUsers</span><span class="p">(</span>
        <span class="nl">name:</span> <span class="s">"Jorge Henry"</span><span class="p">,</span>
        <span class="nl">messageText:</span> <span class="s">"Hey where are you?"</span><span class="p">,</span>
        <span class="nl">imageURL:</span> <span class="s">"https://randomuser.me/api/portraits/men/2.jpg"</span><span class="p">,</span>
        <span class="nl">time:</span> <span class="s">"31 Mar"</span><span class="p">),</span>
    <span class="n">ChatUsers</span><span class="p">(</span>
        <span class="nl">name:</span> <span class="s">"Philip Fox"</span><span class="p">,</span>
        <span class="nl">messageText:</span> <span class="s">"Busy! Call me in 20 mins"</span><span class="p">,</span>
        <span class="nl">imageURL:</span> <span class="s">"https://randomuser.me/api/portraits/women/2.jpg"</span><span class="p">,</span>
        <span class="nl">time:</span> <span class="s">"28 Mar"</span><span class="p">),</span>
    <span class="n">ChatUsers</span><span class="p">(</span>
        <span class="nl">name:</span> <span class="s">"Debra Hawkins"</span><span class="p">,</span>
        <span class="nl">messageText:</span> <span class="s">"Thankyou, It's awesome"</span><span class="p">,</span>
        <span class="nl">imageURL:</span> <span class="s">"https://randomuser.me/api/portraits/men/3.jpg"</span><span class="p">,</span>
        <span class="nl">time:</span> <span class="s">"23 Mar"</span><span class="p">),</span>
    <span class="n">ChatUsers</span><span class="p">(</span>
        <span class="nl">name:</span> <span class="s">"Jacob Pena"</span><span class="p">,</span>
        <span class="nl">messageText:</span> <span class="s">"will update you in evening"</span><span class="p">,</span>
        <span class="nl">imageURL:</span> <span class="s">"https://randomuser.me/api/portraits/women/3.jpg"</span><span class="p">,</span>
        <span class="nl">time:</span> <span class="s">"17 Mar"</span><span class="p">),</span>
    <span class="n">ChatUsers</span><span class="p">(</span>
        <span class="nl">name:</span> <span class="s">"Andrey Jones"</span><span class="p">,</span>
        <span class="nl">messageText:</span> <span class="s">"Can you please share the file?"</span><span class="p">,</span>
        <span class="nl">imageURL:</span> <span class="s">"https://randomuser.me/api/portraits/men/4.jpg"</span><span class="p">,</span>
        <span class="nl">time:</span> <span class="s">"24 Feb"</span><span class="p">),</span>
    <span class="n">ChatUsers</span><span class="p">(</span>
        <span class="nl">name:</span> <span class="s">"John Wick"</span><span class="p">,</span>
        <span class="nl">messageText:</span> <span class="s">"How are you?"</span><span class="p">,</span>
        <span class="nl">imageURL:</span> <span class="s">"https://randomuser.me/api/portraits/women/4.jpg"</span><span class="p">,</span>
        <span class="nl">time:</span> <span class="s">"18 Feb"</span><span class="p">),</span>
  <span class="p">];</span>

  <span class="nd">@override</span>
  <span class="n">Widget</span> <span class="n">build</span><span class="p">(</span><span class="n">BuildContext</span> <span class="n">context</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">Scaffold</span><span class="p">(</span>
      <span class="nl">body:</span> <span class="n">Column</span><span class="p">(</span>
        <span class="c1">//delete: SingleChildScrollView - 스크롤하면 페이지 타이틀까지 스크롤되는 거 수정</span>
        <span class="nl">crossAxisAlignment:</span> <span class="n">CrossAxisAlignment</span><span class="o">.</span><span class="na">start</span><span class="p">,</span>
        <span class="nl">children:</span> <span class="p">&lt;</span><span class="n">Widget</span><span class="p">&gt;[</span>
          <span class="n">SafeArea</span><span class="p">(</span>
            <span class="nl">child:</span> <span class="n">Padding</span><span class="p">(</span>
              <span class="nl">padding:</span> <span class="n">EdgeInsets</span><span class="o">.</span><span class="na">only</span><span class="p">(</span><span class="nl">left:</span> <span class="mi">16</span><span class="p">,</span> <span class="nl">right:</span> <span class="mi">16</span><span class="p">,</span> <span class="nl">top:</span> <span class="mi">10</span><span class="p">),</span>
              <span class="nl">child:</span> <span class="n">Row</span><span class="p">(</span>
                <span class="nl">mainAxisAlignment:</span> <span class="n">MainAxisAlignment</span><span class="o">.</span><span class="na">spaceBetween</span><span class="p">,</span>
                <span class="nl">children:</span> <span class="p">&lt;</span><span class="n">Widget</span><span class="p">&gt;[</span>
                  <span class="n">Text</span><span class="p">(</span>
                    <span class="s">"Conversations"</span><span class="p">,</span>
                    <span class="nl">style:</span> <span class="n">TextStyle</span><span class="p">(</span><span class="nl">fontSize:</span> <span class="mi">23</span><span class="p">,</span> <span class="nl">fontWeight:</span> <span class="n">FontWeight</span><span class="o">.</span><span class="na">bold</span><span class="p">),</span>
                  <span class="p">),</span>
                  <span class="n">Row</span><span class="p">(</span><span class="nl">children:</span> <span class="p">&lt;</span><span class="n">Widget</span><span class="p">&gt;[</span>
                    <span class="n">Container</span><span class="p">(</span> <span class="c1">// User list 를 초기화 할 수 있는 버튼 추가</span>
                      <span class="nl">padding:</span>
                          <span class="n">EdgeInsets</span><span class="o">.</span><span class="na">only</span><span class="p">(</span><span class="nl">left:</span> <span class="mi">8</span><span class="p">,</span> <span class="nl">right:</span> <span class="mi">8</span><span class="p">,</span> <span class="nl">top:</span> <span class="mi">2</span><span class="p">,</span> <span class="nl">bottom:</span> <span class="mi">2</span><span class="p">),</span>
                      <span class="nl">height:</span> <span class="mi">30</span><span class="p">,</span>
                      <span class="nl">decoration:</span> <span class="n">BoxDecoration</span><span class="p">(</span>
                        <span class="nl">borderRadius:</span> <span class="n">BorderRadius</span><span class="o">.</span><span class="na">circular</span><span class="p">(</span><span class="mi">30</span><span class="p">),</span>
                        <span class="nl">color:</span> <span class="n">Colors</span><span class="o">.</span><span class="na">green</span><span class="p">[</span><span class="mi">50</span><span class="p">],</span>
                      <span class="p">),</span>
                      <span class="nl">child:</span> <span class="n">GestureDetector</span><span class="p">(</span>
                        <span class="nl">onTap:</span> <span class="p">()</span> <span class="kd">async</span> <span class="p">{</span>
                          <span class="n">print</span><span class="p">(</span><span class="s">"Clear user list"</span><span class="p">);</span>
                        <span class="p">},</span>
                        <span class="nl">child:</span> <span class="n">Row</span><span class="p">(</span>
                          <span class="nl">children:</span> <span class="p">&lt;</span><span class="n">Widget</span><span class="p">&gt;[</span>
                            <span class="n">Icon</span><span class="p">(</span>
                              <span class="n">Icons</span><span class="o">.</span><span class="na">cancel</span><span class="p">,</span>
                              <span class="nl">color:</span> <span class="n">Colors</span><span class="o">.</span><span class="na">green</span><span class="p">,</span>
                              <span class="nl">size:</span> <span class="mi">20</span><span class="p">,</span>
                            <span class="p">),</span>
                            <span class="n">SizedBox</span><span class="p">(</span>
                              <span class="nl">width:</span> <span class="mi">2</span><span class="p">,</span>
                            <span class="p">),</span>
                            <span class="n">Text</span><span class="p">(</span>
                              <span class="s">"Clear"</span><span class="p">,</span>
                              <span class="nl">style:</span> <span class="n">TextStyle</span><span class="p">(</span>
                                  <span class="nl">fontSize:</span> <span class="mi">14</span><span class="p">,</span> <span class="nl">fontWeight:</span> <span class="n">FontWeight</span><span class="o">.</span><span class="na">bold</span><span class="p">),</span>
                            <span class="p">),</span>
                          <span class="p">],</span>
                        <span class="p">),</span>
                      <span class="p">),</span>
                    <span class="p">),</span>
                    <span class="n">SizedBox</span><span class="p">(</span>
                      <span class="nl">width:</span> <span class="mi">4</span><span class="p">,</span>
                    <span class="p">),</span>
                    <span class="n">Container</span><span class="p">(</span>
                      <span class="nl">padding:</span>
                          <span class="n">EdgeInsets</span><span class="o">.</span><span class="na">only</span><span class="p">(</span><span class="nl">left:</span> <span class="mi">8</span><span class="p">,</span> <span class="nl">right:</span> <span class="mi">8</span><span class="p">,</span> <span class="nl">top:</span> <span class="mi">2</span><span class="p">,</span> <span class="nl">bottom:</span> <span class="mi">2</span><span class="p">),</span>
                      <span class="nl">height:</span> <span class="mi">30</span><span class="p">,</span>
                      <span class="nl">decoration:</span> <span class="n">BoxDecoration</span><span class="p">(</span>
                        <span class="nl">borderRadius:</span> <span class="n">BorderRadius</span><span class="o">.</span><span class="na">circular</span><span class="p">(</span><span class="mi">30</span><span class="p">),</span>
                        <span class="nl">color:</span> <span class="n">Colors</span><span class="o">.</span><span class="na">pink</span><span class="p">[</span><span class="mi">50</span><span class="p">],</span>
                      <span class="p">),</span>
                      <span class="nl">child:</span> <span class="n">GestureDetector</span><span class="p">(</span> <span class="c1">// Add new 버튼이 실제로 눌릴 수 있게 제스쳐 위젯 추가</span>
                        <span class="nl">onTap:</span> <span class="p">()</span> <span class="kd">async</span> <span class="p">{</span>
                          <span class="n">print</span><span class="p">(</span><span class="s">"ADD NEW PRESSED"</span><span class="p">);</span>
                        <span class="p">},</span>
                        <span class="nl">child:</span> <span class="n">Row</span><span class="p">(</span>
                          <span class="nl">children:</span> <span class="p">&lt;</span><span class="n">Widget</span><span class="p">&gt;[</span>
                            <span class="n">Icon</span><span class="p">(</span>
                              <span class="n">Icons</span><span class="o">.</span><span class="na">add</span><span class="p">,</span>
                              <span class="nl">color:</span> <span class="n">Colors</span><span class="o">.</span><span class="na">pink</span><span class="p">,</span>
                              <span class="nl">size:</span> <span class="mi">20</span><span class="p">,</span>
                            <span class="p">),</span>
                            <span class="n">SizedBox</span><span class="p">(</span>
                              <span class="nl">width:</span> <span class="mi">2</span><span class="p">,</span>
                            <span class="p">),</span>
                            <span class="n">Text</span><span class="p">(</span>
                              <span class="s">"Add New"</span><span class="p">,</span>
                              <span class="nl">style:</span> <span class="n">TextStyle</span><span class="p">(</span>
                                  <span class="nl">fontSize:</span> <span class="mi">14</span><span class="p">,</span> <span class="nl">fontWeight:</span> <span class="n">FontWeight</span><span class="o">.</span><span class="na">bold</span><span class="p">),</span>
                            <span class="p">),</span>
                          <span class="p">],</span>
                        <span class="p">),</span>
                      <span class="p">),</span>
                    <span class="p">)</span>
                  <span class="p">])</span>
                <span class="p">],</span>
              <span class="p">),</span>
            <span class="p">),</span>
          <span class="p">),</span>
          <span class="n">Padding</span><span class="p">(</span>
            <span class="nl">padding:</span> <span class="n">EdgeInsets</span><span class="o">.</span><span class="na">only</span><span class="p">(</span><span class="nl">top:</span> <span class="mi">16</span><span class="p">,</span> <span class="nl">left:</span> <span class="mi">16</span><span class="p">,</span> <span class="nl">right:</span> <span class="mi">16</span><span class="p">),</span>
            <span class="nl">child:</span> <span class="n">TextField</span><span class="p">(</span>
              <span class="nl">decoration:</span> <span class="n">InputDecoration</span><span class="p">(</span>
                <span class="nl">hintText:</span> <span class="s">"Search..."</span><span class="p">,</span>
                <span class="nl">hintStyle:</span> <span class="n">TextStyle</span><span class="p">(</span><span class="nl">color:</span> <span class="n">Colors</span><span class="o">.</span><span class="na">grey</span><span class="o">.</span><span class="na">shade600</span><span class="p">),</span>
                <span class="nl">prefixIcon:</span> <span class="n">Icon</span><span class="p">(</span>
                  <span class="n">Icons</span><span class="o">.</span><span class="na">search</span><span class="p">,</span>
                  <span class="nl">color:</span> <span class="n">Colors</span><span class="o">.</span><span class="na">grey</span><span class="o">.</span><span class="na">shade600</span><span class="p">,</span>
                  <span class="nl">size:</span> <span class="mi">20</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="nl">filled:</span> <span class="kc">true</span><span class="p">,</span>
                <span class="nl">fillColor:</span> <span class="n">Colors</span><span class="o">.</span><span class="na">grey</span><span class="o">.</span><span class="na">shade100</span><span class="p">,</span>
                <span class="nl">contentPadding:</span> <span class="n">EdgeInsets</span><span class="o">.</span><span class="na">all</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span>
                <span class="nl">enabledBorder:</span> <span class="n">OutlineInputBorder</span><span class="p">(</span>
                    <span class="nl">borderRadius:</span> <span class="n">BorderRadius</span><span class="o">.</span><span class="na">circular</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
                    <span class="nl">borderSide:</span> <span class="n">BorderSide</span><span class="p">(</span><span class="nl">color:</span> <span class="n">Colors</span><span class="o">.</span><span class="na">grey</span><span class="o">.</span><span class="na">shade100</span><span class="p">)),</span>
              <span class="p">),</span>
            <span class="p">),</span>
          <span class="p">),</span>
          <span class="n">Flexible</span><span class="p">(</span>
            <span class="c1">//add: Flexible,SingleChildScrollView - 스크롤하면 페이지 타이틀까지 스크롤되는 거 수정</span>
            <span class="nl">fit:</span> <span class="n">FlexFit</span><span class="o">.</span><span class="na">tight</span><span class="p">,</span>
            <span class="nl">child:</span> <span class="n">SingleChildScrollView</span><span class="p">(</span> 
              <span class="nl">physics:</span> <span class="n">BouncingScrollPhysics</span><span class="p">(),</span>
              <span class="nl">child:</span> <span class="n">ListView</span><span class="o">.</span><span class="na">builder</span><span class="p">(</span>
                <span class="nl">itemCount:</span> <span class="n">chatUsers</span><span class="o">.</span><span class="na">length</span><span class="p">,</span>
                <span class="nl">shrinkWrap:</span> <span class="kc">true</span><span class="p">,</span>
                <span class="nl">padding:</span> <span class="n">EdgeInsets</span><span class="o">.</span><span class="na">only</span><span class="p">(</span><span class="nl">top:</span> <span class="mi">16</span><span class="p">),</span>
                <span class="nl">physics:</span> <span class="n">NeverScrollableScrollPhysics</span><span class="p">(),</span>
                <span class="nl">itemBuilder:</span> <span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span> <span class="p">{</span>
                  <span class="k">return</span> <span class="n">Dismissible</span><span class="p">(</span>
                    <span class="c1">//ListView의 User를 사이드 스와이프로 제거 (Dismissible)</span>
                    <span class="nl">key:</span> <span class="n">Key</span><span class="p">(</span><span class="n">chatUsers</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="na">toString</span><span class="p">()),</span> 
                    <span class="nl">onDismissed:</span> <span class="p">(</span><span class="n">DismissDirection</span> <span class="n">direction</span><span class="p">)</span> <span class="p">{</span>
                      <span class="n">ScaffoldMessenger</span><span class="o">.</span><span class="na">of</span><span class="p">(</span><span class="n">context</span><span class="p">)</span><span class="o">.</span><span class="na">showSnackBar</span><span class="p">(</span><span class="n">SnackBar</span><span class="p">(</span>
                          <span class="nl">content:</span> <span class="n">Text</span><span class="p">(</span><span class="s">'</span><span class="si">${chatUsers[index].name}</span><span class="s"> dismissed'</span><span class="p">)));</span>
                      <span class="n">setState</span><span class="p">(()</span> <span class="p">{</span>
                        <span class="n">chatUsers</span><span class="o">.</span><span class="na">removeAt</span><span class="p">(</span><span class="n">index</span><span class="p">);</span>
                      <span class="p">});</span>
                    <span class="p">},</span>
                    <span class="nl">background:</span> <span class="n">Container</span><span class="p">(</span>
                      <span class="nl">color:</span> <span class="n">Colors</span><span class="o">.</span><span class="na">red</span><span class="p">,</span>
                    <span class="p">),</span>
                    <span class="nl">child:</span> <span class="n">ConversationList</span><span class="p">(</span>
                      <span class="nl">name:</span> <span class="n">chatUsers</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="na">name</span><span class="p">,</span>
                      <span class="nl">messageText:</span> <span class="n">chatUsers</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="na">messageText</span><span class="p">,</span>
                      <span class="nl">imageUrl:</span> <span class="n">chatUsers</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="na">imageURL</span><span class="p">,</span>
                      <span class="nl">time:</span> <span class="n">chatUsers</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="na">time</span><span class="p">,</span>
                      <span class="nl">isMessageRead:</span> <span class="p">(</span><span class="n">index</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="o">?</span> <span class="kc">true</span> <span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
                    <span class="p">),</span>
                  <span class="p">);</span>
                <span class="p">},</span>
              <span class="p">),</span>
            <span class="p">),</span>
          <span class="p">),</span>
        <span class="p">],</span>
      <span class="p">),</span>
    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>수정된 <code class="language-plaintext highlighter-rouge">chatPage</code> UI (유저 전부 삭제한 상태)</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30% 30%'%3E%3C/svg%3E" data-src="/assets/img/2022-09-03-Flutter-Simple-Chat-UI-EX02/SimulSc_ex_28.png" alt="Flutter Simple chat UI ex 28" width="30%" height="30%" data-proofer-ignore></p><h2 id="채팅-유저-추가-및-저장"><span class="mr-2">채팅 유저 추가 및 저장</span><a href="#채팅-유저-추가-및-저장" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>이제 저저…흉!측한 <code class="language-plaintext highlighter-rouge">List&lt;ChatUsers&gt; chatUsers</code>를 날려버리고 코드를 예쁘게 만들어줄 차례다. 먼저 그 과정을 편하게 만들어줄 버튼 2개를 만들었다.</p><ul><li><code class="language-plaintext highlighter-rouge">Add New</code>버튼을 누르면 유저이름을 입력 다이얼로그 창이 뜨고, 유저 이름을 입력할 경우에 그 유저가 추가<li><code class="language-plaintext highlighter-rouge">Clear</code>버튼을 누르면 리스트에 있는 모든 유저가 삭제</ul><p>유저의 상태를 앱을 다시 시작해도 기억할 수 있도록 위에 구축해 놓은 <code class="language-plaintext highlighter-rouge">hive</code>를 사용해 저장할 것이다. 그런데, 예쁘게 코드를 짜기 위해서는 <code class="language-plaintext highlighter-rouge">hive</code>와 더불어 위젯의 상태 관리를 하는 <code class="language-plaintext highlighter-rouge">provider</code>에 대해서도 알아야 했다.</p><p><code class="language-plaintext highlighter-rouge">hive</code>같은 데이터 베이스는 뭐가 중요하다? 무결성이 중요하다~ 언제, 어디서든지, 누가 봤을 때도 같은 상태의 데이터가 보여야한다. A위젯에서 보는 데이터는 오늘데이터고, B위젯에서 보는 데이터는 어제 데이터면 안된다. 이렇게 일관된 데이터에 모든 위젯이 접근하기 위해서는 상태관리가 필수 인데, 기존 Dart의 <code class="language-plaintext highlighter-rouge">Stateless Widget</code>과 <code class="language-plaintext highlighter-rouge">Stateful Widget</code>위젯으로 상태 관리를 하면, 부모 위젯/자식 위젯끼리 데이터를 일일히 전달하고 받고 어쩌고 난리난리를 피워야하기 때문에, 이 때 유용한 것이 <code class="language-plaintext highlighter-rouge">provider</code>이다.</p><p>공유가 필요한 데이터의 <code class="language-plaintext highlighter-rouge">provider</code>를 만들어주고 거기에 해당 데이터와 제어할 수 있는 동작을 담아두면 <code class="language-plaintext highlighter-rouge">provider</code>가 정한 범위 내 속하는 어떠한 위젯이든 신선한 데이터에 아주 편하게 다이렉트로 접근을 할 수 있게 된다.</p><p><code class="language-plaintext highlighter-rouge">provider</code>에도 다양한 패키지가 있던데 나는 이번에 <a href="https://pub.dev/packages/flutter_state_notifier">flutter_state_notifier</a>를 사용했다. 필요한 패키지는 적재적소에 알아서 추가해 주자.</p><ul><li><a href="https://pub.dev/packages/flutter_state_notifier">flutter_state_notifier</a> : <code class="language-plaintext highlighter-rouge">main.dart</code><li><a href="https://pub.dev/packages/provider">provider</a> : <code class="language-plaintext highlighter-rouge">provider</code>사용하는 곳에 필요<li><a href="https://pub.dev/packages/hive_flutter">flutter_hive</a> : <code class="language-plaintext highlighter-rouge">provider</code>에서 접근하므로 <code class="language-plaintext highlighter-rouge">provider</code>에 필요</ul><p><code class="language-plaintext highlighter-rouge">provider</code>를 사용하기까지!</p><p>① <code class="language-plaintext highlighter-rouge">provider</code>를 정의한다<br /> ② <code class="language-plaintext highlighter-rouge">provider</code>를 생성한다(범위지정)<br /> ③ <code class="language-plaintext highlighter-rouge">provider</code>를 사용한다</p><p>말은 쉽다. 하나씩 해보자…</p><p>① <code class="language-plaintext highlighter-rouge">provider</code>를 정의한다</p><p>우리는 user에 대한 DB, message에 대한 DB를 만들어 줘야 한다.</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30% 30%'%3E%3C/svg%3E" data-src="/assets/img/2022-09-03-Flutter-Simple-Chat-UI-EX02/SimulSc_ex_29.png" alt="Flutter Simple chat UI ex 29" width="30%" height="30%" data-proofer-ignore></p><p>그러니까 <code class="language-plaintext highlighter-rouge">providers</code>라는 폴더를 만들어서 <code class="language-plaintext highlighter-rouge">users.dart</code> 와 <code class="language-plaintext highlighter-rouge">messages.dart</code>라는 파일을 만들어 주었다. 여기서는 <code class="language-plaintext highlighter-rouge">users.dart</code>을 기준으로 기록해두겠다. <code class="language-plaintext highlighter-rouge">messages.dart</code>도 구조는 비슷하다.</p><p><code class="language-plaintext highlighter-rouge">users.dart</code>에는 크게 상태를 관리하는 클래스 <code class="language-plaintext highlighter-rouge">UserListPrState</code>와 제어를 위한 클래스 <code class="language-plaintext highlighter-rouge">UserListController</code>가 있다. user 정보를 획득만 하고 싶으면 <code class="language-plaintext highlighter-rouge">UserListPrState</code>를 통해서, user 정보를 수정하거나 삭제하거나 하고 싶으면 <code class="language-plaintext highlighter-rouge">UserListController</code>를 통해서 하면 된다는 뜻.</p><p>따라서 <code class="language-plaintext highlighter-rouge">UserListPrState</code>에서는 hive에 저장된 유저정보를 읽어들이고, 변경된 상태가 있으면 저장할 수 있는 기능을, <code class="language-plaintext highlighter-rouge">UserListController</code>에는 필요한 제어 함수를 작성하면 된다.</p><div file="/lib/providers/users.dart" class="language-dart highlighter-rouge"><div class="code-header"> <span data-label-text="/lib/providers/users.dart"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="s">'package:hive_flutter/hive_flutter.dart'</span><span class="o">;</span>
<span class="kn">import</span> <span class="s">'package:flt_simple_chat_ex/models/chatUsersModel.dart'</span><span class="o">;</span>

<span class="n">Box</span><span class="p">&lt;</span><span class="n">ChatUsers</span><span class="p">&gt;</span><span class="o">?</span> <span class="n">userList</span> <span class="o">=</span> <span class="n">Hive</span><span class="o">.</span><span class="na">box</span><span class="p">(</span><span class="s">'users_log'</span><span class="p">);</span>

<span class="kd">class</span> <span class="nc">UserListPrState</span> <span class="p">{</span>
  <span class="kt">List</span><span class="p">&lt;</span><span class="n">ChatUsers</span><span class="p">&gt;</span> <span class="n">users</span><span class="p">;</span>

  <span class="n">UserListPrState</span><span class="p">({</span>
    <span class="kd">required</span> <span class="k">this</span><span class="o">.</span><span class="na">users</span><span class="p">,</span>
  <span class="p">});</span>

  <span class="kd">factory</span> <span class="n">UserListPrState</span><span class="o">.</span><span class="na">initial</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">UserListPrState</span><span class="p">(</span><span class="nl">users:</span> <span class="n">userList</span><span class="o">!.</span><span class="na">values</span><span class="o">.</span><span class="na">toList</span><span class="p">());</span>
  <span class="p">}</span>

  <span class="n">UserListPrState</span> <span class="n">copyWith</span><span class="p">({</span>
    <span class="kt">List</span><span class="p">&lt;</span><span class="n">ChatUsers</span><span class="p">&gt;</span><span class="o">?</span> <span class="n">users_cp</span><span class="p">,</span>
  <span class="p">})</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">UserListPrState</span><span class="p">(</span>
      <span class="nl">users:</span> <span class="n">users_cp</span> <span class="o">??</span> <span class="n">users</span><span class="p">,</span>
    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">UserListController</span> <span class="kd">extends</span> <span class="n">StateNotifier</span><span class="p">&lt;</span><span class="n">UserListPrState</span><span class="p">&gt;</span> <span class="p">{</span>
  <span class="n">UserListController</span><span class="p">()</span> <span class="o">:</span> <span class="k">super</span><span class="p">(</span><span class="n">UserListPrState</span><span class="o">.</span><span class="na">initial</span><span class="p">());</span>

  <span class="c1">// 유저 추가</span>
  <span class="kt">void</span> <span class="n">addUser</span><span class="p">(</span><span class="n">ChatUsers</span> <span class="n">user</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">final</span> <span class="n">_users</span> <span class="o">=</span> <span class="p">[..</span><span class="o">.</span><span class="na">state</span><span class="o">.</span><span class="na">users</span><span class="p">,</span> <span class="n">user</span><span class="p">];</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="na">copyWith</span><span class="p">(</span><span class="nl">users_cp:</span> <span class="n">_users</span><span class="p">);</span> <span class="c1">// 상태 변경</span>
    <span class="n">userList</span><span class="o">!.</span><span class="na">put</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="na">id</span><span class="p">,</span> <span class="n">user</span><span class="p">);</span> <span class="c1">// 데이터베이스 저장</span>
  <span class="p">}</span>

  <span class="c1">// 유저 삭제 (1명)</span>
  <span class="kt">void</span> <span class="n">deleteUser</span><span class="p">(</span><span class="n">ChatUsers</span> <span class="n">user</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">final</span> <span class="n">_users</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="na">users</span><span class="o">.</span><span class="na">where</span><span class="p">((</span><span class="n">m</span><span class="p">)</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">m</span><span class="o">.</span><span class="na">name</span> <span class="o">!=</span> <span class="n">user</span><span class="o">.</span><span class="na">name</span><span class="p">)</span><span class="o">.</span><span class="na">toList</span><span class="p">();</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="na">copyWith</span><span class="p">(</span><span class="nl">users_cp:</span> <span class="n">_users</span><span class="p">);</span> <span class="c1">// 상태 변경</span>
    <span class="n">userList</span><span class="o">!.</span><span class="na">delete</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="na">id</span><span class="p">);</span> <span class="c1">// 데이터베이스 저장</span>
  <span class="p">}</span>

  <span class="c1">// 유저 전부 삭제</span>
  <span class="kt">void</span> <span class="n">clearUser</span><span class="p">()</span> <span class="kd">async</span> <span class="p">{</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="na">copyWith</span><span class="p">(</span><span class="nl">users_cp:</span> <span class="p">[]);</span>
    <span class="k">await</span> <span class="n">userList</span><span class="o">!.</span><span class="na">clear</span><span class="p">();</span>

  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>필요한 함수가 있으면 <code class="language-plaintext highlighter-rouge">UserListController</code>에 마구마구 추가해주면 된다. 여기서 맨 처음에 <code class="language-plaintext highlighter-rouge">Box&lt;ChatUsers&gt;? userList = Hive.box('users_log');</code> 라는 걸 선언해 주었는데, ‘users_log’라는 이름의 user정보를 담는 박스가 곧 데이터베이스가 되는 것이다. 따라서 변수 <code class="language-plaintext highlighter-rouge">userList</code>는 곧 데이터베이스!</p><p>처음에 box를 생성할 때는 반드시</p><ol><li>초기화를 해주고<li>위에서 생성한 TypeAdapter 등록해주고<li>openbox를 해줘야하는데</ol><p>그걸 이렇게 <code class="language-plaintext highlighter-rouge">main.dart</code>에서 해주면 된다.</p><div file="/lib/main.dart" class="language-dart highlighter-rouge"><div class="code-header"> <span data-label-text="/lib/main.dart"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="kt">void</span> <span class="nf">main</span><span class="p">()</span> <span class="kd">async</span> <span class="p">{</span>
  <span class="k">await</span> <span class="n">Hive</span><span class="o">.</span><span class="na">initFlutter</span><span class="p">();</span> <span class="c1">//초기화</span>
  <span class="n">Hive</span><span class="o">.</span><span class="na">registerAdapter</span><span class="p">(</span><span class="n">ChatUsersAdapter</span><span class="p">());</span> <span class="c1">// TypeAdapter 등록</span>
  <span class="n">Hive</span><span class="o">.</span><span class="na">registerAdapter</span><span class="p">(</span><span class="n">ChatMessageAdapter</span><span class="p">());</span> <span class="c1">// TypeAdapter 등록</span>

  <span class="k">await</span> <span class="n">Hive</span><span class="o">.</span><span class="na">deleteFromDisk</span><span class="p">();</span>

  <span class="k">await</span> <span class="n">Hive</span><span class="o">.</span><span class="na">openBox</span><span class="p">&lt;</span><span class="n">ChatUsers</span><span class="p">&gt;(</span><span class="s">'users_log'</span><span class="p">);</span> <span class="c1">// openbox</span>
  <span class="k">await</span> <span class="n">Hive</span><span class="o">.</span><span class="na">openBox</span><span class="p">&lt;</span><span class="n">ChatMessage</span><span class="p">&gt;(</span><span class="s">'messages_log'</span><span class="p">);</span> <span class="c1">// openbox</span>

  <span class="n">runApp</span><span class="p">(</span>
    <span class="n">MyApp</span><span class="p">(),</span>
  <span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><p>openbox를 해준 다음에는 <code class="language-plaintext highlighter-rouge">users.dart</code>에서 처럼 <code class="language-plaintext highlighter-rouge">Hive.box</code>만으로 접근할 수 있게 된다.</p><p>② <code class="language-plaintext highlighter-rouge">provider</code>를 생성한다(범위지정)</p><p><code class="language-plaintext highlighter-rouge">provider</code>의 범위는 그 <code class="language-plaintext highlighter-rouge">provider</code>를 생성한 그 부모위젯에 속하는 모든 자식위젯이 된다. 그래서 일반적으로는 앱 가장 상위에 있는 위젯에 생성하는 것 같다 (구글링해보니까 대부분 그렇게 쓰던데 아닐 수도 있음)</p><p>나는 주제에 다른데 써보겠다고 혼자 머리싸메다가 많은 일을 겪고 결국 <code class="language-plaintext highlighter-rouge">main.dart</code>에 <code class="language-plaintext highlighter-rouge">MaterialApp()</code>에 생성해 주었다ㅎ 사서 고생을 한다.</p><div file="/lib/main.dart" class="language-dart highlighter-rouge"><div class="code-header"> <span data-label-text="/lib/main.dart"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">MyApp</span> <span class="kd">extends</span> <span class="n">StatelessWidget</span> <span class="p">{</span>
  <span class="nd">@override</span>
  <span class="n">Widget</span> <span class="n">build</span><span class="p">(</span><span class="n">BuildContext</span> <span class="n">context</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// provider 생성</span>
    <span class="k">return</span> <span class="n">MultiProvider</span><span class="p">(</span>
      <span class="nl">providers:</span> <span class="p">[</span>
        <span class="n">StateNotifierProvider</span><span class="p">&lt;</span><span class="n">MessageListController</span><span class="p">,</span> <span class="n">MessageListPrState</span><span class="p">&gt;(</span>
          <span class="nl">create:</span> <span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">MessageListController</span><span class="p">(),</span>
        <span class="p">),</span>
        <span class="n">StateNotifierProvider</span><span class="p">&lt;</span><span class="n">UserListController</span><span class="p">,</span> <span class="n">UserListPrState</span><span class="p">&gt;(</span>
          <span class="nl">create:</span> <span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">UserListController</span><span class="p">(),</span>
        <span class="p">),</span>
      <span class="p">],</span>
    <span class="c1">// provider 생성</span>
      <span class="nl">builder:</span> <span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">child</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">MaterialApp</span><span class="p">(</span>
            <span class="nl">title:</span> <span class="s">'Flutter Demo'</span><span class="p">,</span>
            <span class="nl">theme:</span> <span class="n">ThemeData</span><span class="p">(</span>
              <span class="nl">primarySwatch:</span> <span class="n">Colors</span><span class="o">.</span><span class="na">blue</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="nl">debugShowCheckedModeBanner:</span> <span class="kc">false</span><span class="p">,</span>
            <span class="nl">home:</span> <span class="n">HomePage</span><span class="p">());</span>
      <span class="p">},</span>
    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>이렇게 생성된 <code class="language-plaintext highlighter-rouge">provider</code>는 <code class="language-plaintext highlighter-rouge">MaterialApp</code>을 포함한 이하에 존재하는 모든 위젯에서 접근할 수 있게 된다. (<code class="language-plaintext highlighter-rouge">MyApp</code>에서는 접근 못함 주의!)<br /> <code class="language-plaintext highlighter-rouge">MultiProvider</code>는 여러 프로바이더를 관리할 수 있게 해주는 위젯인데, 앞으로 얼마나 늘어날지 몰라서 그냥 썼다.</p><p>③ <code class="language-plaintext highlighter-rouge">provider</code>를 사용한다</p><p>이제 필요한 위젯에서 접근하거나 제어해주면 된다. 지금은 주로 <code class="language-plaintext highlighter-rouge">chatPage.dart</code>에서 <code class="language-plaintext highlighter-rouge">users</code>에, <code class="language-plaintext highlighter-rouge">chatDetailPage.dart</code>에서 <code class="language-plaintext highlighter-rouge">messages</code>접근하게 될텐데, 메세지 로그의 저장은 다음 포스팅에 기록하기로 하고, 이번엔 <code class="language-plaintext highlighter-rouge">chatPage.dart</code>에서 유저를 추가하고 삭제(+그 정보는 저장)하는 걸 해보자.</p><p><code class="language-plaintext highlighter-rouge">_ChatPageState</code> 클래스에서 user의 상태를 취득하고 제어(추가, 삭제)를 할 수 있도록 먼저 프로바이더에 접근해준다.</p><div file="/lib/screen/chatPage.dart" class="language-dart highlighter-rouge"><div class="code-header"> <span data-label-text="/lib/screen/chatPage.dart"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre> <span class="nd">@override</span>
  <span class="n">Widget</span> <span class="n">build</span><span class="p">(</span><span class="n">BuildContext</span> <span class="n">context</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">final</span> <span class="kt">List</span><span class="p">&lt;</span><span class="n">ChatUsers</span><span class="p">&gt;</span> <span class="n">_ustate</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">watch</span><span class="p">&lt;</span><span class="n">UserListPrState</span><span class="p">&gt;()</span><span class="o">.</span><span class="na">users</span><span class="p">;</span> <span class="c1">// 상태 취득</span>
    <span class="kd">final</span> <span class="n">_uctlr</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">read</span><span class="p">&lt;</span><span class="n">UserListController</span><span class="p">&gt;();</span> <span class="c1">// 제어</span>
</pre></table></code></div></div><ul><li>유저를 등록 : <code class="language-plaintext highlighter-rouge">Add new</code> 버튼을 눌렀을 때, <code class="language-plaintext highlighter-rouge">_uctlr.addUser(_user);</code>를 실행</ul><div file="/lib/screen/chatPage.dart" class="language-dart highlighter-rouge"><div class="code-header"> <span data-label-text="/lib/screen/chatPage.dart"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
</pre><td class="rouge-code"><pre>                    <span class="n">Container</span><span class="p">(</span>
                      <span class="nl">padding:</span>
                          <span class="n">EdgeInsets</span><span class="o">.</span><span class="na">only</span><span class="p">(</span><span class="nl">left:</span> <span class="mi">8</span><span class="p">,</span> <span class="nl">right:</span> <span class="mi">8</span><span class="p">,</span> <span class="nl">top:</span> <span class="mi">2</span><span class="p">,</span> <span class="nl">bottom:</span> <span class="mi">2</span><span class="p">),</span>
                      <span class="nl">height:</span> <span class="mi">30</span><span class="p">,</span>
                      <span class="nl">decoration:</span> <span class="n">BoxDecoration</span><span class="p">(</span>
                        <span class="nl">borderRadius:</span> <span class="n">BorderRadius</span><span class="o">.</span><span class="na">circular</span><span class="p">(</span><span class="mi">30</span><span class="p">),</span>
                        <span class="nl">color:</span> <span class="n">Colors</span><span class="o">.</span><span class="na">pink</span><span class="p">[</span><span class="mi">50</span><span class="p">],</span>
                      <span class="p">),</span>
                      <span class="nl">child:</span> <span class="n">GestureDetector</span><span class="p">(</span>
                        <span class="c1">//add, GestureDetector</span>
                        <span class="nl">onTap:</span> <span class="p">()</span> <span class="kd">async</span> <span class="p">{</span>
                          <span class="n">print</span><span class="p">(</span><span class="s">"ADD NEW PRESSED"</span><span class="p">);</span>
                          <span class="kd">late</span> <span class="kd">final</span> <span class="n">_user</span><span class="p">;</span>

                          <span class="n">DateTime</span> <span class="n">now</span> <span class="o">=</span> <span class="n">DateTime</span><span class="o">.</span><span class="na">now</span><span class="p">();</span>
                          <span class="kt">String</span> <span class="n">nowstring</span> <span class="o">=</span>
                              <span class="k">new</span> <span class="n">DateFormat</span><span class="o">.</span><span class="na">yMMMd</span><span class="p">(</span><span class="s">'en_US'</span><span class="p">)</span><span class="o">.</span><span class="na">format</span><span class="p">(</span><span class="n">now</span><span class="p">);</span>

                          <span class="kt">String</span><span class="o">?</span> <span class="n">tempusername</span> <span class="o">=</span> <span class="k">await</span> <span class="n">InputDialog</span><span class="p">(</span><span class="n">context</span><span class="p">);</span>
                          <span class="k">if</span> <span class="p">(</span><span class="n">tempusername</span> <span class="o">==</span> <span class="s">""</span> <span class="o">||</span> <span class="n">tempusername</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
                            <span class="n">print</span><span class="p">(</span><span class="s">"User Name is Empty!"</span><span class="p">);</span>
                            <span class="n">tempusername</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
                          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                            <span class="n">print</span><span class="p">(</span><span class="s">"Save to Database"</span><span class="p">);</span>
                            <span class="kt">String</span> <span class="n">thisusername</span> <span class="o">=</span> <span class="n">tempusername</span><span class="p">;</span>
                            <span class="n">setState</span><span class="p">(()</span> <span class="p">{</span>
                              <span class="n">_user</span> <span class="o">=</span> <span class="n">ChatUsers</span><span class="p">(</span>
                                  <span class="nl">name:</span> <span class="n">thisusername</span><span class="p">,</span>
                                  <span class="nl">statusmsg:</span> <span class="s">" "</span><span class="p">,</span>
                                  <span class="nl">messageText:</span> <span class="s">" "</span><span class="p">,</span>
                                  <span class="nl">imageURL:</span>
                                      <span class="s">"https://randomuser.me/api/portraits/men/6.jpg"</span><span class="p">,</span>
                                  <span class="nl">time:</span> <span class="n">nowstring</span><span class="p">,</span>
                                  <span class="nl">bgdimage:</span> <span class="n">File</span><span class="p">(</span><span class="s">"초기 셋팅할 String 타입 이미지경로 입력"</span><span class="p">));</span>

                              <span class="n">_uctlr</span><span class="o">.</span><span class="na">addUser</span><span class="p">(</span><span class="n">_user</span><span class="p">);</span>

                              <span class="n">_textFieldController</span><span class="o">.</span><span class="na">clear</span><span class="p">();</span>
                            <span class="p">});</span>
                          <span class="p">}</span>
                          <span class="n">_uctlr</span><span class="o">.</span><span class="na">printUser</span><span class="p">();</span>
                        <span class="p">},</span>
                        <span class="nl">child:</span> <span class="n">Row</span><span class="p">(</span>
                          <span class="nl">children:</span> <span class="p">&lt;</span><span class="n">Widget</span><span class="p">&gt;[</span>
                            <span class="n">Icon</span><span class="p">(</span>
                              <span class="n">Icons</span><span class="o">.</span><span class="na">add</span><span class="p">,</span>
                              <span class="nl">color:</span> <span class="n">Colors</span><span class="o">.</span><span class="na">pink</span><span class="p">,</span>
                              <span class="nl">size:</span> <span class="mi">20</span><span class="p">,</span>
                            <span class="p">),</span>
                            <span class="n">SizedBox</span><span class="p">(</span>
                              <span class="nl">width:</span> <span class="mi">2</span><span class="p">,</span>
                            <span class="p">),</span>
                            <span class="n">Text</span><span class="p">(</span>
                              <span class="s">"Add New"</span><span class="p">,</span>
                              <span class="nl">style:</span> <span class="n">TextStyle</span><span class="p">(</span>
                                  <span class="nl">fontSize:</span> <span class="mi">14</span><span class="p">,</span> <span class="nl">fontWeight:</span> <span class="n">FontWeight</span><span class="o">.</span><span class="na">bold</span><span class="p">),</span>
                            <span class="p">),</span>
                          <span class="p">],</span>
                        <span class="p">),</span>
                      <span class="p">),</span>
                    <span class="p">)</span>

</pre></table></code></div></div><p>※ Dart의 <code class="language-plaintext highlighter-rouge">late</code>선언은 반드시 값이 필요한 (null이면 안되는, non-nullable) 변수지만, 선언과 동시에 초기화를 하지 않을 때 사용한다. 변수의 초기화를 뒤로 밀어줄 수 있는 것.</p><ul><li>등록된 모든 유저를 삭제 : <code class="language-plaintext highlighter-rouge">Clear</code> 버튼을 눌렀을때 <code class="language-plaintext highlighter-rouge">_uctlr.clearUser();</code>를 실행</ul><div file="/lib/screen/chatPage.dart" class="language-dart highlighter-rouge"><div class="code-header"> <span data-label-text="/lib/screen/chatPage.dart"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre><td class="rouge-code"><pre>                    <span class="n">Container</span><span class="p">(</span>
                      <span class="nl">padding:</span>
                          <span class="n">EdgeInsets</span><span class="o">.</span><span class="na">only</span><span class="p">(</span><span class="nl">left:</span> <span class="mi">8</span><span class="p">,</span> <span class="nl">right:</span> <span class="mi">8</span><span class="p">,</span> <span class="nl">top:</span> <span class="mi">2</span><span class="p">,</span> <span class="nl">bottom:</span> <span class="mi">2</span><span class="p">),</span>
                      <span class="nl">height:</span> <span class="mi">30</span><span class="p">,</span>
                      <span class="nl">decoration:</span> <span class="n">BoxDecoration</span><span class="p">(</span>
                        <span class="nl">borderRadius:</span> <span class="n">BorderRadius</span><span class="o">.</span><span class="na">circular</span><span class="p">(</span><span class="mi">30</span><span class="p">),</span>
                        <span class="nl">color:</span> <span class="n">Colors</span><span class="o">.</span><span class="na">green</span><span class="p">[</span><span class="mi">50</span><span class="p">],</span>
                      <span class="p">),</span>
                      <span class="nl">child:</span> <span class="n">GestureDetector</span><span class="p">(</span>
                        <span class="nl">onTap:</span> <span class="p">()</span> <span class="kd">async</span> <span class="p">{</span>
                          <span class="n">_uctlr</span><span class="o">.</span><span class="na">clearUser</span><span class="p">();</span> <span class="c1">//모든 유저를 삭제</span>
                        <span class="p">},</span>
                        <span class="nl">child:</span> <span class="n">Row</span><span class="p">(</span>
                          <span class="nl">children:</span> <span class="p">&lt;</span><span class="n">Widget</span><span class="p">&gt;[</span>
                            <span class="n">Icon</span><span class="p">(</span>
                              <span class="n">Icons</span><span class="o">.</span><span class="na">cancel</span><span class="p">,</span>
                              <span class="nl">color:</span> <span class="n">Colors</span><span class="o">.</span><span class="na">green</span><span class="p">,</span>
                              <span class="nl">size:</span> <span class="mi">20</span><span class="p">,</span>
                            <span class="p">),</span>
                            <span class="n">SizedBox</span><span class="p">(</span>
                              <span class="nl">width:</span> <span class="mi">2</span><span class="p">,</span>
                            <span class="p">),</span>
                            <span class="n">Text</span><span class="p">(</span>
                              <span class="s">"Clear"</span><span class="p">,</span>
                              <span class="nl">style:</span> <span class="n">TextStyle</span><span class="p">(</span>
                                  <span class="nl">fontSize:</span> <span class="mi">14</span><span class="p">,</span> <span class="nl">fontWeight:</span> <span class="n">FontWeight</span><span class="o">.</span><span class="na">bold</span><span class="p">),</span>
                            <span class="p">),</span>
                          <span class="p">],</span>
                        <span class="p">),</span>
                      <span class="p">),</span>
                    <span class="p">),</span>
</pre></table></code></div></div><ul><li><p>지정한 유저를 삭제 : 리스트뷰의 특정 유저를 옆으로 스와이프를 했을 때, <code class="language-plaintext highlighter-rouge">_ustate.removeAt(index);</code> 실행</p><p>이때, <code class="language-plaintext highlighter-rouge">_uctlr</code>이 아닌 <code class="language-plaintext highlighter-rouge">_ustate</code>를 사용하는데 좀 위화감이 있긴한데, (유저의 id를 획득해 와서 유저를 특정해서 그 유저를 지우는 것보다) 리스트뷰의 index(몇 번째 유저인지)를 이용하여 컨트롤을 해주는게 더 코드가 간단해서 이렇게 해줬다.</p></ul><div file="/lib/screen/chatPage.dart" class="language-dart highlighter-rouge"><div class="code-header"> <span data-label-text="/lib/screen/chatPage.dart"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre><td class="rouge-code"><pre>              <span class="n">ListView</span><span class="o">.</span><span class="na">builder</span><span class="p">(</span>
                <span class="nl">itemCount:</span> <span class="n">_ustate</span><span class="o">.</span><span class="na">length</span><span class="p">,</span>
                <span class="nl">shrinkWrap:</span> <span class="kc">true</span><span class="p">,</span>
                <span class="nl">padding:</span> <span class="n">EdgeInsets</span><span class="o">.</span><span class="na">only</span><span class="p">(</span><span class="nl">top:</span> <span class="mi">16</span><span class="p">),</span>
                <span class="nl">physics:</span> <span class="n">NeverScrollableScrollPhysics</span><span class="p">(),</span>
                <span class="nl">itemBuilder:</span> <span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span> <span class="p">{</span>
                  <span class="k">return</span> <span class="n">Dismissible</span><span class="p">(</span>
                    <span class="c1">//사이드 스와이프로 삭제</span>
                    <span class="nl">key:</span> <span class="n">UniqueKey</span><span class="p">(),</span>
                    <span class="nl">onDismissed:</span> <span class="p">(</span><span class="n">DismissDirection</span> <span class="n">direction</span><span class="p">)</span> <span class="p">{</span>
                      <span class="n">ScaffoldMessenger</span><span class="o">.</span><span class="na">of</span><span class="p">(</span><span class="n">context</span><span class="p">)</span><span class="o">.</span><span class="na">showSnackBar</span><span class="p">(</span><span class="n">SnackBar</span><span class="p">(</span>
                          <span class="nl">content:</span> <span class="n">Text</span><span class="p">(</span><span class="s">'</span><span class="si">${_ustate[index].name}</span><span class="s"> dismissed'</span><span class="p">)));</span>
                      <span class="n">setState</span><span class="p">(()</span> <span class="p">{</span>
                        <span class="n">_ustate</span><span class="o">.</span><span class="na">removeAt</span><span class="p">(</span><span class="n">index</span><span class="p">);</span>
                      <span class="p">});</span>
                    <span class="p">},</span>
                    <span class="nl">background:</span> <span class="n">Container</span><span class="p">(</span>
                      <span class="nl">color:</span> <span class="n">Colors</span><span class="o">.</span><span class="na">red</span><span class="p">,</span>
                    <span class="p">),</span>
                    <span class="nl">child:</span> <span class="n">ConversationList</span><span class="p">(</span>
                      <span class="nl">id:</span> <span class="n">_ustate</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="na">id</span><span class="p">,</span>
                      <span class="nl">name:</span> <span class="n">_ustate</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="na">name</span><span class="p">,</span>
                      <span class="nl">messageText:</span> <span class="n">_ustate</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="na">messageText</span><span class="p">,</span>
                      <span class="nl">imageUrl:</span> <span class="n">_ustate</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="na">imageURL</span><span class="p">,</span>
                      <span class="nl">time:</span> <span class="n">_ustate</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="na">time</span><span class="p">,</span>
                      <span class="nl">isMessageRead:</span> <span class="p">(</span><span class="n">index</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="o">?</span> <span class="kc">true</span> <span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
                      <span class="nl">user:</span> <span class="n">_ustate</span><span class="p">[</span><span class="n">index</span><span class="p">],</span>
                    <span class="p">),</span>
                  <span class="p">);</span>
                <span class="p">},</span>
              <span class="p">),</span>
</pre></table></code></div></div><p>이런식으로 사용해주면 되는 것이다…………<br /> 중간에 DB에 저장은 되는데 UI에 업데이트가 안되는 미치겠는 상황이 있었는데, 앱을 restart 했더니 해결되었다…(빡)</p><p>결과, 요렇게 동작을 한다</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30% 30%'%3E%3C/svg%3E" data-src="/assets/img/2022-09-03-Flutter-Simple-Chat-UI-EX02/SimulSc_ex_29.gif" alt="Flutter Simple chat UI ex 29" width="30%" height="30%" data-proofer-ignore></p><h1 id="userdetailpage--유저-데이터-갱신-상태창-생성">userDetailPage : 유저 데이터 갱신, 상태창 생성</h1><h2 id="상대의-프로필-사진-클릭-시-상태창-표시"><span class="mr-2">상대의 프로필 사진 클릭 시, 상태창 표시</span><a href="#상대의-프로필-사진-클릭-시-상태창-표시" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>일단은 프로필을 구현한 <code class="language-plaintext highlighter-rouge">conversationList.dart</code>에 가서, 라운드한 프로필 모양에 따라 터치 이벤트를 발생시켜주면 되는데, 방법에는 여러가지가 있다.</p><p>방법1. <code class="language-plaintext highlighter-rouge">InkWell</code>사용 : 프로필 사진의 원을 포함하는 사각형 모양으로 터치 반응</p><div file="/lib/widgets/conversationList.dart" class="language-dart highlighter-rouge"><div class="code-header"> <span data-label-text="/lib/widgets/conversationList.dart"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>                <span class="n">InkWell</span><span class="p">(</span>
                    <span class="nl">onTap:</span> <span class="p">()</span> <span class="p">{</span>
                      <span class="n">print</span><span class="p">(</span><span class="s">"CircleAvatar touch"</span><span class="p">);</span>
                    <span class="p">},</span>
                    <span class="nl">child:</span> <span class="n">CircleAvatar</span><span class="p">(</span>
                      <span class="nl">backgroundImage:</span> <span class="n">NetworkImage</span><span class="p">(</span><span class="n">widget</span><span class="o">.</span><span class="na">imageUrl</span><span class="p">),</span>
                      <span class="nl">maxRadius:</span> <span class="mi">30</span><span class="p">,</span>
                    <span class="p">),</span>
                  <span class="p">),</span>
</pre></table></code></div></div><p>방법2. <code class="language-plaintext highlighter-rouge">GestureDetector</code>사용 : 프로필 사진의 원 모양으로 터치 반응</p><div file="/lib/widgets/conversationList.dart" class="language-dart highlighter-rouge"><div class="code-header"> <span data-label-text="/lib/widgets/conversationList.dart"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>                <span class="n">Column</span><span class="p">(</span><span class="nl">children:</span> <span class="p">&lt;</span><span class="n">Widget</span><span class="p">&gt;[</span>
                    <span class="n">SizedBox</span><span class="p">(</span><span class="nl">height:</span> <span class="mf">30.0</span><span class="p">),</span>
                    <span class="n">GestureDetector</span><span class="p">(</span>
                      <span class="nl">onTap:</span> <span class="p">()</span> <span class="p">{</span>
                        <span class="n">print</span><span class="p">(</span><span class="s">"CircleAvatar touch"</span><span class="p">);</span>
                      <span class="p">},</span>
                      <span class="nl">child:</span> <span class="n">CircleAvatar</span><span class="p">(</span>
                        <span class="nl">backgroundImage:</span> <span class="n">NetworkImage</span><span class="p">(</span><span class="n">widget</span><span class="o">.</span><span class="na">imageUrl</span><span class="p">),</span>
                        <span class="nl">maxRadius:</span> <span class="mi">30</span><span class="p">,</span>
                      <span class="p">),</span>
                    <span class="p">)</span>
                  <span class="p">]),</span>
</pre></table></code></div></div><p>방법3. <code class="language-plaintext highlighter-rouge">RawMaterialButton</code>사용 : 프로필 사진의 원 모양으로 터치 반응</p><div file="/lib/widgets/conversationList.dart" class="language-dart highlighter-rouge"><div class="code-header"> <span data-label-text="/lib/widgets/conversationList.dart"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre>                <span class="n">Stack</span><span class="p">(</span>
                    <span class="nl">children:</span> <span class="p">&lt;</span><span class="n">Widget</span><span class="p">&gt;[</span>
                      <span class="n">CircleAvatar</span><span class="p">(</span>
                        <span class="nl">backgroundImage:</span> <span class="n">NetworkImage</span><span class="p">(</span><span class="n">widget</span><span class="o">.</span><span class="na">imageUrl</span><span class="p">),</span>
                        <span class="nl">maxRadius:</span> <span class="mi">30</span><span class="p">,</span>
                      <span class="p">),</span>
                      <span class="n">RawMaterialButton</span><span class="p">(</span>
                        <span class="nl">onPressed:</span> <span class="p">()</span> <span class="p">{</span>
                          <span class="n">print</span><span class="p">(</span><span class="s">"CircleAvatar touch"</span><span class="p">);</span>
                        <span class="p">},</span>
                        <span class="nl">child:</span> <span class="n">Container</span><span class="p">(</span>
                          <span class="nl">width:</span> <span class="mf">60.0</span><span class="p">,</span> <span class="c1">// CircleAvatarのradiusの2倍</span>
                          <span class="nl">height:</span> <span class="mf">60.0</span><span class="p">,</span>
                        <span class="p">),</span>
                        <span class="nl">shape:</span> <span class="k">new</span> <span class="n">CircleBorder</span><span class="p">(),</span>
                        <span class="nl">elevation:</span> <span class="mf">0.0</span><span class="p">,</span>
                      <span class="p">),</span>
                    <span class="p">],</span>
                  <span class="p">),</span>
</pre></table></code></div></div><p>하여튼 <code class="language-plaintext highlighter-rouge">CircleAvatar</code>을 <code class="language-plaintext highlighter-rouge">child</code>로 두는 포함하는 버튼/제스처 위젯을 사용하든, <code class="language-plaintext highlighter-rouge">Stack</code>으로 <code class="language-plaintext highlighter-rouge">CircleAvatar</code>과 버튼 위젯을 겹쳐주든 하면 된다. 이외에도 방법은 여러가지가 있을 듯. 나는 방법1 사용.</p><p>이제, 터치하면 새로운 페이지로 상태창을 띄워줄것이다 지금 위에 코드에서 <code class="language-plaintext highlighter-rouge">print("CircleAvatar touch");</code>라고 되어있는 부분에 실제 코드를 넣어주면 된다.<br /> 상태창을 그려줄 <code class="language-plaintext highlighter-rouge">userDetailPage.dart</code>를 <code class="language-plaintext highlighter-rouge">screen</code>폴더에 추가해 주었다.<br /> 그리고 상태창에서 유저의 여러 속성에 접근하고 수정할 거라서 <code class="language-plaintext highlighter-rouge">chatDetailPage</code>에서처럼 유저의 속성을 <code class="language-plaintext highlighter-rouge">id</code>, <code class="language-plaintext highlighter-rouge">imageUrl</code>같이 각각 전달하지 않고 그냥 <code class="language-plaintext highlighter-rouge">ChatUsers</code> 클래스 전체를 전달했다. (그김에 <code class="language-plaintext highlighter-rouge">chatDetailPage</code>도 동일하게 수정)</p><div file="/lib/screen/userDetailPage.dart" class="language-dart highlighter-rouge"><div class="code-header"> <span data-label-text="/lib/screen/userDetailPage.dart"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="s">'package:flutter/material.dart'</span><span class="o">;</span>

<span class="kd">class</span> <span class="nc">UserDetailPage</span> <span class="kd">extends</span> <span class="n">StatefulWidget</span> <span class="p">{</span>
  <span class="n">ChatUsers</span> <span class="n">user</span><span class="p">;</span>

  <span class="n">UserDetailPage</span><span class="p">({</span>
    <span class="n">Key</span><span class="o">?</span> <span class="n">key</span><span class="p">,</span>
    <span class="kd">required</span> <span class="k">this</span><span class="o">.</span><span class="na">user</span><span class="p">,</span>
  <span class="p">})</span> <span class="o">:</span> <span class="k">super</span><span class="p">(</span><span class="nl">key:</span> <span class="n">key</span><span class="p">);</span>

  <span class="nd">@override</span>
  <span class="n">_UserDetailPageState</span> <span class="n">createState</span><span class="p">()</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">_UserDetailPageState</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">_UserDetailPageState</span> <span class="kd">extends</span> <span class="n">State</span><span class="p">&lt;</span><span class="n">UserDetailPage</span><span class="p">&gt;</span> <span class="p">{</span>
  <span class="nd">@override</span>
  <span class="n">Widget</span> <span class="n">build</span><span class="p">(</span><span class="n">BuildContext</span> <span class="n">context</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">Scaffold</span><span class="p">(</span>
      <span class="nl">appBar:</span> <span class="n">AppBar</span><span class="p">(</span>
        <span class="nl">elevation:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nl">automaticallyImplyLeading:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="nl">backgroundColor:</span> <span class="n">Colors</span><span class="o">.</span><span class="na">white</span><span class="o">.</span><span class="na">withOpacity</span><span class="p">(</span><span class="mf">0.5</span><span class="p">),</span>
        <span class="nl">flexibleSpace:</span> <span class="n">SafeArea</span><span class="p">(</span>
          <span class="nl">child:</span> <span class="n">Container</span><span class="p">(</span>
            <span class="nl">padding:</span> <span class="n">EdgeInsets</span><span class="o">.</span><span class="na">only</span><span class="p">(</span><span class="nl">right:</span> <span class="mi">16</span><span class="p">),</span>
            <span class="nl">child:</span> <span class="n">Container</span><span class="p">(</span>
              <span class="nl">color:</span> <span class="n">Colors</span><span class="o">.</span><span class="na">transparent</span><span class="p">,</span>
              <span class="nl">child:</span> <span class="n">Row</span><span class="p">(</span>
                <span class="nl">children:</span> <span class="p">&lt;</span><span class="n">Widget</span><span class="p">&gt;[</span>
                  <span class="n">IconButton</span><span class="p">(</span>
                    <span class="nl">onPressed:</span> <span class="p">()</span> <span class="p">{</span>
                      <span class="n">Navigator</span><span class="o">.</span><span class="na">pop</span><span class="p">(</span><span class="n">context</span><span class="p">);</span>
                    <span class="p">},</span>
                    <span class="nl">icon:</span> <span class="n">Icon</span><span class="p">(</span>
                      <span class="n">Icons</span><span class="o">.</span><span class="na">arrow_back_ios_new</span><span class="p">,</span>
                      <span class="nl">color:</span> <span class="n">Colors</span><span class="o">.</span><span class="na">black</span><span class="p">,</span>
                    <span class="p">),</span>
                  <span class="p">),</span>
                <span class="p">],</span>
              <span class="p">),</span>
            <span class="p">),</span>
          <span class="p">),</span>
        <span class="p">),</span>
      <span class="p">),</span>
    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>만들어준 <code class="language-plaintext highlighter-rouge">userDetailPage.dart</code> 를 프로필 사진의 제스처에 연결해 주면 된다.</p><div file="/lib/widgets/conversationList.dart" class="language-dart highlighter-rouge"><div class="code-header"> <span data-label-text="/lib/widgets/conversationList.dart"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre>                  <span class="n">InkWell</span><span class="p">(</span>
                    <span class="nl">onTap:</span> <span class="p">()</span> <span class="p">{</span>
                       <span class="c1">//추가</span>
                      <span class="n">Navigator</span><span class="o">.</span><span class="na">of</span><span class="p">(</span><span class="n">context</span><span class="p">)</span><span class="o">.</span><span class="na">push</span><span class="p">(</span><span class="n">MaterialPageRoute</span><span class="p">(</span>
                        <span class="nl">builder:</span> <span class="p">(</span><span class="n">context</span><span class="p">)</span> <span class="p">{</span>
                          <span class="k">return</span> <span class="n">UserDetailPage</span><span class="p">(</span>
                            <span class="nl">cpuser:</span> <span class="n">widget</span><span class="o">.</span><span class="na">user</span><span class="p">,</span>
                          <span class="p">);</span>
                        <span class="p">},</span>
                      <span class="p">));</span>
                      <span class="c1">//추가 END</span>
                    <span class="p">},</span>
                    <span class="nl">child:</span> <span class="n">CircleAvatar</span><span class="p">(</span>
                      <span class="nl">backgroundImage:</span> <span class="n">NetworkImage</span><span class="p">(</span><span class="n">widget</span><span class="o">.</span><span class="na">user</span><span class="o">.</span><span class="na">imageURL</span><span class="p">),</span> <span class="c1">//수정, widget.imageurl -&gt;  widget.user.imageURL</span>
                      <span class="nl">maxRadius:</span> <span class="mi">30</span><span class="p">,</span>
                    <span class="p">),</span>
                  <span class="p">),</span>
</pre></table></code></div></div><p>이제 프로필 사진을 클릭하면 이런 빈 화면이 뜰텐데, 이 상태창은 취향에 맞게 디자인 해주면 된다.</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30% 30%'%3E%3C/svg%3E" data-src="/assets/img/2022-09-03-Flutter-Simple-Chat-UI-EX02/SimulSc_ex_30.png" alt="Flutter Simple chat UI ex 30" width="30%" height="30%" data-proofer-ignore></p><p>나는 이런식으로 만들어 주었다. 상태메세지는 원래 유저 속성에 없었기 때문에 UI작업하면서 <code class="language-plaintext highlighter-rouge">String statusmsg</code>라는 변수타입/명으로 추가해 주었다.</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30% 30%'%3E%3C/svg%3E" data-src="/assets/img/2022-09-03-Flutter-Simple-Chat-UI-EX02/SimulSc_ex_31.png" alt="Flutter Simple chat UI ex 31" width="30%" height="30%" data-proofer-ignore></p><blockquote><p>#수정 보류중인 오류<br /> 이름이랑 상태메세지 정렬이 맘에 안들어서 나중에 수정</p></blockquote><p>상태창 UI의 버튼 목록</p><ul><li>Appbar의 역화살표 아이콘 : <code class="language-plaintext highlighter-rouge">ChatPage</code>로 돌아가기<li>Appbar의 펜모양 아이콘 : 아직 아무 기능 없음<li>Appbar의 더하기 아이콘 : 배경 이미지를 변경 (다음 소챕터에 자세히 작성)<li>이름 옆의 펜 아이콘 : 이름 수정<li>상태메세지 옆의 펜 아이콘 : 상태메세지 수정<li>하단의 메세지 아이콘 : <code class="language-plaintext highlighter-rouge">ChatDetailPage</code>로 이동<li>하단의 전화 아이콘 : 아직 아무 기능 없음<li>하단의 정보 아이콘 : 아직 아무 기능 없음</ul><p>아이콘은 <a href="https://api.flutter.dev/flutter/widgets/Icon-class.html">Flutter Icon Class</a> 참고.</p><p>UI중에 지금까지랑은 크게 다른건 Appbar의 백그라운드를 body뒤로 숨긴것 정도 이다. <code class="language-plaintext highlighter-rouge">Scaffold</code>위젯에서 <code class="language-plaintext highlighter-rouge">extendBodyBehindAppBar</code> 옵션은 <code class="language-plaintext highlighter-rouge">true</code>로 해주면 됨! 그 외에는 딱히 신경쓴건 없고 그냥 배치 구성만 잘 짜면 된다. 아주 제일 머리아프지…</p><div file="/lib/screen/userDetailPage.dart" class="language-dart highlighter-rouge"><div class="code-header"> <span data-label-text="/lib/screen/userDetailPage.dart"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre> <span class="p">...</span> <span class="c1">// 생략</span>
    <span class="k">return</span> <span class="n">Scaffold</span><span class="p">(</span>
        <span class="nl">extendBodyBehindAppBar:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">//앱바 배경 숨기기</span>
        <span class="nl">appBar:</span> <span class="n">AppBar</span><span class="p">(</span>

 <span class="p">...</span> <span class="c1">// 생략</span>
</pre></table></code></div></div><p>그런데 위의 코드대로라면 유저의 이름을 수정한 후에 <code class="language-plaintext highlighter-rouge">ChatPage</code>로 돌아갔을 때 리스트뷰에 갱신내용이 반영이 되어있지 않은 것을 확인 할 수 있을 것이다. 그건<code class="language-plaintext highlighter-rouge">conversationList</code>에서 <code class="language-plaintext highlighter-rouge">UserDetailPage</code>로 <code class="language-plaintext highlighter-rouge">Navigator.of(context).push</code>할 때, 미래의 값을 기다려 줌(<code class="language-plaintext highlighter-rouge">await</code>)으로써 값이 수정되면 상태를 갱신(<code class="language-plaintext highlighter-rouge">setState</code>)하는 것으로 해결할 수 있다.</p><div file="/lib/widgets/conversationList.dart" class="language-dart highlighter-rouge"><div class="code-header"> <span data-label-text="/lib/widgets/conversationList.dart"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre>                  <span class="n">InkWell</span><span class="p">(</span>
                    <span class="nl">onTap:</span> <span class="p">()</span> <span class="kd">async</span> <span class="p">{</span> <span class="c1">//추가, async</span>
                      <span class="k">await</span> <span class="n">Navigator</span><span class="o">.</span><span class="na">of</span><span class="p">(</span><span class="n">context</span><span class="p">)</span><span class="o">.</span><span class="na">push</span><span class="p">(</span><span class="n">MaterialPageRoute</span><span class="p">(</span> <span class="c1">//추가, await</span>
                        <span class="nl">builder:</span> <span class="p">(</span><span class="n">context</span><span class="p">)</span> <span class="p">{</span>
                          <span class="k">return</span> <span class="n">UserDetailPage</span><span class="p">(</span>
                            <span class="nl">cpuser:</span> <span class="n">widget</span><span class="o">.</span><span class="na">user</span><span class="p">,</span>
                          <span class="p">);</span>
                        <span class="p">},</span>
                      <span class="p">));</span>
                      <span class="n">setState</span><span class="p">(()</span> <span class="p">{});</span> <span class="c1">//추가</span>
                    <span class="p">},</span>
                    <span class="nl">child:</span> <span class="n">CircleAvatar</span><span class="p">(</span>
                      <span class="nl">backgroundImage:</span> <span class="n">NetworkImage</span><span class="p">(</span><span class="n">widget</span><span class="o">.</span><span class="na">user</span><span class="o">.</span><span class="na">imageURL</span><span class="p">),</span> 
                      <span class="nl">maxRadius:</span> <span class="mi">30</span><span class="p">,</span>
                    <span class="p">),</span>
                  <span class="p">),</span>
</pre></table></code></div></div><h3 id="갤러리서-선택한-이미지를-배경-이미지로-설정"><span class="mr-2">갤러리서 선택한 이미지를 배경 이미지로 설정</span><a href="#갤러리서-선택한-이미지를-배경-이미지로-설정" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>유저의 속성(<code class="language-plaintext highlighter-rouge">/lib/models/chatUsersModel.dart</code>)에 배경 이미지 속성(<code class="language-plaintext highlighter-rouge">File bgdimage</code>) 추가해주고,</p><div file="/lib/models/chatUsersModel.dart" class="language-dart highlighter-rouge"><div class="code-header"> <span data-label-text="/lib/models/chatUsersModel.dart"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">ChatUsers</span> <span class="p">{</span>
  <span class="nd">@HiveField</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> 
  <span class="kt">String</span> <span class="n">id</span><span class="p">;</span> <span class="c1">// hive의 key로 지정하기 위해 추가</span>
  <span class="nd">@HiveField</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
  <span class="kt">String</span> <span class="n">name</span><span class="p">;</span>
  <span class="nd">@HiveField</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
  <span class="kt">String</span> <span class="n">statusmsg</span><span class="p">;</span> <span class="c1">// 상태 메세지</span>
  <span class="nd">@HiveField</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
  <span class="kt">String</span> <span class="n">messageText</span><span class="p">;</span>
  <span class="nd">@HiveField</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
  <span class="kt">String</span> <span class="n">imageURL</span><span class="p">;</span>
  <span class="nd">@HiveField</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
  <span class="kt">String</span> <span class="n">time</span><span class="p">;</span>
  <span class="nd">@HiveField</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
  <span class="n">File</span> <span class="n">bgdimage</span><span class="p">;</span> <span class="c1">//배경 이미지</span>

  <span class="n">ChatUsers</span><span class="p">(</span>
      <span class="p">{</span><span class="kt">String</span><span class="o">?</span> <span class="n">id</span><span class="p">,</span>
      <span class="kd">required</span> <span class="k">this</span><span class="o">.</span><span class="na">name</span><span class="p">,</span>
      <span class="kd">required</span> <span class="k">this</span><span class="o">.</span><span class="na">messageText</span><span class="p">,</span>
      <span class="kd">required</span> <span class="k">this</span><span class="o">.</span><span class="na">statusmsg</span><span class="p">,</span>
      <span class="kd">required</span> <span class="k">this</span><span class="o">.</span><span class="na">imageURL</span><span class="p">,</span>
      <span class="kd">required</span> <span class="k">this</span><span class="o">.</span><span class="na">time</span><span class="p">,</span>
      <span class="kd">required</span> <span class="k">this</span><span class="o">.</span><span class="na">bgdimage</span><span class="p">})</span>
      <span class="o">:</span> <span class="n">id</span> <span class="o">=</span> <span class="n">id</span> <span class="o">??</span> <span class="n">uuid</span><span class="o">.</span><span class="na">v4</span><span class="p">();</span>

  <span class="p">...</span> <span class="c1">// 생략</span>
<span class="p">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">/lib/modelschatUsersModel.g.dart</code> 파일 갱신을 위해서 터미널에서 명령어 실행</p><div class="language-html highlighter-rouge"><div class="code-header"> <span data-label-text="HTML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>flutter packages pub run build_runner build
</pre></table></code></div></div><p>그런데 여기서 문제가 발생할 것이다… 왜냐하면, <code class="language-plaintext highlighter-rouge">Hive</code>는 File Type을 지원하지 않기 떄문이다. 코드를 수정한 후에 <code class="language-plaintext highlighter-rouge">Add new</code>로 유저를 추가해 주면, 이러한 「너 File의 Typeadapter를 추가하지 않았다. 추가해줘라.」라는 에러를 만나게 될 것이다.</p><pre><code class="language-error">[VERBOSE-2:ui_dart_state.cc(198)] Unhandled Exception: HiveError: Cannot write, unknown type: _File. Did you forget to register an adapter?
</code></pre><p>그리고 덩달아 나머지 속성들에 대한 저장도 제대로 되지 않는다. (아예 <code class="language-plaintext highlighter-rouge">'user_log'</code>박스가 제대로 동작하지 않는다) File의 Typeadapter를 알아서 작성하라는 거냐… 싶지만 인터넷에는 웬만한 찾아보면 있다.</p><p>내가 참고한 글은 <a href="https://zenn.dev/kirisimacreate/articles/6badb7d8ee58f8">【Flutter】Hiveの対応しているオブジェクト以外も格納できるようにする</a> 라는 글인데, 이 글에서 처럼 <code class="language-plaintext highlighter-rouge">file_apdater.dart</code>라는 파일을 만들어 주고, 만들어준 파일에 정의한 <code class="language-plaintext highlighter-rouge">FileAdapter</code>를 <code class="language-plaintext highlighter-rouge">main.dart</code>에 등록해 주면 된다. 그럼 에러가 없이 깔끔하게 실행되는 것을 확인 할 수 있다.</p><p>이제 해결했으니 본론으로 돌아오겠다.</p><p>배경 이미지 선택은 갤러리에서 사진을 가져오는 방식을 사용할 것이기 때문에, <code class="language-plaintext highlighter-rouge">/ios/Runner/info.plist</code>에 카메라, 앨범에 액세스 권한을 추가해주었다.(카메라는 아직 권한만 추가하고 미구현), 권한을 주지 않고 앨범에 접근하려고 하면 앱이 강제종료된다.</p><div file="/ios/Runner/info.plist" class="language-plist highlighter-rouge"><div class="code-header"> <span data-label-text="/ios/Runner/info.plist"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="w">	</span><span class="p">&lt;</span><span class="err">string</span><span class="p">&gt;</span><span class="l">Access</span><span class="w"> </span><span class="l">to</span><span class="w"> </span><span class="l">take</span><span class="w"> </span><span class="l">a</span><span class="w"> </span><span class="l">photo</span><span class="w"> </span><span class="l">by</span><span class="w"> </span><span class="l">camera</span><span class="p">&lt;</span><span class="err">/string</span><span class="p">&gt;</span><span class="w">
	</span><span class="p">&lt;</span><span class="err">k</span><span class="mh">e</span><span class="err">y</span><span class="p">&gt;</span><span class="l">NSAppleMusicUsageDescription</span><span class="p">&lt;</span><span class="err">/k</span><span class="mh">e</span><span class="err">y</span><span class="p">&gt;</span><span class="w">
	</span><span class="p">&lt;</span><span class="err">string</span><span class="p">&gt;</span><span class="l">Access</span><span class="w"> </span><span class="l">to</span><span class="w"> </span><span class="l">pick</span><span class="w"> </span><span class="l">a</span><span class="w"> </span><span class="l">photo</span><span class="p">&lt;</span><span class="err">/string</span><span class="p">&gt;</span><span class="w">
	</span><span class="p">&lt;</span><span class="err">k</span><span class="mh">e</span><span class="err">y</span><span class="p">&gt;</span><span class="l">NSPhotoLibraryUsageDescription</span><span class="p">&lt;</span><span class="err">/k</span><span class="mh">e</span><span class="err">y</span><span class="p">&gt;</span><span class="w">
	</span><span class="p">&lt;</span><span class="err">string</span><span class="p">&gt;</span><span class="l">Access</span><span class="w"> </span><span class="l">to</span><span class="w"> </span><span class="l">pick</span><span class="w"> </span><span class="l">a</span><span class="w"> </span><span class="l">photo</span><span class="p">&lt;</span><span class="err">/string</span><span class="p">&gt;</span><span class="w">
</span></pre></table></code></div></div><p>상태창 UI(<code class="language-plaintext highlighter-rouge">/lib/screen/userDetailPage.dart</code>)에 버튼을 만들어 주고 버튼을 누르면 갤러리에 접근할 수 있도록 해준다.</p><div file="/lib/screen/userDetailPage.dart" class="language-dart highlighter-rouge"><div class="code-header"> <span data-label-text="/lib/screen/userDetailPage.dart"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre>                    <span class="n">IconButton</span><span class="p">(</span>
                        <span class="nl">onPressed:</span> <span class="p">()</span> <span class="kd">async</span> <span class="p">{</span>
                          <span class="n">print</span><span class="p">(</span><span class="s">"Add background Image"</span><span class="p">);</span>
                          
                          <span class="n">File</span> <span class="n">_tempimg</span> <span class="o">=</span> <span class="k">await</span> <span class="n">getImageFromGallery</span><span class="p">();</span>
                          <span class="n">setState</span><span class="p">(()</span> <span class="p">{</span>
                            <span class="n">_uctlr</span><span class="o">.</span><span class="na">editUserbgd</span><span class="p">(</span><span class="n">widget</span><span class="o">.</span><span class="na">cpuser</span><span class="o">.</span><span class="na">id</span><span class="p">,</span> <span class="n">_tempimg</span><span class="p">);</span> <span class="c1">//해당 id유저의 bgdimage 속성값을 변경</span>
                          <span class="p">});</span>
                        <span class="p">},</span>
                        <span class="nl">alignment:</span> <span class="n">Alignment</span><span class="o">.</span><span class="na">centerRight</span><span class="p">,</span>
                        <span class="nl">icon:</span> <span class="kd">const</span> <span class="n">Icon</span><span class="p">(</span>
                          <span class="n">Icons</span><span class="o">.</span><span class="na">add</span><span class="p">,</span>
                          <span class="nl">color:</span> <span class="n">Colors</span><span class="o">.</span><span class="na">black</span><span class="p">,</span>
                        <span class="p">),</span>
                      <span class="p">)</span>
</pre></table></code></div></div><p>여기서 <code class="language-plaintext highlighter-rouge">getImageFromGallery()</code>에 <code class="language-plaintext highlighter-rouge">await</code>선언을 해주었는데, 이유는 <code class="language-plaintext highlighter-rouge">getImageFromGallery()</code>에서 반환된 값을 받아온 후에 파일 값을 갱신해야하기 때문이다. <code class="language-plaintext highlighter-rouge">await</code>선언을 해주지 않고 그냥 <code class="language-plaintext highlighter-rouge">_tempimg</code>에 반환값을 받아오려고 해도 어짜피 에러가 난다 <code class="language-plaintext highlighter-rouge">getImageFromGallery()</code>는 반환값이 <code class="language-plaintext highlighter-rouge">Future&lt;File&gt;</code>타입이기 때문이다.</p><p>갤러리에 접근해서 이미지를 가져오는 함수(<code class="language-plaintext highlighter-rouge">getImageFromGallery()</code>)는 이렇게 생겼다. <a href="https://pub.dev/packages/image_picker">Image Picker</a>라는 플러그인을 사용해서 가져오니 <code class="language-plaintext highlighter-rouge">pubspec.yaml</code>에 <code class="language-plaintext highlighter-rouge">dependencies</code>추가해주고 사용할 위젯에 임포트 해주었다.</p><div file="/lib/screen/userDetailPage.dart" class="language-dart highlighter-rouge"><div class="code-header"> <span data-label-text="/lib/screen/userDetailPage.dart"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre>  <span class="n">File</span> <span class="n">_bgdimage</span> <span class="o">=</span> <span class="n">File</span><span class="p">(</span><span class="s">"초기 셋팅할 String 타입 이미지경로 입력"</span><span class="p">);</span>
  <span class="kd">final</span> <span class="n">ImagePicker</span> <span class="n">picker</span> <span class="o">=</span> <span class="n">ImagePicker</span><span class="p">();</span>

  <span class="n">Future</span><span class="p">&lt;</span><span class="n">File</span><span class="p">&gt;</span> <span class="n">getImageFromGallery</span><span class="p">()</span> <span class="kd">async</span> <span class="p">{</span>
    <span class="kd">final</span> <span class="n">pickedFile</span> <span class="o">=</span> <span class="k">await</span> <span class="n">picker</span><span class="o">.</span><span class="na">pickImage</span><span class="p">(</span><span class="kn">source</span><span class="o">:</span> <span class="n">ImageSource</span><span class="o">.</span><span class="na">gallery</span><span class="p">)</span><span class="o">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">pickedFile</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">setState</span><span class="p">(()</span> <span class="p">{</span>
        <span class="n">_bgdimage</span> <span class="o">=</span> <span class="n">File</span><span class="p">(</span><span class="n">pickedFile</span><span class="o">.</span><span class="na">path</span><span class="p">);</span>
      <span class="p">});</span>
      <span class="k">return</span> <span class="n">_bgdimage</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="n">print</span><span class="p">(</span><span class="s">'No image selected'</span><span class="p">);</span>
      <span class="k">return</span> <span class="n">_bgdimage</span><span class="p">;</span>
    <span class="p">}</span>
</pre></table></code></div></div><p>이 때 <code class="language-plaintext highlighter-rouge">getImageFromGallery</code> 함수는 (배경 이미지)파일 값을 받는 비동기(<code class="language-plaintext highlighter-rouge">Future&lt;File&gt;</code>)처리를 해주었다. <code class="language-plaintext highlighter-rouge">pickImage</code>가 사용자가 갤러리에서 이미지를 선택하기까지 (혹은 선택을 취소할 때까지) 대기를 타다가 작업이 완료되면, 그제서야 값을 가져올수 있는 상태(<code class="language-plaintext highlighter-rouge">await</code>)이기 떄문이다. (이것 때문에 <code class="language-plaintext highlighter-rouge">_tempimg</code>에 값을 받아올 때도 <code class="language-plaintext highlighter-rouge">await</code> 필요)</p><p>처음에는 <code class="language-plaintext highlighter-rouge">_tempimg</code>를 거치지 않고 <code class="language-plaintext highlighter-rouge">_bgdimage</code> 변수를 그대로 <code class="language-plaintext highlighter-rouge">editUserbgd(widget.cpuser.id, _bgdimage)</code> 이런식으로 넣어버렸었는데, 그러면 비동기화 때문에 <code class="language-plaintext highlighter-rouge">_bgdimage</code> 값이 변경되기 전에 재빌드가 먼저 되어버리고, 그 뒤에 <code class="language-plaintext highlighter-rouge">_bgdimage</code> 값이 변경되어서 배경 이미지가 바뀌지 않았다.</p><p>UI에는 이렇게 <code class="language-plaintext highlighter-rouge">BoxDecoration</code>위젯을 사용해 주면 된다.</p><div file="/lib/screen/userDetailPage.dart" class="language-dart highlighter-rouge"><div class="code-header"> <span data-label-text="/lib/screen/userDetailPage.dart"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre> <span class="p">...</span> <span class="c1">// 생략</span>
          <span class="nl">body:</span> <span class="n">Container</span><span class="p">(</span>
            <span class="c1">//color: Colors.orange, //decoration과 함께 쓸 수 없는 속성</span>
            <span class="nl">decoration:</span> <span class="n">BoxDecoration</span><span class="p">(</span>
              <span class="nl">image:</span> <span class="n">DecorationImage</span><span class="p">(</span>
                  <span class="nl">image:</span> <span class="n">FileImage</span><span class="p">(</span><span class="n">widget</span><span class="o">.</span><span class="na">cpuser</span><span class="o">.</span><span class="na">bgdimage</span><span class="p">),</span>
                  <span class="nl">fit:</span> <span class="n">BoxFit</span><span class="o">.</span><span class="na">fill</span><span class="p">,</span>
                  <span class="nl">opacity:</span> <span class="mf">0.3</span><span class="p">),</span>
            <span class="p">),</span>
 <span class="p">...</span> <span class="c1">// 생략</span>
</pre></table></code></div></div><p>완성된 상태창, 수정 데모</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30% 30%'%3E%3C/svg%3E" data-src="/assets/img/2022-09-03-Flutter-Simple-Chat-UI-EX02/SimulSc_ex_32.gif" alt="Flutter Simple chat UI ex 32" width="30%" height="30%" data-proofer-ignore></p><blockquote><p>#수정 보류중인 오류<br /> 상태메세지 바꿀 때 뜨는 다이얼로그를 이름 바꿀 때 쓰는 다이얼로그와 같이 써서, 타이틀이랑 힌트가 상황에 맞지 않게 뜨는 거 요수정</p></blockquote><hr /><h1 id="다음-포스팅-내용">다음 포스팅 내용</h1><p>이제 유저 정보는 데이터 베이스에 저장이 된다! 상태창에서 정상적으로 이름, 상태메세지, 배경이미지를 바꿀 수 있다.<br /> 다음엔 유저 정보를 저장해 준 것처럼, 유저별로 메세지 로그를 저장해 주고 마지막에 대화했던 메세지 내용을 <code class="language-plaintext highlighter-rouge">ChatPage</code>에 표시해 주는 것을 해 볼 것이다.</p><hr /><h1 id="flutter의-상태-관리">flutter의 상태 관리</h1><h2 id="statefulwidgetsetstate"><span class="mr-2">StatefulWidget(setState)</span><a href="#statefulwidgetsetstate" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Dart에서 기본적으로 제공하는 상태 관리 위젯과 함수</p><h2 id="redux"><span class="mr-2">Redux</span><a href="#redux" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>자세히 공부 안함 이런게 있다는 것만 앎, 나중에 공부하면 추가하기</p><h2 id="stream--inheritedwidgetscoped-model-bloc"><span class="mr-2">Stream + InheritedWidget/Scoped Model (BLoC)</span><a href="#stream--inheritedwidgetscoped-model-bloc" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>자세히 공부 안함 이런게 있다는 것만 앎, 나중에 공부하면 추가하하기</p><h2 id="provider"><span class="mr-2"><a href="https://pub.dev/packages/provider"><span class="mr-2">Provider</a></span><a href="#provider" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>provider package</p><ul><li><a href="https://pub.dev/packages/change_notifier">change_notifier</a><li><a href="https://pub.dev/packages/state_notifier">state_notifier</a> (<a href="https://pub.dev/packages/flutter_state_notifier">flutter_state_notifier</a>)<br /> change_notifier 을 좀 더 개선한 느낌, 이번에 이거 사용</ul><p>Provider 사용법에서 디지게 애먹었다 아놔…. 분명 제대로 쓴 거 같은데 계속 범위 외라고 떠서 해결방법 까지 한 200번의 성공의 어머니를 겪음</p><p><code class="language-plaintext highlighter-rouge">ChatDetailPage()</code>가<code class="language-plaintext highlighter-rouge">MaterialPageRoute</code>에서 빌드되고 있다는 것의 의미를 한!!!!!!참을 이해를 못해서 <code class="language-plaintext highlighter-rouge">StateNotifierProvider</code>를 이상한 곳에서 공급해 주고있는데, 왜 에러가 나는지 모르겠어서 진짜 미치고 돌아버리는 줄 알았다. 이론을 전혀 모르고 그냥 맨땅에 머리를 박으니까 이런데서 시간이 무지하게 들어간다. 지금 생각하면 이거가지고 이렇게 고생을 한 게 어이없어 보이지만, 덕분에 Provider의 범위에 대해서는 공부가 되었으니 오케입니다</p><p>해결하면서 도움이 많이 된 사이트</p><ul><li><a href="https://dev-yakuza.posstree.com/ko/flutter/provider/">Provider설명과 예제</a><li><a href="https://note.com/mukae9/n/n91b3301ebccf">Flutter(Provider+StateNotifier+freezed)</a><li><a href="https://docs.flutter.dev/development/data-and-backend/state-mgmt/simple#changenotifierprovider">Simple app state management</a></ul><h2 id="riverpod"><span class="mr-2"><a href="https://riverpod.dev/ko/docs/getting_started"><span class="mr-2">Riverpod</a></span><a href="#riverpod" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>riverpod package</p><ul><li><a href="https://pub.dev/packages/flutter_riverpod">flutter_riverpod</a></ul><p>GetX, Provider, BLoC처럼 상태관리를 위한 패키지 (Provider의 확장판)</p><p>참고 사이트</p><ul><li><a href="https://prod.velog.io/@leeeeeoy/Flutter-Riverpod-사용해보기-1">Riverpod설명과 예제</a></ul><hr /><h1 id="참고하기-좋은-사이트">참고하기 좋은 사이트</h1><ul><li><a href="https://pusher.com/tutorials/local-data-flutter/">How to save data locally in Flutter</a><br /> 위에서 언급한 로컬에 데이터 저장할 때 고려한 방법 3개(①shared_preferences ②로컬 파일 ③로컬 데이터베이스 : sqflite플러그인사용)에 대한 튜토리얼이 있다.<li><a href="https://www.flutter-study.dev/create-app/provider">flutter study</a><li><a href="https://zenn.dev/naoya_maeda/articles/01e51841d6fb8b">flutter provider 사용법 기초</a></ul><hr /><h1 id="후기">후기</h1><p>글로 기록하면 한번에 톽딱!땋! 한 것처럼 보이는데 사실 쪼랩이라서 뭣만하면 모르는 게 나오기 때문에 시행착오를 굉장히 겪는다… 돌아버려 진짜,,, 이번거 완전 오래 걸렸고,,, 그래도 많이 배웠다.<br /> 그리고 쓰다보니 생각보다 긴데, 나중에 좀 내용을 나누든가 해야겠다. 원래 메세지 로그 저장도 여기에 같이 쓰려다 너무 길어져서 나눈 건데, 그래도 기네</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/flutter/'>Flutter</a>, <a href='/categories/simple-chat/'>Simple Chat</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/flutter/" class="post-tag no-text-decoration" >flutter</a> <a href="/tags/practice/" class="post-tag no-text-decoration" >practice</a> <a href="/tags/programming/" class="post-tag no-text-decoration" >programming</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Flutter+01+Simple+Chat+UI+%EC%9D%91%EC%9A%A9+02+%EB%8D%B0%EC%9D%B4%ED%84%B0+%EB%A1%9C%EC%BB%AC+%EC%A0%80%EC%9E%A5+%EB%B0%8F+%EC%9D%BD%EA%B8%B0%2C%EC%93%B0%EA%B8%B0_%EC%9C%A0%EC%A0%80%EC%A0%95%EB%B3%B4%ED%8E%B8+%28%2B%EC%83%81%ED%83%9C%EC%B0%BD+%EC%B6%94%EA%B0%80%29++-+Kae%27s+Dev&url=https%3A%2F%2Fkaesknzxvf.github.io%2Fposts%2FFlutter-Simple-Chat-UI-EX02%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Flutter+01+Simple+Chat+UI+%EC%9D%91%EC%9A%A9+02+%EB%8D%B0%EC%9D%B4%ED%84%B0+%EB%A1%9C%EC%BB%AC+%EC%A0%80%EC%9E%A5+%EB%B0%8F+%EC%9D%BD%EA%B8%B0%2C%EC%93%B0%EA%B8%B0_%EC%9C%A0%EC%A0%80%EC%A0%95%EB%B3%B4%ED%8E%B8+%28%2B%EC%83%81%ED%83%9C%EC%B0%BD+%EC%B6%94%EA%B0%80%29++-+Kae%27s+Dev&u=https%3A%2F%2Fkaesknzxvf.github.io%2Fposts%2FFlutter-Simple-Chat-UI-EX02%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fkaesknzxvf.github.io%2Fposts%2FFlutter-Simple-Chat-UI-EX02%2F&text=Flutter+01+Simple+Chat+UI+%EC%9D%91%EC%9A%A9+02+%EB%8D%B0%EC%9D%B4%ED%84%B0+%EB%A1%9C%EC%BB%AC+%EC%A0%80%EC%9E%A5+%EB%B0%8F+%EC%9D%BD%EA%B8%B0%2C%EC%93%B0%EA%B8%B0_%EC%9C%A0%EC%A0%80%EC%A0%95%EB%B3%B4%ED%8E%B8+%28%2B%EC%83%81%ED%83%9C%EC%B0%BD+%EC%B6%94%EA%B0%80%29++-+Kae%27s+Dev" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div><script src="https://utteranc.es/client.js" repo="kaesknzxvf/kaesknzxvf.github.io" issue-term="pathname" theme="github-dark" crossorigin="anonymous" async> </script></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Flutter-Simple-Chat-UI-01/">Flutter 01 Simple Chat UI 01 Chat화면</a><li><a href="/posts/Flutter-Simple-Chat-UI-02/">Flutter 01 Simple Chat UI 02 Chat Detail 화면</a><li><a href="/posts/Flutter-Simple-Chat-UI-EX01/">Flutter 01 Simple Chat UI 응용 01 화면 간 데이터 전달, 메세지 입력 </a><li><a href="/posts/Flutter-Simple-Chat-UI-EX02/">Flutter 01 Simple Chat UI 응용 02 데이터 로컬 저장 및 읽기,쓰기_유저정보편 (+상태창 추가) </a><li><a href="/posts/Github-Blog-Setting-01/">Github Blog 02 Chirpy Theme Setting </a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/flutter/">flutter</a> <a class="post-tag" href="/tags/practice/">practice</a> <a class="post-tag" href="/tags/programming/">programming</a> <a class="post-tag" href="/tags/blog/">blog</a> <a class="post-tag" href="/tags/github/">github</a> <a class="post-tag" href="/tags/myblogging/">myblogging</a> <a class="post-tag" href="/tags/personal/">personal</a> <a class="post-tag" href="/tags/writeup/">writeup</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Flutter-Simple-Chat-UI-01/"><div class="card-body"> <em class="small" data-ts="1657426206" data-df="ll" > Jul 10, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Flutter 01 Simple Chat UI 01 Chat화면</h3><div class="text-muted small"><p> 이 포스트는 How to Build a Chat App UI With Flutter and Dart 을 따라서 작성한 Flutter Simple Chat UI 에 관한 내용이다. 관련 포스트 Base, Chat 화면 구현 (현재 포스트) Chat Detail 화면 구현 응용 01 (Chat Detail 화면) 화면 간 ...</p></div></div></a></div><div class="card"> <a href="/posts/Flutter-Simple-Chat-UI-02/"><div class="card-body"> <em class="small" data-ts="1659761220" data-df="ll" > Aug 6, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Flutter 01 Simple Chat UI 02 Chat Detail 화면</h3><div class="text-muted small"><p> 이 포스트는 How to Build a Chat App UI With Flutter and Dart 을 따라서 작성한 Flutter Simple Chat UI 에 관한 내용이다. 관련 포스트 Base, Chat 화면 구현 Chat Detail 화면 구현 (현재 포스트) 응용 01 (Chat Detail 화면) 화면 간 ...</p></div></div></a></div><div class="card"> <a href="/posts/Flutter-Simple-Chat-UI-EX01/"><div class="card-body"> <em class="small" data-ts="1660284960" data-df="ll" > Aug 12, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Flutter 01 Simple Chat UI 응용 01 화면 간 데이터 전달, 메세지 입력</h3><div class="text-muted small"><p> 이 포스트는 How to Build a Chat App UI With Flutter and Dart 을 따라서 작성한 Flutter Simple Chat UI 을 응용하여 좀 더 그럴듯한 채팅앱을 구현하기 위한 과정을 다룬다. 주요 내용은 이하와 같다. 화면 간의 데이터 전달 메세지 입력 메세지 입력에 따른 Chat D...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Flutter-Simple-Chat-UI-EX01/" class="btn btn-outline-primary" prompt="Older"><p>Flutter 01 Simple Chat UI 응용 01 화면 간 데이터 전달, 메세지 입력</p></a> <a href="/posts/Flutter-Simple-Chat-UI-EX03/" class="btn btn-outline-primary" prompt="Newer"><p>Flutter 01 Simple Chat UI 응용 03 데이터 로컬 저장 및 읽기,쓰기_메세지 로그편</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://github.com/kaesknzxvf">kae</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/flutter/">flutter</a> <a class="post-tag" href="/tags/practice/">practice</a> <a class="post-tag" href="/tags/programming/">programming</a> <a class="post-tag" href="/tags/blog/">blog</a> <a class="post-tag" href="/tags/github/">github</a> <a class="post-tag" href="/tags/myblogging/">myblogging</a> <a class="post-tag" href="/tags/personal/">personal</a> <a class="post-tag" href="/tags/writeup/">writeup</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-B23YJG8BQ3"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-B23YJG8BQ3'); }); </script>
